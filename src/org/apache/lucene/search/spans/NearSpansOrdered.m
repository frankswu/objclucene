//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/search/spans/NearSpansOrdered.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/util/List.h"
#include "org/apache/lucene/search/spans/ConjunctionSpans.h"
#include "org/apache/lucene/search/spans/NearSpans.h"
#include "org/apache/lucene/search/spans/NearSpansOrdered.h"
#include "org/apache/lucene/search/spans/SpanCollector.h"
#include "org/apache/lucene/search/spans/SpanNearQuery.h"
#include "org/apache/lucene/search/spans/Spans.h"

@interface OrgApacheLuceneSearchSpansNearSpansOrdered ()

- (jboolean)unpositioned;

/*!
 @brief Order the subSpans within the same document by using nextStartPosition on all subSpans
 after the first as little as necessary.
 Return true when the subSpans could be ordered in this way,
 otherwise at least one is exhausted in the current doc.
 */
- (jboolean)stretchToOrder;

+ (jint)advancePositionWithOrgApacheLuceneSearchSpansSpans:(OrgApacheLuceneSearchSpansSpans *)spans
                                                   withInt:(jint)position;

@end

__attribute__((unused)) static jboolean OrgApacheLuceneSearchSpansNearSpansOrdered_unpositioned(OrgApacheLuceneSearchSpansNearSpansOrdered *self);

__attribute__((unused)) static jboolean OrgApacheLuceneSearchSpansNearSpansOrdered_stretchToOrder(OrgApacheLuceneSearchSpansNearSpansOrdered *self);

__attribute__((unused)) static jint OrgApacheLuceneSearchSpansNearSpansOrdered_advancePositionWithOrgApacheLuceneSearchSpansSpans_withInt_(OrgApacheLuceneSearchSpansSpans *spans, jint position);

@implementation OrgApacheLuceneSearchSpansNearSpansOrdered

- (instancetype)initWithOrgApacheLuceneSearchSpansSpanNearQuery:(OrgApacheLuceneSearchSpansSpanNearQuery *)query
                                               withJavaUtilList:(id<JavaUtilList>)subSpans {
  OrgApacheLuceneSearchSpansNearSpansOrdered_initWithOrgApacheLuceneSearchSpansSpanNearQuery_withJavaUtilList_(self, query, subSpans);
  return self;
}

- (jboolean)twoPhaseCurrentDocMatches {
  JreAssert((OrgApacheLuceneSearchSpansNearSpansOrdered_unpositioned(self)), (@"org/apache/lucene/search/spans/NearSpansOrdered.java:58 condition failed: assert unpositioned();"));
  oneExhaustedInCurrentDoc_ = false;
  while ([((OrgApacheLuceneSearchSpansSpans *) nil_chk(IOSObjectArray_Get(nil_chk(subSpans_), 0))) nextStartPosition] != OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS && !oneExhaustedInCurrentDoc_) {
    if (OrgApacheLuceneSearchSpansNearSpansOrdered_stretchToOrder(self) && matchWidth_ <= allowedSlop_) {
      return atFirstInCurrentDoc_ = true;
    }
  }
  return false;
}

- (jboolean)unpositioned {
  return OrgApacheLuceneSearchSpansNearSpansOrdered_unpositioned(self);
}

- (jint)nextStartPosition {
  if (atFirstInCurrentDoc_) {
    atFirstInCurrentDoc_ = false;
    return matchStart_;
  }
  oneExhaustedInCurrentDoc_ = false;
  while ([((OrgApacheLuceneSearchSpansSpans *) nil_chk(IOSObjectArray_Get(nil_chk(subSpans_), 0))) nextStartPosition] != OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS && !oneExhaustedInCurrentDoc_) {
    if (OrgApacheLuceneSearchSpansNearSpansOrdered_stretchToOrder(self) && matchWidth_ <= allowedSlop_) {
      return matchStart_;
    }
  }
  return matchStart_ = matchEnd_ = OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS;
}

- (jboolean)stretchToOrder {
  return OrgApacheLuceneSearchSpansNearSpansOrdered_stretchToOrder(self);
}

+ (jint)advancePositionWithOrgApacheLuceneSearchSpansSpans:(OrgApacheLuceneSearchSpansSpans *)spans
                                                   withInt:(jint)position {
  return OrgApacheLuceneSearchSpansNearSpansOrdered_advancePositionWithOrgApacheLuceneSearchSpansSpans_withInt_(spans, position);
}

- (jint)startPosition {
  return atFirstInCurrentDoc_ ? -1 : matchStart_;
}

- (jint)endPosition {
  return atFirstInCurrentDoc_ ? -1 : matchEnd_;
}

- (jint)width {
  return matchWidth_;
}

- (void)collectWithOrgApacheLuceneSearchSpansSpanCollector:(id<OrgApacheLuceneSearchSpansSpanCollector>)collector {
  {
    IOSObjectArray *a__ = subSpans_;
    OrgApacheLuceneSearchSpansSpans * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    OrgApacheLuceneSearchSpansSpans * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      OrgApacheLuceneSearchSpansSpans *spans = *b__++;
      [((OrgApacheLuceneSearchSpansSpans *) nil_chk(spans)) collectWithOrgApacheLuceneSearchSpansSpanCollector:collector];
    }
  }
}

- (NSString *)description {
  return JreStrcat("$$$I$I$I", @"NearSpansOrdered(", [((OrgApacheLuceneSearchSpansSpanNearQuery *) nil_chk(query_)) description], @")@", [self docID], @": ", [self startPosition], @" - ", [self endPosition]);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSearchSpansSpanNearQuery:withJavaUtilList:", "NearSpansOrdered", NULL, 0x1, "Ljava.io.IOException;", "(Lorg/apache/lucene/search/spans/SpanNearQuery;Ljava/util/List<Lorg/apache/lucene/search/spans/Spans;>;)V" },
    { "twoPhaseCurrentDocMatches", NULL, "Z", 0x0, "Ljava.io.IOException;", NULL },
    { "unpositioned", NULL, "Z", 0x2, NULL, NULL },
    { "nextStartPosition", NULL, "I", 0x1, "Ljava.io.IOException;", NULL },
    { "stretchToOrder", NULL, "Z", 0x2, "Ljava.io.IOException;", NULL },
    { "advancePositionWithOrgApacheLuceneSearchSpansSpans:withInt:", "advancePosition", "I", 0xa, "Ljava.io.IOException;", NULL },
    { "startPosition", NULL, "I", 0x1, NULL, NULL },
    { "endPosition", NULL, "I", 0x1, NULL, NULL },
    { "width", NULL, "I", 0x1, NULL, NULL },
    { "collectWithOrgApacheLuceneSearchSpansSpanCollector:", "collect", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "description", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "matchStart_", NULL, 0x4, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "matchEnd_", NULL, 0x4, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "matchWidth_", NULL, 0x4, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSpansNearSpansOrdered = { 2, "NearSpansOrdered", "org.apache.lucene.search.spans", NULL, 0x1, 11, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSearchSpansNearSpansOrdered;
}

@end

void OrgApacheLuceneSearchSpansNearSpansOrdered_initWithOrgApacheLuceneSearchSpansSpanNearQuery_withJavaUtilList_(OrgApacheLuceneSearchSpansNearSpansOrdered *self, OrgApacheLuceneSearchSpansSpanNearQuery *query, id<JavaUtilList> subSpans) {
  OrgApacheLuceneSearchSpansNearSpans_initWithOrgApacheLuceneSearchSpansSpanNearQuery_withJavaUtilList_(self, query, subSpans);
  self->matchStart_ = -1;
  self->matchEnd_ = -1;
  self->matchWidth_ = -1;
  self->atFirstInCurrentDoc_ = true;
}

OrgApacheLuceneSearchSpansNearSpansOrdered *new_OrgApacheLuceneSearchSpansNearSpansOrdered_initWithOrgApacheLuceneSearchSpansSpanNearQuery_withJavaUtilList_(OrgApacheLuceneSearchSpansSpanNearQuery *query, id<JavaUtilList> subSpans) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSpansNearSpansOrdered, initWithOrgApacheLuceneSearchSpansSpanNearQuery_withJavaUtilList_, query, subSpans)
}

OrgApacheLuceneSearchSpansNearSpansOrdered *create_OrgApacheLuceneSearchSpansNearSpansOrdered_initWithOrgApacheLuceneSearchSpansSpanNearQuery_withJavaUtilList_(OrgApacheLuceneSearchSpansSpanNearQuery *query, id<JavaUtilList> subSpans) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSpansNearSpansOrdered, initWithOrgApacheLuceneSearchSpansSpanNearQuery_withJavaUtilList_, query, subSpans)
}

jboolean OrgApacheLuceneSearchSpansNearSpansOrdered_unpositioned(OrgApacheLuceneSearchSpansNearSpansOrdered *self) {
  {
    IOSObjectArray *a__ = self->subSpans_;
    OrgApacheLuceneSearchSpansSpans * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    OrgApacheLuceneSearchSpansSpans * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      OrgApacheLuceneSearchSpansSpans *span = *b__++;
      if ([((OrgApacheLuceneSearchSpansSpans *) nil_chk(span)) startPosition] != -1) return false;
    }
  }
  return true;
}

jboolean OrgApacheLuceneSearchSpansNearSpansOrdered_stretchToOrder(OrgApacheLuceneSearchSpansNearSpansOrdered *self) {
  OrgApacheLuceneSearchSpansSpans *prevSpans = IOSObjectArray_Get(nil_chk(self->subSpans_), 0);
  self->matchStart_ = [((OrgApacheLuceneSearchSpansSpans *) nil_chk(prevSpans)) startPosition];
  JreAssert(([prevSpans startPosition] != OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS), (JreStrcat("$@", @"prevSpans no start position ", prevSpans)));
  JreAssert(([prevSpans endPosition] != OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS), (@"org/apache/lucene/search/spans/NearSpansOrdered.java:101 condition failed: assert prevSpans.endPosition() != NO_MORE_POSITIONS;"));
  self->matchWidth_ = 0;
  for (jint i = 1; i < self->subSpans_->size_; i++) {
    OrgApacheLuceneSearchSpansSpans *spans = IOSObjectArray_Get(self->subSpans_, i);
    JreAssert(([((OrgApacheLuceneSearchSpansSpans *) nil_chk(spans)) startPosition] != OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS), (@"org/apache/lucene/search/spans/NearSpansOrdered.java:105 condition failed: assert spans.startPosition() != NO_MORE_POSITIONS;"));
    JreAssert(([spans endPosition] != OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS), (@"org/apache/lucene/search/spans/NearSpansOrdered.java:106 condition failed: assert spans.endPosition() != NO_MORE_POSITIONS;"));
    if (OrgApacheLuceneSearchSpansNearSpansOrdered_advancePositionWithOrgApacheLuceneSearchSpansSpans_withInt_(spans, [prevSpans endPosition]) == OrgApacheLuceneSearchSpansSpans_NO_MORE_POSITIONS) {
      self->oneExhaustedInCurrentDoc_ = true;
      return false;
    }
    self->matchWidth_ += ([spans startPosition] - [prevSpans endPosition]);
    prevSpans = spans;
  }
  self->matchEnd_ = [((OrgApacheLuceneSearchSpansSpans *) nil_chk(IOSObjectArray_Get(self->subSpans_, self->subSpans_->size_ - 1))) endPosition];
  return true;
}

jint OrgApacheLuceneSearchSpansNearSpansOrdered_advancePositionWithOrgApacheLuceneSearchSpansSpans_withInt_(OrgApacheLuceneSearchSpansSpans *spans, jint position) {
  OrgApacheLuceneSearchSpansNearSpansOrdered_initialize();
  if ([spans isKindOfClass:[OrgApacheLuceneSearchSpansSpanNearQuery_GapSpans class]]) {
    return [((OrgApacheLuceneSearchSpansSpanNearQuery_GapSpans *) nil_chk(((OrgApacheLuceneSearchSpansSpanNearQuery_GapSpans *) cast_chk(spans, [OrgApacheLuceneSearchSpansSpanNearQuery_GapSpans class])))) skipToPositionWithInt:position];
  }
  while ([((OrgApacheLuceneSearchSpansSpans *) nil_chk(spans)) startPosition] < position) {
    [spans nextStartPosition];
  }
  return [spans startPosition];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSpansNearSpansOrdered)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./grouping/src/java/org/apache/lucene/search/grouping/term/TermAllGroupsCollector.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/util/ArrayList.h"
#include "java/util/Collection.h"
#include "java/util/List.h"
#include "org/apache/lucene/index/DocValues.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/index/SortedDocValues.h"
#include "org/apache/lucene/search/grouping/AbstractAllGroupsCollector.h"
#include "org/apache/lucene/search/grouping/term/TermAllGroupsCollector.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/SentinelIntSet.h"

#define OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_DEFAULT_INITIAL_SIZE 128

@interface OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector () {
 @public
  NSString *groupField_;
  OrgApacheLuceneUtilSentinelIntSet *ordSet_;
  id<JavaUtilList> groups_;
  OrgApacheLuceneIndexSortedDocValues *index_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector, groupField_, NSString *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector, ordSet_, OrgApacheLuceneUtilSentinelIntSet *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector, groups_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector, index_, OrgApacheLuceneIndexSortedDocValues *)

J2OBJC_STATIC_FIELD_GETTER(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector, DEFAULT_INITIAL_SIZE, jint)

@implementation OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector

- (instancetype)initWithNSString:(NSString *)groupField
                         withInt:(jint)initialSize {
  OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_withInt_(self, groupField, initialSize);
  return self;
}

- (instancetype)initWithNSString:(NSString *)groupField {
  OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_(self, groupField);
  return self;
}

- (void)collectWithInt:(jint)doc {
  jint key = [((OrgApacheLuceneIndexSortedDocValues *) nil_chk(index_)) getOrdWithInt:doc];
  if (![((OrgApacheLuceneUtilSentinelIntSet *) nil_chk(ordSet_)) existsWithInt:key]) {
    [ordSet_ putWithInt:key];
    OrgApacheLuceneUtilBytesRef *term;
    if (key == -1) {
      term = nil;
    }
    else {
      term = OrgApacheLuceneUtilBytesRef_deepCopyOfWithOrgApacheLuceneUtilBytesRef_([index_ lookupOrdWithInt:key]);
    }
    [((id<JavaUtilList>) nil_chk(groups_)) addWithId:term];
  }
}

- (id<JavaUtilCollection>)getGroups {
  return groups_;
}

- (void)doSetNextReaderWithOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)context {
  JreStrongAssign(&index_, OrgApacheLuceneIndexDocValues_getSortedWithOrgApacheLuceneIndexLeafReader_withNSString_([((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(context)) reader], groupField_));
  [((OrgApacheLuceneUtilSentinelIntSet *) nil_chk(ordSet_)) clear];
  for (OrgApacheLuceneUtilBytesRef * __strong countedGroup in nil_chk(groups_)) {
    if (countedGroup == nil) {
      [ordSet_ putWithInt:-1];
    }
    else {
      jint ord = [((OrgApacheLuceneIndexSortedDocValues *) nil_chk(index_)) lookupTermWithOrgApacheLuceneUtilBytesRef:countedGroup];
      if (ord >= 0) {
        [ordSet_ putWithInt:ord];
      }
    }
  }
}

- (jboolean)needsScores {
  return YES;
}

- (void)dealloc {
  RELEASE_(groupField_);
  RELEASE_(ordSet_);
  RELEASE_(groups_);
  RELEASE_(index_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithNSString:withInt:", "TermAllGroupsCollector", NULL, 0x1, NULL, NULL },
    { "initWithNSString:", "TermAllGroupsCollector", NULL, 0x1, NULL, NULL },
    { "collectWithInt:", "collect", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "getGroups", NULL, "Ljava.util.Collection;", 0x1, NULL, NULL },
    { "doSetNextReaderWithOrgApacheLuceneIndexLeafReaderContext:", "doSetNextReader", "V", 0x4, "Ljava.io.IOException;", NULL },
    { "needsScores", NULL, "Z", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "DEFAULT_INITIAL_SIZE", "DEFAULT_INITIAL_SIZE", 0x1a, "I", NULL, NULL, .constantValue.asInt = OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_DEFAULT_INITIAL_SIZE },
    { "groupField_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "ordSet_", NULL, 0x12, "Lorg.apache.lucene.util.SentinelIntSet;", NULL, NULL, .constantValue.asLong = 0 },
    { "groups_", NULL, 0x12, "Ljava.util.List;", NULL, "Ljava/util/List<Lorg/apache/lucene/util/BytesRef;>;", .constantValue.asLong = 0 },
    { "index_", NULL, 0x2, "Lorg.apache.lucene.index.SortedDocValues;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *superclass_type_args[] = {"Lorg.apache.lucene.util.BytesRef;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector = { 2, "TermAllGroupsCollector", "org.apache.lucene.search.grouping.term", NULL, 0x1, 6, methods, 5, fields, 1, superclass_type_args, 0, NULL, NULL, "Lorg/apache/lucene/search/grouping/AbstractAllGroupsCollector<Lorg/apache/lucene/util/BytesRef;>;" };
  return &_OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector;
}

@end

void OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_withInt_(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector *self, NSString *groupField, jint initialSize) {
  OrgApacheLuceneSearchGroupingAbstractAllGroupsCollector_init(self);
  JreStrongAssignAndConsume(&self->ordSet_, new_OrgApacheLuceneUtilSentinelIntSet_initWithInt_withInt_(initialSize, -2));
  JreStrongAssignAndConsume(&self->groups_, new_JavaUtilArrayList_initWithInt_(initialSize));
  JreStrongAssign(&self->groupField_, groupField);
}

OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector *new_OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_withInt_(NSString *groupField, jint initialSize) {
  OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector *self = [OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector alloc];
  OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_withInt_(self, groupField, initialSize);
  return self;
}

void OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector *self, NSString *groupField) {
  OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_withInt_(self, groupField, OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_DEFAULT_INITIAL_SIZE);
}

OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector *new_OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_(NSString *groupField) {
  OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector *self = [OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector alloc];
  OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector_initWithNSString_(self, groupField);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchGroupingTermTermAllGroupsCollector)

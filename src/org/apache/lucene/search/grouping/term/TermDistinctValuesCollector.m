//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./grouping/src/java/org/apache/lucene/search/grouping/term/TermDistinctValuesCollector.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/util/ArrayList.h"
#include "java/util/Arrays.h"
#include "java/util/Collection.h"
#include "java/util/List.h"
#include "java/util/Set.h"
#include "org/apache/lucene/index/DocValues.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/index/SortedDocValues.h"
#include "org/apache/lucene/search/grouping/AbstractDistinctValuesCollector.h"
#include "org/apache/lucene/search/grouping/SearchGroup.h"
#include "org/apache/lucene/search/grouping/term/TermDistinctValuesCollector.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/SentinelIntSet.h"

@interface OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector () {
 @public
  NSString *groupField_;
  NSString *countField_;
  id<JavaUtilList> groups_;
  OrgApacheLuceneUtilSentinelIntSet *ordSet_;
  IOSObjectArray *groupCounts_;
  OrgApacheLuceneIndexSortedDocValues *groupFieldTermIndex_;
  OrgApacheLuceneIndexSortedDocValues *countFieldTermIndex_;
}

- (jboolean)doesNotContainOrdWithInt:(jint)ord
                        withIntArray:(IOSIntArray *)ords;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector, groupField_, NSString *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector, countField_, NSString *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector, groups_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector, ordSet_, OrgApacheLuceneUtilSentinelIntSet *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector, groupCounts_, IOSObjectArray *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector, groupFieldTermIndex_, OrgApacheLuceneIndexSortedDocValues *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector, countFieldTermIndex_, OrgApacheLuceneIndexSortedDocValues *)

__attribute__((unused)) static jboolean OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_doesNotContainOrdWithInt_withIntArray_(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector *self, jint ord, IOSIntArray *ords);

@implementation OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector

- (instancetype)initWithNSString:(NSString *)groupField
                    withNSString:(NSString *)countField
          withJavaUtilCollection:(id<JavaUtilCollection>)groups {
  OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_initWithNSString_withNSString_withJavaUtilCollection_(self, groupField, countField, groups);
  return self;
}

- (void)collectWithInt:(jint)doc {
  jint slot = [((OrgApacheLuceneUtilSentinelIntSet *) nil_chk(ordSet_)) findWithInt:[((OrgApacheLuceneIndexSortedDocValues *) nil_chk(groupFieldTermIndex_)) getOrdWithInt:doc]];
  if (slot < 0) {
    return;
  }
  OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount *gc = IOSObjectArray_Get(nil_chk(groupCounts_), slot);
  jint countOrd = [((OrgApacheLuceneIndexSortedDocValues *) nil_chk(countFieldTermIndex_)) getOrdWithInt:doc];
  if (OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_doesNotContainOrdWithInt_withIntArray_(self, countOrd, ((OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount *) nil_chk(gc))->ords_)) {
    if (countOrd == -1) {
      [((id<JavaUtilSet>) nil_chk(gc->uniqueValues_)) addWithId:nil];
    }
    else {
      OrgApacheLuceneUtilBytesRef *term = OrgApacheLuceneUtilBytesRef_deepCopyOfWithOrgApacheLuceneUtilBytesRef_([countFieldTermIndex_ lookupOrdWithInt:countOrd]);
      [((id<JavaUtilSet>) nil_chk(gc->uniqueValues_)) addWithId:term];
    }
    JreStrongAssign(&gc->ords_, JavaUtilArrays_copyOfWithIntArray_withInt_(gc->ords_, ((IOSIntArray *) nil_chk(gc->ords_))->size_ + 1));
    *IOSIntArray_GetRef(gc->ords_, ((IOSIntArray *) nil_chk(gc->ords_))->size_ - 1) = countOrd;
    if (gc->ords_->size_ > 1) {
      JavaUtilArrays_sortWithIntArray_(gc->ords_);
    }
  }
}

- (jboolean)doesNotContainOrdWithInt:(jint)ord
                        withIntArray:(IOSIntArray *)ords {
  return OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_doesNotContainOrdWithInt_withIntArray_(self, ord, ords);
}

- (id<JavaUtilList>)getGroups {
  return groups_;
}

- (void)doSetNextReaderWithOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)context {
  JreStrongAssign(&groupFieldTermIndex_, OrgApacheLuceneIndexDocValues_getSortedWithOrgApacheLuceneIndexLeafReader_withNSString_([((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(context)) reader], groupField_));
  JreStrongAssign(&countFieldTermIndex_, OrgApacheLuceneIndexDocValues_getSortedWithOrgApacheLuceneIndexLeafReader_withNSString_([context reader], countField_));
  [((OrgApacheLuceneUtilSentinelIntSet *) nil_chk(ordSet_)) clear];
  for (OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount * __strong group in nil_chk(groups_)) {
    jint groupOrd = ((OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount *) nil_chk(group))->groupValue_ == nil ? -1 : [((OrgApacheLuceneIndexSortedDocValues *) nil_chk(groupFieldTermIndex_)) lookupTermWithOrgApacheLuceneUtilBytesRef:group->groupValue_];
    if (group->groupValue_ != nil && groupOrd < 0) {
      continue;
    }
    IOSObjectArray_Set(nil_chk(groupCounts_), [ordSet_ putWithInt:groupOrd], group);
    JreStrongAssignAndConsume(&group->ords_, [IOSIntArray newArrayWithLength:[((id<JavaUtilSet>) nil_chk(group->uniqueValues_)) size]]);
    JavaUtilArrays_fillWithIntArray_withInt_(group->ords_, -2);
    jint i = 0;
    for (OrgApacheLuceneUtilBytesRef * __strong value in group->uniqueValues_) {
      jint countOrd = value == nil ? -1 : [((OrgApacheLuceneIndexSortedDocValues *) nil_chk(countFieldTermIndex_)) lookupTermWithOrgApacheLuceneUtilBytesRef:value];
      if (value == nil || countOrd >= 0) {
        *IOSIntArray_GetRef(group->ords_, i++) = countOrd;
      }
    }
  }
}

- (jboolean)needsScores {
  return YES;
}

- (void)dealloc {
  RELEASE_(groupField_);
  RELEASE_(countField_);
  RELEASE_(groups_);
  RELEASE_(ordSet_);
  RELEASE_(groupCounts_);
  RELEASE_(groupFieldTermIndex_);
  RELEASE_(countFieldTermIndex_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithNSString:withNSString:withJavaUtilCollection:", "TermDistinctValuesCollector", NULL, 0x1, NULL, NULL },
    { "collectWithInt:", "collect", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "doesNotContainOrdWithInt:withIntArray:", "doesNotContainOrd", "Z", 0x2, NULL, NULL },
    { "getGroups", NULL, "Ljava.util.List;", 0x1, NULL, NULL },
    { "doSetNextReaderWithOrgApacheLuceneIndexLeafReaderContext:", "doSetNextReader", "V", 0x4, "Ljava.io.IOException;", NULL },
    { "needsScores", NULL, "Z", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "groupField_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "countField_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "groups_", NULL, 0x12, "Ljava.util.List;", NULL, "Ljava/util/List<Lorg/apache/lucene/search/grouping/term/TermDistinctValuesCollector$GroupCount;>;", .constantValue.asLong = 0 },
    { "ordSet_", NULL, 0x12, "Lorg.apache.lucene.util.SentinelIntSet;", NULL, NULL, .constantValue.asLong = 0 },
    { "groupCounts_", NULL, 0x12, "[Lorg.apache.lucene.search.grouping.term.TermDistinctValuesCollector$GroupCount;", NULL, NULL, .constantValue.asLong = 0 },
    { "groupFieldTermIndex_", NULL, 0x2, "Lorg.apache.lucene.index.SortedDocValues;", NULL, NULL, .constantValue.asLong = 0 },
    { "countFieldTermIndex_", NULL, 0x2, "Lorg.apache.lucene.index.SortedDocValues;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *superclass_type_args[] = {"Lorg.apache.lucene.search.grouping.term.TermDistinctValuesCollector$GroupCount;"};
  static const char *inner_classes[] = {"Lorg.apache.lucene.search.grouping.term.TermDistinctValuesCollector$GroupCount;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector = { 2, "TermDistinctValuesCollector", "org.apache.lucene.search.grouping.term", NULL, 0x1, 6, methods, 7, fields, 1, superclass_type_args, 1, inner_classes, NULL, "Lorg/apache/lucene/search/grouping/AbstractDistinctValuesCollector<Lorg/apache/lucene/search/grouping/term/TermDistinctValuesCollector$GroupCount;>;" };
  return &_OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector;
}

@end

void OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_initWithNSString_withNSString_withJavaUtilCollection_(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector *self, NSString *groupField, NSString *countField, id<JavaUtilCollection> groups) {
  OrgApacheLuceneSearchGroupingAbstractDistinctValuesCollector_init(self);
  JreStrongAssign(&self->groupField_, groupField);
  JreStrongAssign(&self->countField_, countField);
  JreStrongAssignAndConsume(&self->groups_, new_JavaUtilArrayList_initWithInt_([((id<JavaUtilCollection>) nil_chk(groups)) size]));
  for (OrgApacheLuceneSearchGroupingSearchGroup * __strong group in groups) {
    [self->groups_ addWithId:[new_OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount_initWithOrgApacheLuceneUtilBytesRef_(((OrgApacheLuceneSearchGroupingSearchGroup *) nil_chk(group))->groupValue_) autorelease]];
  }
  JreStrongAssignAndConsume(&self->ordSet_, new_OrgApacheLuceneUtilSentinelIntSet_initWithInt_withInt_([groups size], -2));
  JreStrongAssignAndConsume(&self->groupCounts_, [IOSObjectArray newArrayWithLength:((IOSIntArray *) nil_chk(self->ordSet_->keys_))->size_ type:OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount_class_()]);
}

OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector *new_OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_initWithNSString_withNSString_withJavaUtilCollection_(NSString *groupField, NSString *countField, id<JavaUtilCollection> groups) {
  OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector *self = [OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector alloc];
  OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_initWithNSString_withNSString_withJavaUtilCollection_(self, groupField, countField, groups);
  return self;
}

jboolean OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_doesNotContainOrdWithInt_withIntArray_(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector *self, jint ord, IOSIntArray *ords) {
  if (((IOSIntArray *) nil_chk(ords))->size_ == 0) {
    return YES;
  }
  else if (ords->size_ == 1) {
    return ord != IOSIntArray_Get(ords, 0);
  }
  return JavaUtilArrays_binarySearchWithIntArray_withInt_(ords, ord) < 0;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector)

@implementation OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount

- (instancetype)initWithOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)groupValue {
  OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount_initWithOrgApacheLuceneUtilBytesRef_(self, groupValue);
  return self;
}

- (void)dealloc {
  RELEASE_(ords_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneUtilBytesRef:", "GroupCount", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "ords_", NULL, 0x0, "[I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *superclass_type_args[] = {"Lorg.apache.lucene.util.BytesRef;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount = { 2, "GroupCount", "org.apache.lucene.search.grouping.term", "TermDistinctValuesCollector", 0x9, 1, methods, 1, fields, 1, superclass_type_args, 0, NULL, NULL, "Lorg/apache/lucene/search/grouping/AbstractDistinctValuesCollector$GroupCount<Lorg/apache/lucene/util/BytesRef;>;" };
  return &_OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount;
}

@end

void OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount_initWithOrgApacheLuceneUtilBytesRef_(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount *self, OrgApacheLuceneUtilBytesRef *groupValue) {
  OrgApacheLuceneSearchGroupingAbstractDistinctValuesCollector_GroupCount_initWithId_(self, groupValue);
}

OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount *new_OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount_initWithOrgApacheLuceneUtilBytesRef_(OrgApacheLuceneUtilBytesRef *groupValue) {
  OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount *self = [OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount alloc];
  OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount_initWithOrgApacheLuceneUtilBytesRef_(self, groupValue);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchGroupingTermTermDistinctValuesCollector_GroupCount)

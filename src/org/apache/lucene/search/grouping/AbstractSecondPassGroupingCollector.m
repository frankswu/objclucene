//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./grouping/src/java/org/apache/lucene/search/grouping/AbstractSecondPassGroupingCollector.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Float.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Math.h"
#include "java/util/Collection.h"
#include "java/util/HashMap.h"
#include "java/util/Map.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/search/LeafCollector.h"
#include "org/apache/lucene/search/Scorer.h"
#include "org/apache/lucene/search/SimpleCollector.h"
#include "org/apache/lucene/search/Sort.h"
#include "org/apache/lucene/search/TopDocs.h"
#include "org/apache/lucene/search/TopDocsCollector.h"
#include "org/apache/lucene/search/TopFieldCollector.h"
#include "org/apache/lucene/search/TopScoreDocCollector.h"
#include "org/apache/lucene/search/grouping/AbstractSecondPassGroupingCollector.h"
#include "org/apache/lucene/search/grouping/GroupDocs.h"
#include "org/apache/lucene/search/grouping/SearchGroup.h"
#include "org/apache/lucene/search/grouping/TopGroups.h"

@interface OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector () {
 @public
  jint maxDocsPerGroup_;
  id<JavaUtilCollection> groups_;
  OrgApacheLuceneSearchSort *withinGroupSort_;
  OrgApacheLuceneSearchSort *groupSort_;
  jint totalHitCount_;
  jint totalGroupedHitCount_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector, groups_, id<JavaUtilCollection>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector, withinGroupSort_, OrgApacheLuceneSearchSort *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector, groupSort_, OrgApacheLuceneSearchSort *)

@implementation OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector

- (instancetype)initWithJavaUtilCollection:(id<JavaUtilCollection>)groups
             withOrgApacheLuceneSearchSort:(OrgApacheLuceneSearchSort *)groupSort
             withOrgApacheLuceneSearchSort:(OrgApacheLuceneSearchSort *)withinGroupSort
                                   withInt:(jint)maxDocsPerGroup
                               withBoolean:(jboolean)getScores
                               withBoolean:(jboolean)getMaxScores
                               withBoolean:(jboolean)fillSortFields {
  OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_initWithJavaUtilCollection_withOrgApacheLuceneSearchSort_withOrgApacheLuceneSearchSort_withInt_withBoolean_withBoolean_withBoolean_(self, groups, groupSort, withinGroupSort, maxDocsPerGroup, getScores, getMaxScores, fillSortFields);
  return self;
}

- (void)setScorerWithOrgApacheLuceneSearchScorer:(OrgApacheLuceneSearchScorer *)scorer {
  for (OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs * __strong group in nil_chk([((id<JavaUtilMap>) nil_chk(groupMap_)) values])) {
    [((id<OrgApacheLuceneSearchLeafCollector>) nil_chk(((OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *) nil_chk(group))->leafCollector_)) setScorerWithOrgApacheLuceneSearchScorer:scorer];
  }
}

- (void)collectWithInt:(jint)doc {
  totalHitCount_++;
  OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *group = [self retrieveGroupWithInt:doc];
  if (group != nil) {
    totalGroupedHitCount_++;
    [((id<OrgApacheLuceneSearchLeafCollector>) nil_chk(group->leafCollector_)) collectWithInt:doc];
  }
}

- (OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *)retrieveGroupWithInt:(jint)doc {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (void)doSetNextReaderWithOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)readerContext {
  for (OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs * __strong group in nil_chk([((id<JavaUtilMap>) nil_chk(groupMap_)) values])) {
    JreStrongAssign(&((OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *) nil_chk(group))->leafCollector_, [((OrgApacheLuceneSearchTopDocsCollector *) nil_chk(group->collector_)) getLeafCollectorWithOrgApacheLuceneIndexLeafReaderContext:readerContext]);
  }
}

- (OrgApacheLuceneSearchGroupingTopGroups *)getTopGroupsWithInt:(jint)withinGroupOffset {
  IOSObjectArray *groupDocsResult = (IOSObjectArray *) check_class_cast([IOSObjectArray arrayWithLength:[((id<JavaUtilCollection>) nil_chk(groups_)) size] type:OrgApacheLuceneSearchGroupingGroupDocs_class_()], [IOSObjectArray class]);
  jint groupIDX = 0;
  jfloat maxScore = JavaLangFloat_MIN_VALUE;
  for (OrgApacheLuceneSearchGroupingSearchGroup * __strong group in groups_) {
    OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *groupDocs = [((id<JavaUtilMap>) nil_chk(groupMap_)) getWithId:((OrgApacheLuceneSearchGroupingSearchGroup *) nil_chk(group))->groupValue_];
    OrgApacheLuceneSearchTopDocs *topDocs = [((OrgApacheLuceneSearchTopDocsCollector *) nil_chk(((OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *) nil_chk(groupDocs))->collector_)) topDocsWithInt:withinGroupOffset withInt:maxDocsPerGroup_];
    IOSObjectArray_SetAndConsume(groupDocsResult, groupIDX++, new_OrgApacheLuceneSearchGroupingGroupDocs_initWithFloat_withFloat_withInt_withOrgApacheLuceneSearchScoreDocArray_withId_withNSObjectArray_(JavaLangFloat_NaN, [((OrgApacheLuceneSearchTopDocs *) nil_chk(topDocs)) getMaxScore], topDocs->totalHits_, topDocs->scoreDocs_, groupDocs->groupValue_, group->sortValues_));
    maxScore = JavaLangMath_maxWithFloat_withFloat_(maxScore, [topDocs getMaxScore]);
  }
  return [new_OrgApacheLuceneSearchGroupingTopGroups_initWithOrgApacheLuceneSearchSortFieldArray_withOrgApacheLuceneSearchSortFieldArray_withInt_withInt_withOrgApacheLuceneSearchGroupingGroupDocsArray_withFloat_([((OrgApacheLuceneSearchSort *) nil_chk(groupSort_)) getSort], withinGroupSort_ == nil ? nil : [withinGroupSort_ getSort], totalHitCount_, totalGroupedHitCount_, groupDocsResult, maxScore) autorelease];
}

- (void)dealloc {
  RELEASE_(groupMap_);
  RELEASE_(groupDocs_);
  RELEASE_(groups_);
  RELEASE_(withinGroupSort_);
  RELEASE_(groupSort_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithJavaUtilCollection:withOrgApacheLuceneSearchSort:withOrgApacheLuceneSearchSort:withInt:withBoolean:withBoolean:withBoolean:", "AbstractSecondPassGroupingCollector", NULL, 0x1, "Ljava.io.IOException;", NULL },
    { "setScorerWithOrgApacheLuceneSearchScorer:", "setScorer", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "collectWithInt:", "collect", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "retrieveGroupWithInt:", "retrieveGroup", "Lorg.apache.lucene.search.grouping.AbstractSecondPassGroupingCollector$SearchGroupDocs;", 0x404, "Ljava.io.IOException;", NULL },
    { "doSetNextReaderWithOrgApacheLuceneIndexLeafReaderContext:", "doSetNextReader", "V", 0x4, "Ljava.io.IOException;", NULL },
    { "getTopGroupsWithInt:", "getTopGroups", "Lorg.apache.lucene.search.grouping.TopGroups;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "groupMap_", NULL, 0x14, "Ljava.util.Map;", NULL, "Ljava/util/Map<TGROUP_VALUE_TYPE;Lorg/apache/lucene/search/grouping/AbstractSecondPassGroupingCollector$SearchGroupDocs<TGROUP_VALUE_TYPE;>;>;", .constantValue.asLong = 0 },
    { "maxDocsPerGroup_", NULL, 0x12, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "groupDocs_", NULL, 0x4, "[Lorg.apache.lucene.search.grouping.AbstractSecondPassGroupingCollector$SearchGroupDocs;", NULL, "[Lorg/apache/lucene/search/grouping/AbstractSecondPassGroupingCollector$SearchGroupDocs<TGROUP_VALUE_TYPE;>;", .constantValue.asLong = 0 },
    { "groups_", NULL, 0x12, "Ljava.util.Collection;", NULL, "Ljava/util/Collection<Lorg/apache/lucene/search/grouping/SearchGroup<TGROUP_VALUE_TYPE;>;>;", .constantValue.asLong = 0 },
    { "withinGroupSort_", NULL, 0x12, "Lorg.apache.lucene.search.Sort;", NULL, NULL, .constantValue.asLong = 0 },
    { "groupSort_", NULL, 0x12, "Lorg.apache.lucene.search.Sort;", NULL, NULL, .constantValue.asLong = 0 },
    { "totalHitCount_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "totalGroupedHitCount_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.search.grouping.AbstractSecondPassGroupingCollector$SearchGroupDocs;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector = { 2, "AbstractSecondPassGroupingCollector", "org.apache.lucene.search.grouping", NULL, 0x401, 6, methods, 8, fields, 0, NULL, 1, inner_classes, NULL, "<GROUP_VALUE_TYPE:Ljava/lang/Object;>Lorg/apache/lucene/search/SimpleCollector;" };
  return &_OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector;
}

@end

void OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_initWithJavaUtilCollection_withOrgApacheLuceneSearchSort_withOrgApacheLuceneSearchSort_withInt_withBoolean_withBoolean_withBoolean_(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector *self, id<JavaUtilCollection> groups, OrgApacheLuceneSearchSort *groupSort, OrgApacheLuceneSearchSort *withinGroupSort, jint maxDocsPerGroup, jboolean getScores, jboolean getMaxScores, jboolean fillSortFields) {
  OrgApacheLuceneSearchSimpleCollector_init(self);
  if ([((id<JavaUtilCollection>) nil_chk(groups)) size] == 0) {
    @throw [new_JavaLangIllegalArgumentException_initWithNSString_(@"no groups to collect (groups.size() is 0)") autorelease];
  }
  JreStrongAssign(&self->groupSort_, groupSort);
  JreStrongAssign(&self->withinGroupSort_, withinGroupSort);
  JreStrongAssign(&self->groups_, groups);
  self->maxDocsPerGroup_ = maxDocsPerGroup;
  JreStrongAssignAndConsume(&self->groupMap_, new_JavaUtilHashMap_initWithInt_([groups size]));
  for (OrgApacheLuceneSearchGroupingSearchGroup * __strong group in groups) {
    OrgApacheLuceneSearchTopDocsCollector *collector;
    if (withinGroupSort == nil) {
      collector = OrgApacheLuceneSearchTopScoreDocCollector_createWithInt_(maxDocsPerGroup);
    }
    else {
      collector = OrgApacheLuceneSearchTopFieldCollector_createWithOrgApacheLuceneSearchSort_withInt_withBoolean_withBoolean_withBoolean_(withinGroupSort, maxDocsPerGroup, fillSortFields, getScores, getMaxScores);
    }
    [self->groupMap_ putWithId:((OrgApacheLuceneSearchGroupingSearchGroup *) nil_chk(group))->groupValue_ withId:[new_OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs_initWithOrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_withId_withOrgApacheLuceneSearchTopDocsCollector_(self, group->groupValue_, collector) autorelease]];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector)

@implementation OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs

- (instancetype)initWithOrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector:(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector *)outer$
                                                                                  withId:(id)groupValue
                                               withOrgApacheLuceneSearchTopDocsCollector:(OrgApacheLuceneSearchTopDocsCollector *)collector {
  OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs_initWithOrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_withId_withOrgApacheLuceneSearchTopDocsCollector_(self, outer$, groupValue, collector);
  return self;
}

- (void)dealloc {
  RELEASE_(groupValue_);
  RELEASE_(collector_);
  RELEASE_(leafCollector_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector:withId:withOrgApacheLuceneSearchTopDocsCollector:", "SearchGroupDocs", NULL, 0x1, NULL, "(Lorg/apache/lucene/search/grouping/AbstractSecondPassGroupingCollector;TGROUP_VALUE_TYPE;Lorg/apache/lucene/search/TopDocsCollector<*>;)V" },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "groupValue_", NULL, 0x11, "TGROUP_VALUE_TYPE;", NULL, "TGROUP_VALUE_TYPE;", .constantValue.asLong = 0 },
    { "collector_", NULL, 0x11, "Lorg.apache.lucene.search.TopDocsCollector;", NULL, "Lorg/apache/lucene/search/TopDocsCollector<*>;", .constantValue.asLong = 0 },
    { "leafCollector_", NULL, 0x1, "Lorg.apache.lucene.search.LeafCollector;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs = { 2, "SearchGroupDocs", "org.apache.lucene.search.grouping", "AbstractSecondPassGroupingCollector", 0x1, 1, methods, 3, fields, 0, NULL, 0, NULL, NULL, "<GROUP_VALUE_TYPE:Ljava/lang/Object;>Ljava/lang/Object;" };
  return &_OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs;
}

@end

void OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs_initWithOrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_withId_withOrgApacheLuceneSearchTopDocsCollector_(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *self, OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector *outer$, id groupValue, OrgApacheLuceneSearchTopDocsCollector *collector) {
  NSObject_init(self);
  JreStrongAssign(&self->groupValue_, groupValue);
  JreStrongAssign(&self->collector_, collector);
}

OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *new_OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs_initWithOrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_withId_withOrgApacheLuceneSearchTopDocsCollector_(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector *outer$, id groupValue, OrgApacheLuceneSearchTopDocsCollector *collector) {
  OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs *self = [OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs alloc];
  OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs_initWithOrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_withId_withOrgApacheLuceneSearchTopDocsCollector_(self, outer$, groupValue, collector);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchGroupingAbstractSecondPassGroupingCollector_SearchGroupDocs)

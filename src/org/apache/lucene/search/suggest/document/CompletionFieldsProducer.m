//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./suggest/src/java/org/apache/lucene/search/suggest/document/CompletionFieldsProducer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Closeable.h"
#include "java/io/IOException.h"
#include "java/lang/Throwable.h"
#include "java/util/ArrayList.h"
#include "java/util/Collection.h"
#include "java/util/Collections.h"
#include "java/util/HashMap.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "org/apache/lucene/codecs/CodecUtil.h"
#include "org/apache/lucene/codecs/FieldsProducer.h"
#include "org/apache/lucene/codecs/PostingsFormat.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/FieldInfos.h"
#include "org/apache/lucene/index/IndexFileNames.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentReadState.h"
#include "org/apache/lucene/index/Terms.h"
#include "org/apache/lucene/search/suggest/document/CompletionFieldsProducer.h"
#include "org/apache/lucene/search/suggest/document/CompletionPostingsFormat.h"
#include "org/apache/lucene/search/suggest/document/CompletionTerms.h"
#include "org/apache/lucene/search/suggest/document/CompletionsTermsReader.h"
#include "org/apache/lucene/store/ChecksumIndexInput.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IOContext.h"
#include "org/apache/lucene/store/IndexInput.h"
#include "org/apache/lucene/util/Accountable.h"
#include "org/apache/lucene/util/Accountables.h"
#include "org/apache/lucene/util/IOUtils.h"

@interface OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer () {
 @public
  OrgApacheLuceneCodecsFieldsProducer *delegateFieldsProducer_;
  id<JavaUtilMap> readers_;
  OrgApacheLuceneStoreIndexInput *dictIn_;
}

- (instancetype)initWithOrgApacheLuceneCodecsFieldsProducer:(OrgApacheLuceneCodecsFieldsProducer *)delegateFieldsProducer
                                            withJavaUtilMap:(id<JavaUtilMap>)readers;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer, delegateFieldsProducer_, OrgApacheLuceneCodecsFieldsProducer *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer, readers_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer, dictIn_, OrgApacheLuceneStoreIndexInput *)

__attribute__((unused)) static void OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneCodecsFieldsProducer_withJavaUtilMap_(OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *self, OrgApacheLuceneCodecsFieldsProducer *delegateFieldsProducer, id<JavaUtilMap> readers);

__attribute__((unused)) static OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *new_OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneCodecsFieldsProducer_withJavaUtilMap_(OrgApacheLuceneCodecsFieldsProducer *delegateFieldsProducer, id<JavaUtilMap> readers) NS_RETURNS_RETAINED;

@implementation OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer

- (instancetype)initWithOrgApacheLuceneCodecsFieldsProducer:(OrgApacheLuceneCodecsFieldsProducer *)delegateFieldsProducer
                                            withJavaUtilMap:(id<JavaUtilMap>)readers {
  OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneCodecsFieldsProducer_withJavaUtilMap_(self, delegateFieldsProducer, readers);
  return self;
}

- (instancetype)initWithOrgApacheLuceneIndexSegmentReadState:(OrgApacheLuceneIndexSegmentReadState *)state {
  OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneIndexSegmentReadState_(self, state);
  return self;
}

- (void)close {
  jboolean success = NO;
  @try {
    [((OrgApacheLuceneCodecsFieldsProducer *) nil_chk(delegateFieldsProducer_)) close];
    OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ dictIn_ } count:1 type:JavaIoCloseable_class_()]);
    success = YES;
  }
  @finally {
    if (success == NO) {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ delegateFieldsProducer_, dictIn_ } count:2 type:JavaIoCloseable_class_()]);
    }
  }
}

- (void)checkIntegrity {
  [((OrgApacheLuceneCodecsFieldsProducer *) nil_chk(delegateFieldsProducer_)) checkIntegrity];
}

- (OrgApacheLuceneCodecsFieldsProducer *)getMergeInstance {
  return [new_OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneCodecsFieldsProducer_withJavaUtilMap_(delegateFieldsProducer_, readers_) autorelease];
}

- (jlong)ramBytesUsed {
  jlong ramBytesUsed = [((OrgApacheLuceneCodecsFieldsProducer *) nil_chk(delegateFieldsProducer_)) ramBytesUsed];
  for (OrgApacheLuceneSearchSuggestDocumentCompletionsTermsReader * __strong reader in nil_chk([((id<JavaUtilMap>) nil_chk(readers_)) values])) {
    ramBytesUsed += [((OrgApacheLuceneSearchSuggestDocumentCompletionsTermsReader *) nil_chk(reader)) ramBytesUsed];
  }
  return ramBytesUsed;
}

- (id<JavaUtilCollection>)getChildResources {
  id<JavaUtilList> accountableList = [new_JavaUtilArrayList_init() autorelease];
  for (id<JavaUtilMap_Entry> __strong readerEntry in nil_chk([((id<JavaUtilMap>) nil_chk(readers_)) entrySet])) {
    [accountableList addWithId:OrgApacheLuceneUtilAccountables_namedAccountableWithNSString_withOrgApacheLuceneUtilAccountable_([((id<JavaUtilMap_Entry>) nil_chk(readerEntry)) getKey], [readerEntry getValue])];
  }
  return JavaUtilCollections_unmodifiableCollectionWithJavaUtilCollection_(accountableList);
}

- (id<JavaUtilIterator>)iterator {
  return [((id<JavaUtilSet>) nil_chk([((id<JavaUtilMap>) nil_chk(readers_)) keySet])) iterator];
}

- (OrgApacheLuceneIndexTerms *)termsWithNSString:(NSString *)field {
  OrgApacheLuceneIndexTerms *terms = [((OrgApacheLuceneCodecsFieldsProducer *) nil_chk(delegateFieldsProducer_)) termsWithNSString:field];
  if (terms == nil) {
    return nil;
  }
  return [new_OrgApacheLuceneSearchSuggestDocumentCompletionTerms_initWithOrgApacheLuceneIndexTerms_withOrgApacheLuceneSearchSuggestDocumentCompletionsTermsReader_(terms, [((id<JavaUtilMap>) nil_chk(readers_)) getWithId:field]) autorelease];
}

- (jint)size {
  return [((id<JavaUtilMap>) nil_chk(readers_)) size];
}

- (void)dealloc {
  RELEASE_(delegateFieldsProducer_);
  RELEASE_(readers_);
  RELEASE_(dictIn_);
  [super dealloc];
}

- (NSUInteger)countByEnumeratingWithState:(NSFastEnumerationState *)state objects:(__unsafe_unretained id *)stackbuf count:(NSUInteger)len {
  return JreDefaultFastEnumeration(self, state, stackbuf, len);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneCodecsFieldsProducer:withJavaUtilMap:", "CompletionFieldsProducer", NULL, 0x2, NULL, NULL },
    { "initWithOrgApacheLuceneIndexSegmentReadState:", "CompletionFieldsProducer", NULL, 0x0, "Ljava.io.IOException;", NULL },
    { "close", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "checkIntegrity", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "getMergeInstance", NULL, "Lorg.apache.lucene.codecs.FieldsProducer;", 0x1, "Ljava.io.IOException;", NULL },
    { "ramBytesUsed", NULL, "J", 0x1, NULL, NULL },
    { "getChildResources", NULL, "Ljava.util.Collection;", 0x1, NULL, NULL },
    { "iterator", NULL, "Ljava.util.Iterator;", 0x1, NULL, NULL },
    { "termsWithNSString:", "terms", "Lorg.apache.lucene.index.Terms;", 0x1, "Ljava.io.IOException;", NULL },
    { "size", NULL, "I", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "delegateFieldsProducer_", NULL, 0x2, "Lorg.apache.lucene.codecs.FieldsProducer;", NULL, NULL, .constantValue.asLong = 0 },
    { "readers_", NULL, 0x2, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/String;Lorg/apache/lucene/search/suggest/document/CompletionsTermsReader;>;", .constantValue.asLong = 0 },
    { "dictIn_", NULL, 0x2, "Lorg.apache.lucene.store.IndexInput;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer = { 2, "CompletionFieldsProducer", "org.apache.lucene.search.suggest.document", NULL, 0x10, 10, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer;
}

@end

void OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneCodecsFieldsProducer_withJavaUtilMap_(OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *self, OrgApacheLuceneCodecsFieldsProducer *delegateFieldsProducer, id<JavaUtilMap> readers) {
  OrgApacheLuceneCodecsFieldsProducer_init(self);
  JreStrongAssign(&self->delegateFieldsProducer_, delegateFieldsProducer);
  JreStrongAssign(&self->readers_, readers);
}

OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *new_OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneCodecsFieldsProducer_withJavaUtilMap_(OrgApacheLuceneCodecsFieldsProducer *delegateFieldsProducer, id<JavaUtilMap> readers) {
  OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *self = [OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer alloc];
  OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneCodecsFieldsProducer_withJavaUtilMap_(self, delegateFieldsProducer, readers);
  return self;
}

void OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneIndexSegmentReadState_(OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *self, OrgApacheLuceneIndexSegmentReadState *state) {
  OrgApacheLuceneCodecsFieldsProducer_init(self);
  NSString *indexFile = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentReadState *) nil_chk(state))->segmentInfo_))->name_, state->segmentSuffix_, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_INDEX_EXTENSION_);
  JreStrongAssign(&self->delegateFieldsProducer_, nil);
  jboolean success = NO;
  {
    JavaLangThrowable *__mainException = nil;
    OrgApacheLuceneStoreChecksumIndexInput *index = [((OrgApacheLuceneStoreDirectory *) nil_chk(state->directory_)) openChecksumInputWithNSString:indexFile withOrgApacheLuceneStoreIOContext:state->context_];
    @try {
      NSString *dictFile = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(state->segmentInfo_->name_, state->segmentSuffix_, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_DICT_EXTENSION_);
      JreStrongAssign(&self->dictIn_, [state->directory_ openInputWithNSString:dictFile withOrgApacheLuceneStoreIOContext:state->context_]);
      OrgApacheLuceneCodecsCodecUtil_checkIndexHeaderWithOrgApacheLuceneStoreDataInput_withNSString_withInt_withInt_withByteArray_withNSString_(self->dictIn_, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_CODEC_NAME_, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_COMPLETION_CODEC_VERSION, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_COMPLETION_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
      OrgApacheLuceneCodecsCodecUtil_retrieveChecksumWithOrgApacheLuceneStoreIndexInput_(self->dictIn_);
      OrgApacheLuceneCodecsCodecUtil_checkIndexHeaderWithOrgApacheLuceneStoreDataInput_withNSString_withInt_withInt_withByteArray_withNSString_(index, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_CODEC_NAME_, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_COMPLETION_CODEC_VERSION, OrgApacheLuceneSearchSuggestDocumentCompletionPostingsFormat_COMPLETION_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
      OrgApacheLuceneCodecsPostingsFormat *delegatePostingsFormat = OrgApacheLuceneCodecsPostingsFormat_forNameWithNSString_([((OrgApacheLuceneStoreChecksumIndexInput *) nil_chk(index)) readString]);
      JreStrongAssign(&self->delegateFieldsProducer_, [((OrgApacheLuceneCodecsPostingsFormat *) nil_chk(delegatePostingsFormat)) fieldsProducerWithOrgApacheLuceneIndexSegmentReadState:state]);
      jint numFields = [index readVInt];
      JreStrongAssignAndConsume(&self->readers_, new_JavaUtilHashMap_initWithInt_(numFields));
      for (jint i = 0; i < numFields; i++) {
        jint fieldNumber = [index readVInt];
        jlong offset = [index readVLong];
        jlong minWeight = [index readVLong];
        jlong maxWeight = [index readVLong];
        jbyte type = [index readByte];
        OrgApacheLuceneIndexFieldInfo *fieldInfo = [((OrgApacheLuceneIndexFieldInfos *) nil_chk(state->fieldInfos_)) fieldInfoWithInt:fieldNumber];
        [self->readers_ putWithId:((OrgApacheLuceneIndexFieldInfo *) nil_chk(fieldInfo))->name_ withId:[new_OrgApacheLuceneSearchSuggestDocumentCompletionsTermsReader_initWithOrgApacheLuceneStoreIndexInput_withLong_withLong_withLong_withByte_(self->dictIn_, offset, minWeight, maxWeight, type) autorelease]];
      }
      OrgApacheLuceneCodecsCodecUtil_checkFooterWithOrgApacheLuceneStoreChecksumIndexInput_(index);
      success = YES;
    }
    @finally {
      @try {
        [index close];
      }
      @catch (JavaLangThrowable *e) {
        if (__mainException) {
          [__mainException addSuppressedWithJavaLangThrowable:e];
        } else {
          __mainException = e;
        }
      }
      if (success == NO) {
        OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ self->delegateFieldsProducer_, self->dictIn_ } count:2 type:JavaIoCloseable_class_()]);
      }
      if (__mainException) {
        @throw __mainException;
      }
    }
  }
}

OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *new_OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneIndexSegmentReadState_(OrgApacheLuceneIndexSegmentReadState *state) {
  OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer *self = [OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer alloc];
  OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer_initWithOrgApacheLuceneIndexSegmentReadState_(self, state);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSuggestDocumentCompletionFieldsProducer)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/search/similarities/BM25Similarity.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Math.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"
#include "org/apache/lucene/index/FieldInvertState.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/index/NumericDocValues.h"
#include "org/apache/lucene/search/CollectionStatistics.h"
#include "org/apache/lucene/search/Explanation.h"
#include "org/apache/lucene/search/TermStatistics.h"
#include "org/apache/lucene/search/similarities/BM25Similarity.h"
#include "org/apache/lucene/search/similarities/Similarity.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/SmallFloat.h"

@class OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats;

@interface OrgApacheLuceneSearchSimilaritiesBM25Similarity () {
 @public
  jfloat k1_;
  jfloat b_;
}

- (OrgApacheLuceneSearchExplanation *)explainTFNormWithInt:(jint)doc
                      withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)freq
withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *)stats
                  withOrgApacheLuceneIndexNumericDocValues:(OrgApacheLuceneIndexNumericDocValues *)norms;

- (OrgApacheLuceneSearchExplanation *)explainScoreWithInt:(jint)doc
                     withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)freq
withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *)stats
                 withOrgApacheLuceneIndexNumericDocValues:(OrgApacheLuceneIndexNumericDocValues *)norms;

@end

/*!
 @brief Cache of decoded bytes.
 */
inline IOSFloatArray *OrgApacheLuceneSearchSimilaritiesBM25Similarity_get_NORM_TABLE();
static IOSFloatArray *OrgApacheLuceneSearchSimilaritiesBM25Similarity_NORM_TABLE;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgApacheLuceneSearchSimilaritiesBM25Similarity, NORM_TABLE, IOSFloatArray *)

__attribute__((unused)) static OrgApacheLuceneSearchExplanation *OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainTFNormWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *self, jint doc, OrgApacheLuceneSearchExplanation *freq, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms);

__attribute__((unused)) static OrgApacheLuceneSearchExplanation *OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainScoreWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *self, jint doc, OrgApacheLuceneSearchExplanation *freq, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms);

@interface OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer : OrgApacheLuceneSearchSimilaritiesSimilarity_SimScorer {
 @public
  OrgApacheLuceneSearchSimilaritiesBM25Similarity *this$0_;
  OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats_;
  jfloat weightValue_;
  OrgApacheLuceneIndexNumericDocValues *norms_;
  IOSFloatArray *cache_;
}

- (instancetype)initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity:(OrgApacheLuceneSearchSimilaritiesBM25Similarity *)outer$
          withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *)stats
                               withOrgApacheLuceneIndexNumericDocValues:(OrgApacheLuceneIndexNumericDocValues *)norms;

- (jfloat)scoreWithInt:(jint)doc
             withFloat:(jfloat)freq;

- (OrgApacheLuceneSearchExplanation *)explainWithInt:(jint)doc
                withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)freq;

- (jfloat)computeSlopFactorWithInt:(jint)distance;

- (jfloat)computePayloadFactorWithInt:(jint)doc
                              withInt:(jint)start
                              withInt:(jint)end
      withOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)payload;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer)

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer, this$0_, OrgApacheLuceneSearchSimilaritiesBM25Similarity *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer, stats_, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer, norms_, OrgApacheLuceneIndexNumericDocValues *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer, cache_, IOSFloatArray *)

__attribute__((unused)) static void OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer *self, OrgApacheLuceneSearchSimilaritiesBM25Similarity *outer$, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms);

__attribute__((unused)) static OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer *new_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *outer$, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer *create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *outer$, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms);

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer)

/*!
 @brief Collection statistics for the BM25 model.
 */
@interface OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats : OrgApacheLuceneSearchSimilaritiesSimilarity_SimWeight {
 @public
  /*!
   @brief BM25's idf
   */
  OrgApacheLuceneSearchExplanation *idf_;
  /*!
   @brief The average document length.
   */
  jfloat avgdl_;
  /*!
   @brief query's inner boost
   */
  jfloat queryBoost_;
  /*!
   @brief query's outer boost (only for explain)
   */
  jfloat topLevelBoost_;
  /*!
   @brief weight (idf * boost)
   */
  jfloat weight_;
  /*!
   @brief field name, for pulling norms
   */
  NSString *field_;
  /*!
   @brief precomputed norm[256] with k1 * ((1 - b) + b * dl / avgdl)
   */
  IOSFloatArray *cache_;
}

- (instancetype)initWithNSString:(NSString *)field
withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)idf
                       withFloat:(jfloat)queryBoost
                       withFloat:(jfloat)avgdl
                  withFloatArray:(IOSFloatArray *)cache;

- (jfloat)getValueForNormalization;

- (void)normalizeWithFloat:(jfloat)queryNorm
                 withFloat:(jfloat)topLevelBoost;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats)

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats, idf_, OrgApacheLuceneSearchExplanation *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats, field_, NSString *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats, cache_, IOSFloatArray *)

__attribute__((unused)) static void OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *self, NSString *field, OrgApacheLuceneSearchExplanation *idf, jfloat queryBoost, jfloat avgdl, IOSFloatArray *cache);

__attribute__((unused)) static OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *new_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_(NSString *field, OrgApacheLuceneSearchExplanation *idf, jfloat queryBoost, jfloat avgdl, IOSFloatArray *cache) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_(NSString *field, OrgApacheLuceneSearchExplanation *idf, jfloat queryBoost, jfloat avgdl, IOSFloatArray *cache);

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneSearchSimilaritiesBM25Similarity)

@implementation OrgApacheLuceneSearchSimilaritiesBM25Similarity

- (instancetype)initWithFloat:(jfloat)k1
                    withFloat:(jfloat)b {
  OrgApacheLuceneSearchSimilaritiesBM25Similarity_initWithFloat_withFloat_(self, k1, b);
  return self;
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneSearchSimilaritiesBM25Similarity_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (jfloat)idfWithLong:(jlong)docFreq
             withLong:(jlong)numDocs {
  return (jfloat) JavaLangMath_logWithDouble_(1 + (numDocs - docFreq + 0.5) / (docFreq + 0.5));
}

- (jfloat)sloppyFreqWithInt:(jint)distance {
  return 1.0f / (distance + 1);
}

- (jfloat)scorePayloadWithInt:(jint)doc
                      withInt:(jint)start
                      withInt:(jint)end
withOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)payload {
  return 1;
}

- (jfloat)avgFieldLengthWithOrgApacheLuceneSearchCollectionStatistics:(OrgApacheLuceneSearchCollectionStatistics *)collectionStats {
  jlong sumTotalTermFreq = [((OrgApacheLuceneSearchCollectionStatistics *) nil_chk(collectionStats)) sumTotalTermFreq];
  if (sumTotalTermFreq <= 0) {
    return 1.0f;
  }
  else {
    return (jfloat) (sumTotalTermFreq / (jdouble) [collectionStats maxDoc]);
  }
}

- (jbyte)encodeNormValueWithFloat:(jfloat)boost
                          withInt:(jint)fieldLength {
  return OrgApacheLuceneUtilSmallFloat_floatToByte315WithFloat_(boost / (jfloat) JavaLangMath_sqrtWithDouble_(fieldLength));
}

- (jfloat)decodeNormValueWithByte:(jbyte)b {
  return IOSFloatArray_Get(nil_chk(OrgApacheLuceneSearchSimilaritiesBM25Similarity_NORM_TABLE), b & (jint) 0xFF);
}

- (void)setDiscountOverlapsWithBoolean:(jboolean)v {
  discountOverlaps_ = v;
}

- (jboolean)getDiscountOverlaps {
  return discountOverlaps_;
}

- (jlong)computeNormWithOrgApacheLuceneIndexFieldInvertState:(OrgApacheLuceneIndexFieldInvertState *)state {
  jint numTerms = discountOverlaps_ ? [((OrgApacheLuceneIndexFieldInvertState *) nil_chk(state)) getLength] - [state getNumOverlap] : [((OrgApacheLuceneIndexFieldInvertState *) nil_chk(state)) getLength];
  return [self encodeNormValueWithFloat:[state getBoost] withInt:numTerms];
}

- (OrgApacheLuceneSearchExplanation *)idfExplainWithOrgApacheLuceneSearchCollectionStatistics:(OrgApacheLuceneSearchCollectionStatistics *)collectionStats
                                                      withOrgApacheLuceneSearchTermStatistics:(OrgApacheLuceneSearchTermStatistics *)termStats {
  jlong df = [((OrgApacheLuceneSearchTermStatistics *) nil_chk(termStats)) docFreq];
  jlong max = [((OrgApacheLuceneSearchCollectionStatistics *) nil_chk(collectionStats)) maxDoc];
  jfloat idf = [self idfWithLong:df withLong:max];
  return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(idf, JreStrcat("$J$JC", @"idf(docFreq=", df, @", maxDocs=", max, ')'), [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()]);
}

- (OrgApacheLuceneSearchExplanation *)idfExplainWithOrgApacheLuceneSearchCollectionStatistics:(OrgApacheLuceneSearchCollectionStatistics *)collectionStats
                                                 withOrgApacheLuceneSearchTermStatisticsArray:(IOSObjectArray *)termStats {
  jlong max = [((OrgApacheLuceneSearchCollectionStatistics *) nil_chk(collectionStats)) maxDoc];
  jfloat idf = 0.0f;
  id<JavaUtilList> details = create_JavaUtilArrayList_init();
  {
    IOSObjectArray *a__ = termStats;
    OrgApacheLuceneSearchTermStatistics * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    OrgApacheLuceneSearchTermStatistics * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      OrgApacheLuceneSearchTermStatistics *stat = *b__++;
      jlong df = [((OrgApacheLuceneSearchTermStatistics *) nil_chk(stat)) docFreq];
      jfloat termIdf = [self idfWithLong:df withLong:max];
      [details addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(termIdf, JreStrcat("$J$JC", @"idf(docFreq=", df, @", maxDocs=", max, ')'), [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
      JrePlusAssignFloatF(&idf, termIdf);
    }
  }
  return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withJavaUtilCollection_(idf, @"idf(), sum of:", details);
}

- (OrgApacheLuceneSearchSimilaritiesSimilarity_SimWeight *)computeWeightWithFloat:(jfloat)queryBoost
                                    withOrgApacheLuceneSearchCollectionStatistics:(OrgApacheLuceneSearchCollectionStatistics *)collectionStats
                                     withOrgApacheLuceneSearchTermStatisticsArray:(IOSObjectArray *)termStats {
  OrgApacheLuceneSearchExplanation *idf = ((IOSObjectArray *) nil_chk(termStats))->size_ == 1 ? [self idfExplainWithOrgApacheLuceneSearchCollectionStatistics:collectionStats withOrgApacheLuceneSearchTermStatistics:IOSObjectArray_Get(termStats, 0)] : [self idfExplainWithOrgApacheLuceneSearchCollectionStatistics:collectionStats withOrgApacheLuceneSearchTermStatisticsArray:termStats];
  jfloat avgdl = [self avgFieldLengthWithOrgApacheLuceneSearchCollectionStatistics:collectionStats];
  IOSFloatArray *cache = [IOSFloatArray arrayWithLength:256];
  for (jint i = 0; i < cache->size_; i++) {
    *IOSFloatArray_GetRef(cache, i) = k1_ * ((1 - b_) + b_ * [self decodeNormValueWithByte:(jbyte) i] / avgdl);
  }
  return create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_([((OrgApacheLuceneSearchCollectionStatistics *) nil_chk(collectionStats)) field], idf, queryBoost, avgdl, cache);
}

- (OrgApacheLuceneSearchSimilaritiesSimilarity_SimScorer *)simScorerWithOrgApacheLuceneSearchSimilaritiesSimilarity_SimWeight:(OrgApacheLuceneSearchSimilaritiesSimilarity_SimWeight *)stats
                                                                                    withOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)context {
  OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *bm25stats = (OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *) cast_chk(stats, [OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats class]);
  return create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(self, bm25stats, [((OrgApacheLuceneIndexLeafReader *) nil_chk([((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(context)) reader])) getNormValuesWithNSString:((OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *) nil_chk(bm25stats))->field_]);
}

- (OrgApacheLuceneSearchExplanation *)explainTFNormWithInt:(jint)doc
                      withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)freq
withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *)stats
                  withOrgApacheLuceneIndexNumericDocValues:(OrgApacheLuceneIndexNumericDocValues *)norms {
  return OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainTFNormWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(self, doc, freq, stats, norms);
}

- (OrgApacheLuceneSearchExplanation *)explainScoreWithInt:(jint)doc
                     withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)freq
withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *)stats
                 withOrgApacheLuceneIndexNumericDocValues:(OrgApacheLuceneIndexNumericDocValues *)norms {
  return OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainScoreWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(self, doc, freq, stats, norms);
}

- (NSString *)description {
  return JreStrcat("$F$FC", @"BM25(k1=", k1_, @",b=", b_, ')');
}

- (jfloat)getK1 {
  return k1_;
}

- (jfloat)getB {
  return b_;
}

+ (void)initialize {
  if (self == [OrgApacheLuceneSearchSimilaritiesBM25Similarity class]) {
    JreStrongAssignAndConsume(&OrgApacheLuceneSearchSimilaritiesBM25Similarity_NORM_TABLE, [IOSFloatArray newArrayWithLength:256]);
    {
      for (jint i = 0; i < 256; i++) {
        jfloat f = OrgApacheLuceneUtilSmallFloat_byte315ToFloatWithByte_((jbyte) i);
        *IOSFloatArray_GetRef(OrgApacheLuceneSearchSimilaritiesBM25Similarity_NORM_TABLE, i) = 1.0f / (f * f);
      }
    }
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneSearchSimilaritiesBM25Similarity)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithFloat:withFloat:", "BM25Similarity", NULL, 0x1, NULL, NULL },
    { "init", "BM25Similarity", NULL, 0x1, NULL, NULL },
    { "idfWithLong:withLong:", "idf", "F", 0x4, NULL, NULL },
    { "sloppyFreqWithInt:", "sloppyFreq", "F", 0x4, NULL, NULL },
    { "scorePayloadWithInt:withInt:withInt:withOrgApacheLuceneUtilBytesRef:", "scorePayload", "F", 0x4, NULL, NULL },
    { "avgFieldLengthWithOrgApacheLuceneSearchCollectionStatistics:", "avgFieldLength", "F", 0x4, NULL, NULL },
    { "encodeNormValueWithFloat:withInt:", "encodeNormValue", "B", 0x4, NULL, NULL },
    { "decodeNormValueWithByte:", "decodeNormValue", "F", 0x4, NULL, NULL },
    { "setDiscountOverlapsWithBoolean:", "setDiscountOverlaps", "V", 0x1, NULL, NULL },
    { "getDiscountOverlaps", NULL, "Z", 0x1, NULL, NULL },
    { "computeNormWithOrgApacheLuceneIndexFieldInvertState:", "computeNorm", "J", 0x11, NULL, NULL },
    { "idfExplainWithOrgApacheLuceneSearchCollectionStatistics:withOrgApacheLuceneSearchTermStatistics:", "idfExplain", "Lorg.apache.lucene.search.Explanation;", 0x1, NULL, NULL },
    { "idfExplainWithOrgApacheLuceneSearchCollectionStatistics:withOrgApacheLuceneSearchTermStatisticsArray:", "idfExplain", "Lorg.apache.lucene.search.Explanation;", 0x1, NULL, NULL },
    { "computeWeightWithFloat:withOrgApacheLuceneSearchCollectionStatistics:withOrgApacheLuceneSearchTermStatisticsArray:", "computeWeight", "Lorg.apache.lucene.search.similarities.Similarity$SimWeight;", 0x91, NULL, NULL },
    { "simScorerWithOrgApacheLuceneSearchSimilaritiesSimilarity_SimWeight:withOrgApacheLuceneIndexLeafReaderContext:", "simScorer", "Lorg.apache.lucene.search.similarities.Similarity$SimScorer;", 0x11, "Ljava.io.IOException;", NULL },
    { "explainTFNormWithInt:withOrgApacheLuceneSearchExplanation:withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:withOrgApacheLuceneIndexNumericDocValues:", "explainTFNorm", "Lorg.apache.lucene.search.Explanation;", 0x2, NULL, NULL },
    { "explainScoreWithInt:withOrgApacheLuceneSearchExplanation:withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:withOrgApacheLuceneIndexNumericDocValues:", "explainScore", "Lorg.apache.lucene.search.Explanation;", 0x2, NULL, NULL },
    { "description", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
    { "getK1", NULL, "F", 0x1, NULL, NULL },
    { "getB", NULL, "F", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "k1_", NULL, 0x12, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "b_", NULL, 0x12, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "discountOverlaps_", NULL, 0x4, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "NORM_TABLE", "NORM_TABLE", 0x1a, "[F", &OrgApacheLuceneSearchSimilaritiesBM25Similarity_NORM_TABLE, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.search.similarities.BM25Similarity$BM25DocScorer;", "Lorg.apache.lucene.search.similarities.BM25Similarity$BM25Stats;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSimilaritiesBM25Similarity = { 2, "BM25Similarity", "org.apache.lucene.search.similarities", NULL, 0x1, 20, methods, 4, fields, 0, NULL, 2, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneSearchSimilaritiesBM25Similarity;
}

@end

void OrgApacheLuceneSearchSimilaritiesBM25Similarity_initWithFloat_withFloat_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *self, jfloat k1, jfloat b) {
  OrgApacheLuceneSearchSimilaritiesSimilarity_init(self);
  self->discountOverlaps_ = true;
  self->k1_ = k1;
  self->b_ = b;
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity *new_OrgApacheLuceneSearchSimilaritiesBM25Similarity_initWithFloat_withFloat_(jfloat k1, jfloat b) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity, initWithFloat_withFloat_, k1, b)
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity *create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_initWithFloat_withFloat_(jfloat k1, jfloat b) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity, initWithFloat_withFloat_, k1, b)
}

void OrgApacheLuceneSearchSimilaritiesBM25Similarity_init(OrgApacheLuceneSearchSimilaritiesBM25Similarity *self) {
  OrgApacheLuceneSearchSimilaritiesSimilarity_init(self);
  self->discountOverlaps_ = true;
  self->k1_ = 1.2f;
  self->b_ = 0.75f;
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity *new_OrgApacheLuceneSearchSimilaritiesBM25Similarity_init() {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity, init)
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity *create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_init() {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity, init)
}

OrgApacheLuceneSearchExplanation *OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainTFNormWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *self, jint doc, OrgApacheLuceneSearchExplanation *freq, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms) {
  id<JavaUtilList> subs = create_JavaUtilArrayList_init();
  [subs addWithId:freq];
  [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(self->k1_, @"parameter k1", [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
  if (norms == nil) {
    [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(0, @"parameter b (norms omitted for field)", [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
    return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withJavaUtilCollection_(([((OrgApacheLuceneSearchExplanation *) nil_chk(freq)) getValue] * (self->k1_ + 1)) / ([freq getValue] + self->k1_), @"tfNorm, computed from:", subs);
  }
  else {
    jfloat doclen = [self decodeNormValueWithByte:(jbyte) [norms getWithInt:doc]];
    [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(self->b_, @"parameter b", [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
    [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(((OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *) nil_chk(stats))->avgdl_, @"avgFieldLength", [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
    [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(doclen, @"fieldLength", [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
    return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withJavaUtilCollection_(([((OrgApacheLuceneSearchExplanation *) nil_chk(freq)) getValue] * (self->k1_ + 1)) / ([freq getValue] + self->k1_ * (1 - self->b_ + self->b_ * doclen / stats->avgdl_)), @"tfNorm, computed from:", subs);
  }
}

OrgApacheLuceneSearchExplanation *OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainScoreWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *self, jint doc, OrgApacheLuceneSearchExplanation *freq, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms) {
  OrgApacheLuceneSearchExplanation *boostExpl = OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(((OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *) nil_chk(stats))->queryBoost_ * stats->topLevelBoost_, @"boost", [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()]);
  id<JavaUtilList> subs = create_JavaUtilArrayList_init();
  if ([((OrgApacheLuceneSearchExplanation *) nil_chk(boostExpl)) getValue] != 1.0f) [subs addWithId:boostExpl];
  [subs addWithId:stats->idf_];
  OrgApacheLuceneSearchExplanation *tfNormExpl = OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainTFNormWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(self, doc, freq, stats, norms);
  [subs addWithId:tfNormExpl];
  return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withJavaUtilCollection_([boostExpl getValue] * [((OrgApacheLuceneSearchExplanation *) nil_chk(stats->idf_)) getValue] * [((OrgApacheLuceneSearchExplanation *) nil_chk(tfNormExpl)) getValue], JreStrcat("$I$@$", @"score(doc=", doc, @",freq=", freq, @"), product of:"), subs);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSimilaritiesBM25Similarity)

@implementation OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer

- (instancetype)initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity:(OrgApacheLuceneSearchSimilaritiesBM25Similarity *)outer$
          withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *)stats
                               withOrgApacheLuceneIndexNumericDocValues:(OrgApacheLuceneIndexNumericDocValues *)norms {
  OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(self, outer$, stats, norms);
  return self;
}

- (jfloat)scoreWithInt:(jint)doc
             withFloat:(jfloat)freq {
  jfloat norm = norms_ == nil ? this$0_->k1_ : IOSFloatArray_Get(nil_chk(cache_), (jbyte) [norms_ getWithInt:doc] & (jint) 0xFF);
  return weightValue_ * freq / (freq + norm);
}

- (OrgApacheLuceneSearchExplanation *)explainWithInt:(jint)doc
                withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)freq {
  return OrgApacheLuceneSearchSimilaritiesBM25Similarity_explainScoreWithInt_withOrgApacheLuceneSearchExplanation_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(this$0_, doc, freq, stats_, norms_);
}

- (jfloat)computeSlopFactorWithInt:(jint)distance {
  return [this$0_ sloppyFreqWithInt:distance];
}

- (jfloat)computePayloadFactorWithInt:(jint)doc
                              withInt:(jint)start
                              withInt:(jint)end
      withOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)payload {
  return [this$0_ scorePayloadWithInt:doc withInt:start withInt:end withOrgApacheLuceneUtilBytesRef:payload];
}

- (void)dealloc {
  RELEASE_(this$0_);
  RELEASE_(stats_);
  RELEASE_(norms_);
  RELEASE_(cache_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity:withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats:withOrgApacheLuceneIndexNumericDocValues:", "BM25DocScorer", NULL, 0x0, NULL, NULL },
    { "scoreWithInt:withFloat:", "score", "F", 0x1, NULL, NULL },
    { "explainWithInt:withOrgApacheLuceneSearchExplanation:", "explain", "Lorg.apache.lucene.search.Explanation;", 0x1, NULL, NULL },
    { "computeSlopFactorWithInt:", "computeSlopFactor", "F", 0x1, NULL, NULL },
    { "computePayloadFactorWithInt:withInt:withInt:withOrgApacheLuceneUtilBytesRef:", "computePayloadFactor", "F", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lorg.apache.lucene.search.similarities.BM25Similarity;", NULL, NULL, .constantValue.asLong = 0 },
    { "stats_", NULL, 0x12, "Lorg.apache.lucene.search.similarities.BM25Similarity$BM25Stats;", NULL, NULL, .constantValue.asLong = 0 },
    { "weightValue_", NULL, 0x12, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "norms_", NULL, 0x12, "Lorg.apache.lucene.index.NumericDocValues;", NULL, NULL, .constantValue.asLong = 0 },
    { "cache_", NULL, 0x12, "[F", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer = { 2, "BM25DocScorer", "org.apache.lucene.search.similarities", "BM25Similarity", 0x2, 5, methods, 5, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer;
}

@end

void OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer *self, OrgApacheLuceneSearchSimilaritiesBM25Similarity *outer$, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms) {
  JreStrongAssign(&self->this$0_, outer$);
  OrgApacheLuceneSearchSimilaritiesSimilarity_SimScorer_init(self);
  JreStrongAssign(&self->stats_, stats);
  self->weightValue_ = ((OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *) nil_chk(stats))->weight_ * (outer$->k1_ + 1);
  JreStrongAssign(&self->cache_, stats->cache_);
  JreStrongAssign(&self->norms_, norms);
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer *new_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *outer$, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer, initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_, outer$, stats, norms)
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer *create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer_initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_(OrgApacheLuceneSearchSimilaritiesBM25Similarity *outer$, OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *stats, OrgApacheLuceneIndexNumericDocValues *norms) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer, initWithOrgApacheLuceneSearchSimilaritiesBM25Similarity_withOrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_withOrgApacheLuceneIndexNumericDocValues_, outer$, stats, norms)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25DocScorer)

@implementation OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats

- (instancetype)initWithNSString:(NSString *)field
withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)idf
                       withFloat:(jfloat)queryBoost
                       withFloat:(jfloat)avgdl
                  withFloatArray:(IOSFloatArray *)cache {
  OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_(self, field, idf, queryBoost, avgdl, cache);
  return self;
}

- (jfloat)getValueForNormalization {
  jfloat queryWeight = [((OrgApacheLuceneSearchExplanation *) nil_chk(idf_)) getValue] * queryBoost_;
  return queryWeight * queryWeight;
}

- (void)normalizeWithFloat:(jfloat)queryNorm
                 withFloat:(jfloat)topLevelBoost {
  self->topLevelBoost_ = topLevelBoost;
  self->weight_ = [((OrgApacheLuceneSearchExplanation *) nil_chk(idf_)) getValue] * queryBoost_ * topLevelBoost;
}

- (void)dealloc {
  RELEASE_(idf_);
  RELEASE_(field_);
  RELEASE_(cache_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithNSString:withOrgApacheLuceneSearchExplanation:withFloat:withFloat:withFloatArray:", "BM25Stats", NULL, 0x0, NULL, NULL },
    { "getValueForNormalization", NULL, "F", 0x1, NULL, NULL },
    { "normalizeWithFloat:withFloat:", "normalize", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "idf_", NULL, 0x12, "Lorg.apache.lucene.search.Explanation;", NULL, NULL, .constantValue.asLong = 0 },
    { "avgdl_", NULL, 0x12, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "queryBoost_", NULL, 0x12, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "topLevelBoost_", NULL, 0x2, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "weight_", NULL, 0x2, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "field_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "cache_", NULL, 0x12, "[F", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats = { 2, "BM25Stats", "org.apache.lucene.search.similarities", "BM25Similarity", 0xa, 3, methods, 7, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats;
}

@end

void OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *self, NSString *field, OrgApacheLuceneSearchExplanation *idf, jfloat queryBoost, jfloat avgdl, IOSFloatArray *cache) {
  OrgApacheLuceneSearchSimilaritiesSimilarity_SimWeight_init(self);
  JreStrongAssign(&self->field_, field);
  JreStrongAssign(&self->idf_, idf);
  self->queryBoost_ = queryBoost;
  self->avgdl_ = avgdl;
  JreStrongAssign(&self->cache_, cache);
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *new_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_(NSString *field, OrgApacheLuceneSearchExplanation *idf, jfloat queryBoost, jfloat avgdl, IOSFloatArray *cache) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats, initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_, field, idf, queryBoost, avgdl, cache)
}

OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats *create_OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats_initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_(NSString *field, OrgApacheLuceneSearchExplanation *idf, jfloat queryBoost, jfloat avgdl, IOSFloatArray *cache) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats, initWithNSString_withOrgApacheLuceneSearchExplanation_withFloat_withFloat_withFloatArray_, field, idf, queryBoost, avgdl, cache)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSimilaritiesBM25Similarity_BM25Stats)

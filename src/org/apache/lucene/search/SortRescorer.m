//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/search/SortRescorer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/util/ArrayList.h"
#include "java/util/Arrays.h"
#include "java/util/Comparator.h"
#include "java/util/List.h"
#include "org/apache/lucene/index/IndexReader.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/search/Explanation.h"
#include "org/apache/lucene/search/FakeScorer.h"
#include "org/apache/lucene/search/FieldDoc.h"
#include "org/apache/lucene/search/IndexSearcher.h"
#include "org/apache/lucene/search/LeafCollector.h"
#include "org/apache/lucene/search/Rescorer.h"
#include "org/apache/lucene/search/ScoreDoc.h"
#include "org/apache/lucene/search/Sort.h"
#include "org/apache/lucene/search/SortField.h"
#include "org/apache/lucene/search/SortRescorer.h"
#include "org/apache/lucene/search/TopDocs.h"
#include "org/apache/lucene/search/TopFieldCollector.h"
#include "org/apache/lucene/search/TopFieldDocs.h"

@interface OrgApacheLuceneSearchSortRescorer () {
 @public
  OrgApacheLuceneSearchSort *sort_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchSortRescorer, sort_, OrgApacheLuceneSearchSort *)

@interface OrgApacheLuceneSearchSortRescorer_$1 : NSObject < JavaUtilComparator >

- (jint)compareWithId:(OrgApacheLuceneSearchScoreDoc *)a
               withId:(OrgApacheLuceneSearchScoreDoc *)b;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneSearchSortRescorer_$1)

__attribute__((unused)) static void OrgApacheLuceneSearchSortRescorer_$1_init(OrgApacheLuceneSearchSortRescorer_$1 *self);

__attribute__((unused)) static OrgApacheLuceneSearchSortRescorer_$1 *new_OrgApacheLuceneSearchSortRescorer_$1_init() NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneSearchSortRescorer_$1 *create_OrgApacheLuceneSearchSortRescorer_$1_init();

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneSearchSortRescorer_$1)

@implementation OrgApacheLuceneSearchSortRescorer

- (instancetype)initWithOrgApacheLuceneSearchSort:(OrgApacheLuceneSearchSort *)sort {
  OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(self, sort);
  return self;
}

- (OrgApacheLuceneSearchTopDocs *)rescoreWithOrgApacheLuceneSearchIndexSearcher:(OrgApacheLuceneSearchIndexSearcher *)searcher
                                               withOrgApacheLuceneSearchTopDocs:(OrgApacheLuceneSearchTopDocs *)firstPassTopDocs
                                                                        withInt:(jint)topN {
  IOSObjectArray *hits = [((IOSObjectArray *) nil_chk(((OrgApacheLuceneSearchTopDocs *) nil_chk(firstPassTopDocs))->scoreDocs_)) clone];
  JavaUtilArrays_sortWithNSObjectArray_withJavaUtilComparator_(hits, create_OrgApacheLuceneSearchSortRescorer_$1_init());
  id<JavaUtilList> leaves = [((OrgApacheLuceneIndexIndexReader *) nil_chk([((OrgApacheLuceneSearchIndexSearcher *) nil_chk(searcher)) getIndexReader])) leaves];
  OrgApacheLuceneSearchTopFieldCollector *collector = OrgApacheLuceneSearchTopFieldCollector_createWithOrgApacheLuceneSearchSort_withInt_withBoolean_withBoolean_withBoolean_(sort_, topN, true, true, true);
  jint hitUpto = 0;
  jint readerUpto = -1;
  jint endDoc = 0;
  jint docBase = 0;
  id<OrgApacheLuceneSearchLeafCollector> leafCollector = nil;
  OrgApacheLuceneSearchFakeScorer *fakeScorer = create_OrgApacheLuceneSearchFakeScorer_init();
  while (hitUpto < ((IOSObjectArray *) nil_chk(hits))->size_) {
    OrgApacheLuceneSearchScoreDoc *hit = IOSObjectArray_Get(hits, hitUpto);
    jint docID = ((OrgApacheLuceneSearchScoreDoc *) nil_chk(hit))->doc_;
    OrgApacheLuceneIndexLeafReaderContext *readerContext = nil;
    while (docID >= endDoc) {
      readerUpto++;
      readerContext = [((id<JavaUtilList>) nil_chk(leaves)) getWithInt:readerUpto];
      endDoc = ((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(readerContext))->docBase_ + [((OrgApacheLuceneIndexLeafReader *) nil_chk([readerContext reader])) maxDoc];
    }
    if (readerContext != nil) {
      leafCollector = [((OrgApacheLuceneSearchTopFieldCollector *) nil_chk(collector)) getLeafCollectorWithOrgApacheLuceneIndexLeafReaderContext:readerContext];
      [((id<OrgApacheLuceneSearchLeafCollector>) nil_chk(leafCollector)) setScorerWithOrgApacheLuceneSearchScorer:fakeScorer];
      docBase = readerContext->docBase_;
    }
    fakeScorer->score_ = hit->score_;
    fakeScorer->doc_ = docID - docBase;
    [((id<OrgApacheLuceneSearchLeafCollector>) nil_chk(leafCollector)) collectWithInt:fakeScorer->doc_];
    hitUpto++;
  }
  return [((OrgApacheLuceneSearchTopFieldCollector *) nil_chk(collector)) topDocs];
}

- (OrgApacheLuceneSearchExplanation *)explainWithOrgApacheLuceneSearchIndexSearcher:(OrgApacheLuceneSearchIndexSearcher *)searcher
                                               withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)firstPassExplanation
                                                                            withInt:(jint)docID {
  OrgApacheLuceneSearchTopDocs *oneHit = create_OrgApacheLuceneSearchTopDocs_initWithInt_withOrgApacheLuceneSearchScoreDocArray_(1, [IOSObjectArray arrayWithObjects:(id[]){ create_OrgApacheLuceneSearchScoreDoc_initWithInt_withFloat_(docID, [((OrgApacheLuceneSearchExplanation *) nil_chk(firstPassExplanation)) getValue]) } count:1 type:OrgApacheLuceneSearchScoreDoc_class_()]);
  OrgApacheLuceneSearchTopDocs *hits = [self rescoreWithOrgApacheLuceneSearchIndexSearcher:searcher withOrgApacheLuceneSearchTopDocs:oneHit withInt:1];
  JreAssert((((OrgApacheLuceneSearchTopDocs *) nil_chk(hits))->totalHits_ == 1), (@"org/apache/lucene/search/SortRescorer.java:100 condition failed: assert hits.totalHits == 1;"));
  id<JavaUtilList> subs = create_JavaUtilArrayList_init();
  OrgApacheLuceneSearchExplanation *first = OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_([firstPassExplanation getValue], @"first pass score", [IOSObjectArray arrayWithObjects:(id[]){ firstPassExplanation } count:1 type:OrgApacheLuceneSearchExplanation_class_()]);
  [subs addWithId:first];
  OrgApacheLuceneSearchFieldDoc *fieldDoc = (OrgApacheLuceneSearchFieldDoc *) cast_chk(IOSObjectArray_Get(nil_chk(hits->scoreDocs_), 0), [OrgApacheLuceneSearchFieldDoc class]);
  IOSObjectArray *sortFields = [((OrgApacheLuceneSearchSort *) nil_chk(sort_)) getSort];
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(sortFields))->size_; i++) {
    [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_(0.0f, JreStrcat("$$$@", @"sort field ", [((OrgApacheLuceneSearchSortField *) nil_chk(IOSObjectArray_Get(sortFields, i))) description], @" value=", IOSObjectArray_Get(nil_chk(((OrgApacheLuceneSearchFieldDoc *) nil_chk(fieldDoc))->fields_), i)), [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
  }
  return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withJavaUtilCollection_(0.0f, JreStrcat("$$", @"sort field values for sort=", [sort_ description]), subs);
}

- (void)dealloc {
  RELEASE_(sort_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSearchSort:", "SortRescorer", NULL, 0x1, NULL, NULL },
    { "rescoreWithOrgApacheLuceneSearchIndexSearcher:withOrgApacheLuceneSearchTopDocs:withInt:", "rescore", "Lorg.apache.lucene.search.TopDocs;", 0x1, "Ljava.io.IOException;", NULL },
    { "explainWithOrgApacheLuceneSearchIndexSearcher:withOrgApacheLuceneSearchExplanation:withInt:", "explain", "Lorg.apache.lucene.search.Explanation;", 0x1, "Ljava.io.IOException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "sort_", NULL, 0x12, "Lorg.apache.lucene.search.Sort;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSortRescorer = { 2, "SortRescorer", "org.apache.lucene.search", NULL, 0x1, 3, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSearchSortRescorer;
}

@end

void OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(OrgApacheLuceneSearchSortRescorer *self, OrgApacheLuceneSearchSort *sort) {
  OrgApacheLuceneSearchRescorer_init(self);
  JreStrongAssign(&self->sort_, sort);
}

OrgApacheLuceneSearchSortRescorer *new_OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(OrgApacheLuceneSearchSort *sort) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSortRescorer, initWithOrgApacheLuceneSearchSort_, sort)
}

OrgApacheLuceneSearchSortRescorer *create_OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(OrgApacheLuceneSearchSort *sort) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSortRescorer, initWithOrgApacheLuceneSearchSort_, sort)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSortRescorer)

@implementation OrgApacheLuceneSearchSortRescorer_$1

- (jint)compareWithId:(OrgApacheLuceneSearchScoreDoc *)a
               withId:(OrgApacheLuceneSearchScoreDoc *)b {
  return ((OrgApacheLuceneSearchScoreDoc *) nil_chk(a))->doc_ - ((OrgApacheLuceneSearchScoreDoc *) nil_chk(b))->doc_;
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneSearchSortRescorer_$1_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "compareWithId:withId:", "compare", "I", 0x1, NULL, NULL },
    { "init", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "OrgApacheLuceneSearchSortRescorer", "rescoreWithOrgApacheLuceneSearchIndexSearcher:withOrgApacheLuceneSearchTopDocs:withInt:" };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchSortRescorer_$1 = { 2, "", "org.apache.lucene.search", "SortRescorer", 0x8008, 2, methods, 0, NULL, 0, NULL, 0, NULL, &enclosing_method, "Ljava/lang/Object;Ljava/util/Comparator<Lorg/apache/lucene/search/ScoreDoc;>;" };
  return &_OrgApacheLuceneSearchSortRescorer_$1;
}

@end

void OrgApacheLuceneSearchSortRescorer_$1_init(OrgApacheLuceneSearchSortRescorer_$1 *self) {
  NSObject_init(self);
}

OrgApacheLuceneSearchSortRescorer_$1 *new_OrgApacheLuceneSearchSortRescorer_$1_init() {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchSortRescorer_$1, init)
}

OrgApacheLuceneSearchSortRescorer_$1 *create_OrgApacheLuceneSearchSortRescorer_$1_init() {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchSortRescorer_$1, init)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchSortRescorer_$1)

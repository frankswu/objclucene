//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./join/src/java/org/apache/lucene/search/join/ToParentBlockJoinQuery.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Float.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/Integer.h"
#include "java/lang/Math.h"
#include "java/util/Collection.h"
#include "java/util/Collections.h"
#include "java/util/Locale.h"
#include "java/util/Set.h"
#include "org/apache/lucene/index/IndexReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/search/DocIdSetIterator.h"
#include "org/apache/lucene/search/Explanation.h"
#include "org/apache/lucene/search/IndexSearcher.h"
#include "org/apache/lucene/search/Query.h"
#include "org/apache/lucene/search/Scorer.h"
#include "org/apache/lucene/search/Weight.h"
#include "org/apache/lucene/search/join/BitSetProducer.h"
#include "org/apache/lucene/search/join/ScoreMode.h"
#include "org/apache/lucene/search/join/ToParentBlockJoinQuery.h"
#include "org/apache/lucene/util/ArrayUtil.h"
#include "org/apache/lucene/util/BitSet.h"

@interface OrgApacheLuceneSearchJoinToParentBlockJoinQuery () {
 @public
  id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter_;
  OrgApacheLuceneSearchQuery *childQuery_;
  OrgApacheLuceneSearchQuery *origChildQuery_;
  OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode_;
}

- (instancetype)initWithOrgApacheLuceneSearchQuery:(OrgApacheLuceneSearchQuery *)origChildQuery
                    withOrgApacheLuceneSearchQuery:(OrgApacheLuceneSearchQuery *)childQuery
       withOrgApacheLuceneSearchJoinBitSetProducer:(id<OrgApacheLuceneSearchJoinBitSetProducer>)parentsFilter
        withOrgApacheLuceneSearchJoinScoreModeEnum:(OrgApacheLuceneSearchJoinScoreModeEnum *)scoreMode;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery, parentsFilter_, id<OrgApacheLuceneSearchJoinBitSetProducer>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery, childQuery_, OrgApacheLuceneSearchQuery *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery, origChildQuery_, OrgApacheLuceneSearchQuery *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery, scoreMode_, OrgApacheLuceneSearchJoinScoreModeEnum *)

__attribute__((unused)) static void OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchJoinToParentBlockJoinQuery *self, OrgApacheLuceneSearchQuery *origChildQuery, OrgApacheLuceneSearchQuery *childQuery, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode);

__attribute__((unused)) static OrgApacheLuceneSearchJoinToParentBlockJoinQuery *new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchQuery *origChildQuery, OrgApacheLuceneSearchQuery *childQuery, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) NS_RETURNS_RETAINED;

@interface OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight : OrgApacheLuceneSearchWeight {
 @public
  OrgApacheLuceneSearchQuery *joinQuery_;
  OrgApacheLuceneSearchWeight *childWeight_;
  id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter_;
  OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode_;
}

- (instancetype)initWithOrgApacheLuceneSearchQuery:(OrgApacheLuceneSearchQuery *)joinQuery
                   withOrgApacheLuceneSearchWeight:(OrgApacheLuceneSearchWeight *)childWeight
       withOrgApacheLuceneSearchJoinBitSetProducer:(id<OrgApacheLuceneSearchJoinBitSetProducer>)parentsFilter
        withOrgApacheLuceneSearchJoinScoreModeEnum:(OrgApacheLuceneSearchJoinScoreModeEnum *)scoreMode;

- (void)extractTermsWithJavaUtilSet:(id<JavaUtilSet>)terms;

- (jfloat)getValueForNormalization;

- (void)normalizeWithFloat:(jfloat)norm
                 withFloat:(jfloat)topLevelBoost;

- (OrgApacheLuceneSearchScorer *)scorerWithOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)readerContext;

- (OrgApacheLuceneSearchExplanation *)explainWithOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)context
                                                                               withInt:(jint)doc;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight)

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight, joinQuery_, OrgApacheLuceneSearchQuery *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight, childWeight_, OrgApacheLuceneSearchWeight *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight, parentsFilter_, id<OrgApacheLuceneSearchJoinBitSetProducer>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight, scoreMode_, OrgApacheLuceneSearchJoinScoreModeEnum *)

__attribute__((unused)) static void OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight *self, OrgApacheLuceneSearchQuery *joinQuery, OrgApacheLuceneSearchWeight *childWeight, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode);

__attribute__((unused)) static OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight *new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchQuery *joinQuery, OrgApacheLuceneSearchWeight *childWeight, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight)

@interface OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer () {
 @public
  OrgApacheLuceneSearchScorer *childScorer_;
  OrgApacheLuceneUtilBitSet *parentBits_;
  OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode_;
  jint parentDoc_;
  jint prevParentDoc_;
  jfloat parentScore_;
  jint parentFreq_;
  jint nextChildDoc_;
  IOSIntArray *pendingChildDocs_;
  IOSFloatArray *pendingChildScores_;
  jint childDocUpto_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer, childScorer_, OrgApacheLuceneSearchScorer *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer, parentBits_, OrgApacheLuceneUtilBitSet *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer, scoreMode_, OrgApacheLuceneSearchJoinScoreModeEnum *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer, pendingChildDocs_, IOSIntArray *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer, pendingChildScores_, IOSFloatArray *)

@implementation OrgApacheLuceneSearchJoinToParentBlockJoinQuery

- (instancetype)initWithOrgApacheLuceneSearchQuery:(OrgApacheLuceneSearchQuery *)childQuery
       withOrgApacheLuceneSearchJoinBitSetProducer:(id<OrgApacheLuceneSearchJoinBitSetProducer>)parentsFilter
        withOrgApacheLuceneSearchJoinScoreModeEnum:(OrgApacheLuceneSearchJoinScoreModeEnum *)scoreMode {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, childQuery, parentsFilter, scoreMode);
  return self;
}

- (instancetype)initWithOrgApacheLuceneSearchQuery:(OrgApacheLuceneSearchQuery *)origChildQuery
                    withOrgApacheLuceneSearchQuery:(OrgApacheLuceneSearchQuery *)childQuery
       withOrgApacheLuceneSearchJoinBitSetProducer:(id<OrgApacheLuceneSearchJoinBitSetProducer>)parentsFilter
        withOrgApacheLuceneSearchJoinScoreModeEnum:(OrgApacheLuceneSearchJoinScoreModeEnum *)scoreMode {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, origChildQuery, childQuery, parentsFilter, scoreMode);
  return self;
}

- (OrgApacheLuceneSearchWeight *)createWeightWithOrgApacheLuceneSearchIndexSearcher:(OrgApacheLuceneSearchIndexSearcher *)searcher
                                                                        withBoolean:(jboolean)needsScores {
  return [new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, [((OrgApacheLuceneSearchQuery *) nil_chk(childQuery_)) createWeightWithOrgApacheLuceneSearchIndexSearcher:searcher withBoolean:needsScores], parentsFilter_, needsScores ? scoreMode_ : JreLoadStatic(OrgApacheLuceneSearchJoinScoreModeEnum, None)) autorelease];
}

- (OrgApacheLuceneSearchQuery *)getChildQuery {
  return childQuery_;
}

- (OrgApacheLuceneSearchQuery *)rewriteWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader {
  OrgApacheLuceneSearchQuery *childRewrite = [((OrgApacheLuceneSearchQuery *) nil_chk(childQuery_)) rewriteWithOrgApacheLuceneIndexIndexReader:reader];
  if (childRewrite != childQuery_) {
    OrgApacheLuceneSearchQuery *rewritten = [new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(origChildQuery_, childRewrite, parentsFilter_, scoreMode_) autorelease];
    [rewritten setBoostWithFloat:[self getBoost]];
    return rewritten;
  }
  else {
    return self;
  }
}

- (NSString *)toStringWithNSString:(NSString *)field {
  return JreStrcat("$$C", @"ToParentBlockJoinQuery (", [((OrgApacheLuceneSearchQuery *) nil_chk(childQuery_)) description], ')');
}

- (jboolean)isEqual:(id)_other {
  if ([_other isKindOfClass:[OrgApacheLuceneSearchJoinToParentBlockJoinQuery class]]) {
    OrgApacheLuceneSearchJoinToParentBlockJoinQuery *other = (OrgApacheLuceneSearchJoinToParentBlockJoinQuery *) check_class_cast(_other, [OrgApacheLuceneSearchJoinToParentBlockJoinQuery class]);
    return [((OrgApacheLuceneSearchQuery *) nil_chk(origChildQuery_)) isEqual:((OrgApacheLuceneSearchJoinToParentBlockJoinQuery *) nil_chk(other))->origChildQuery_] && [((id<OrgApacheLuceneSearchJoinBitSetProducer>) nil_chk(parentsFilter_)) isEqual:other->parentsFilter_] && scoreMode_ == other->scoreMode_ && [super isEqual:other];
  }
  else {
    return NO;
  }
}

- (NSUInteger)hash {
  jint prime = 31;
  jint hash_ = ((jint) [super hash]);
  hash_ = prime * hash_ + ((jint) [((OrgApacheLuceneSearchQuery *) nil_chk(origChildQuery_)) hash]);
  hash_ = prime * hash_ + ((jint) [((OrgApacheLuceneSearchJoinScoreModeEnum *) nil_chk(scoreMode_)) hash]);
  hash_ = prime * hash_ + ((jint) [((id<OrgApacheLuceneSearchJoinBitSetProducer>) nil_chk(parentsFilter_)) hash]);
  return hash_;
}

- (void)dealloc {
  RELEASE_(parentsFilter_);
  RELEASE_(childQuery_);
  RELEASE_(origChildQuery_);
  RELEASE_(scoreMode_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSearchQuery:withOrgApacheLuceneSearchJoinBitSetProducer:withOrgApacheLuceneSearchJoinScoreModeEnum:", "ToParentBlockJoinQuery", NULL, 0x1, NULL, NULL },
    { "initWithOrgApacheLuceneSearchQuery:withOrgApacheLuceneSearchQuery:withOrgApacheLuceneSearchJoinBitSetProducer:withOrgApacheLuceneSearchJoinScoreModeEnum:", "ToParentBlockJoinQuery", NULL, 0x2, NULL, NULL },
    { "createWeightWithOrgApacheLuceneSearchIndexSearcher:withBoolean:", "createWeight", "Lorg.apache.lucene.search.Weight;", 0x1, "Ljava.io.IOException;", NULL },
    { "getChildQuery", NULL, "Lorg.apache.lucene.search.Query;", 0x1, NULL, NULL },
    { "rewriteWithOrgApacheLuceneIndexIndexReader:", "rewrite", "Lorg.apache.lucene.search.Query;", 0x1, "Ljava.io.IOException;", NULL },
    { "toStringWithNSString:", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
    { "isEqual:", "equals", "Z", 0x1, NULL, NULL },
    { "hash", "hashCode", "I", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "parentsFilter_", NULL, 0x12, "Lorg.apache.lucene.search.join.BitSetProducer;", NULL, NULL, .constantValue.asLong = 0 },
    { "childQuery_", NULL, 0x12, "Lorg.apache.lucene.search.Query;", NULL, NULL, .constantValue.asLong = 0 },
    { "origChildQuery_", NULL, 0x12, "Lorg.apache.lucene.search.Query;", NULL, NULL, .constantValue.asLong = 0 },
    { "scoreMode_", NULL, 0x12, "Lorg.apache.lucene.search.join.ScoreMode;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.search.join.ToParentBlockJoinQuery$BlockJoinWeight;", "Lorg.apache.lucene.search.join.ToParentBlockJoinQuery$BlockJoinScorer;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSearchJoinToParentBlockJoinQuery = { 2, "ToParentBlockJoinQuery", "org.apache.lucene.search.join", NULL, 0x1, 8, methods, 4, fields, 0, NULL, 2, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneSearchJoinToParentBlockJoinQuery;
}

@end

void OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchJoinToParentBlockJoinQuery *self, OrgApacheLuceneSearchQuery *childQuery, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchQuery_init(self);
  JreStrongAssign(&self->origChildQuery_, childQuery);
  JreStrongAssign(&self->childQuery_, childQuery);
  JreStrongAssign(&self->parentsFilter_, parentsFilter);
  JreStrongAssign(&self->scoreMode_, scoreMode);
}

OrgApacheLuceneSearchJoinToParentBlockJoinQuery *new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchQuery *childQuery, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery *self = [OrgApacheLuceneSearchJoinToParentBlockJoinQuery alloc];
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, childQuery, parentsFilter, scoreMode);
  return self;
}

void OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchJoinToParentBlockJoinQuery *self, OrgApacheLuceneSearchQuery *origChildQuery, OrgApacheLuceneSearchQuery *childQuery, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchQuery_init(self);
  JreStrongAssign(&self->origChildQuery_, origChildQuery);
  JreStrongAssign(&self->childQuery_, childQuery);
  JreStrongAssign(&self->parentsFilter_, parentsFilter);
  JreStrongAssign(&self->scoreMode_, scoreMode);
}

OrgApacheLuceneSearchJoinToParentBlockJoinQuery *new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchQuery *origChildQuery, OrgApacheLuceneSearchQuery *childQuery, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery *self = [OrgApacheLuceneSearchJoinToParentBlockJoinQuery alloc];
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, origChildQuery, childQuery, parentsFilter, scoreMode);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchJoinToParentBlockJoinQuery)

@implementation OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight

- (instancetype)initWithOrgApacheLuceneSearchQuery:(OrgApacheLuceneSearchQuery *)joinQuery
                   withOrgApacheLuceneSearchWeight:(OrgApacheLuceneSearchWeight *)childWeight
       withOrgApacheLuceneSearchJoinBitSetProducer:(id<OrgApacheLuceneSearchJoinBitSetProducer>)parentsFilter
        withOrgApacheLuceneSearchJoinScoreModeEnum:(OrgApacheLuceneSearchJoinScoreModeEnum *)scoreMode {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, joinQuery, childWeight, parentsFilter, scoreMode);
  return self;
}

- (void)extractTermsWithJavaUtilSet:(id<JavaUtilSet>)terms {
}

- (jfloat)getValueForNormalization {
  return [((OrgApacheLuceneSearchWeight *) nil_chk(childWeight_)) getValueForNormalization] * [((OrgApacheLuceneSearchQuery *) nil_chk(joinQuery_)) getBoost] * [joinQuery_ getBoost];
}

- (void)normalizeWithFloat:(jfloat)norm
                 withFloat:(jfloat)topLevelBoost {
  [((OrgApacheLuceneSearchWeight *) nil_chk(childWeight_)) normalizeWithFloat:norm withFloat:topLevelBoost * [((OrgApacheLuceneSearchQuery *) nil_chk(joinQuery_)) getBoost]];
}

- (OrgApacheLuceneSearchScorer *)scorerWithOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)readerContext {
  OrgApacheLuceneSearchScorer *childScorer = [((OrgApacheLuceneSearchWeight *) nil_chk(childWeight_)) scorerWithOrgApacheLuceneIndexLeafReaderContext:readerContext];
  if (childScorer == nil) {
    return nil;
  }
  jint firstChildDoc = [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer)) nextDoc];
  if (firstChildDoc == OrgApacheLuceneSearchDocIdSetIterator_NO_MORE_DOCS) {
    return nil;
  }
  OrgApacheLuceneUtilBitSet *parents = [((id<OrgApacheLuceneSearchJoinBitSetProducer>) nil_chk(parentsFilter_)) getBitSetWithOrgApacheLuceneIndexLeafReaderContext:readerContext];
  if (parents == nil) {
    return nil;
  }
  return [new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer_initWithOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchScorer_withOrgApacheLuceneUtilBitSet_withInt_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, childScorer, parents, firstChildDoc, scoreMode_) autorelease];
}

- (OrgApacheLuceneSearchExplanation *)explainWithOrgApacheLuceneIndexLeafReaderContext:(OrgApacheLuceneIndexLeafReaderContext *)context
                                                                               withInt:(jint)doc {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer *scorer = (OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer *) check_class_cast([self scorerWithOrgApacheLuceneIndexLeafReaderContext:context], [OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer class]);
  if (scorer != nil && [scorer advanceWithInt:doc] == doc) {
    return [scorer explainWithInt:((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(context))->docBase_];
  }
  return OrgApacheLuceneSearchExplanation_noMatchWithNSString_withOrgApacheLuceneSearchExplanationArray_(@"Not a match", [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()]);
}

- (void)dealloc {
  RELEASE_(joinQuery_);
  RELEASE_(childWeight_);
  RELEASE_(parentsFilter_);
  RELEASE_(scoreMode_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSearchQuery:withOrgApacheLuceneSearchWeight:withOrgApacheLuceneSearchJoinBitSetProducer:withOrgApacheLuceneSearchJoinScoreModeEnum:", "BlockJoinWeight", NULL, 0x1, NULL, NULL },
    { "extractTermsWithJavaUtilSet:", "extractTerms", "V", 0x1, NULL, NULL },
    { "getValueForNormalization", NULL, "F", 0x1, "Ljava.io.IOException;", NULL },
    { "normalizeWithFloat:withFloat:", "normalize", "V", 0x1, NULL, NULL },
    { "scorerWithOrgApacheLuceneIndexLeafReaderContext:", "scorer", "Lorg.apache.lucene.search.Scorer;", 0x1, "Ljava.io.IOException;", NULL },
    { "explainWithOrgApacheLuceneIndexLeafReaderContext:withInt:", "explain", "Lorg.apache.lucene.search.Explanation;", 0x1, "Ljava.io.IOException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "joinQuery_", NULL, 0x12, "Lorg.apache.lucene.search.Query;", NULL, NULL, .constantValue.asLong = 0 },
    { "childWeight_", NULL, 0x12, "Lorg.apache.lucene.search.Weight;", NULL, NULL, .constantValue.asLong = 0 },
    { "parentsFilter_", NULL, 0x12, "Lorg.apache.lucene.search.join.BitSetProducer;", NULL, NULL, .constantValue.asLong = 0 },
    { "scoreMode_", NULL, 0x12, "Lorg.apache.lucene.search.join.ScoreMode;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight = { 2, "BlockJoinWeight", "org.apache.lucene.search.join", "ToParentBlockJoinQuery", 0xa, 6, methods, 4, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight;
}

@end

void OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight *self, OrgApacheLuceneSearchQuery *joinQuery, OrgApacheLuceneSearchWeight *childWeight, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchWeight_initWithOrgApacheLuceneSearchQuery_(self, joinQuery);
  JreStrongAssign(&self->joinQuery_, joinQuery);
  JreStrongAssign(&self->childWeight_, childWeight);
  JreStrongAssign(&self->parentsFilter_, parentsFilter);
  JreStrongAssign(&self->scoreMode_, scoreMode);
}

OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight *new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchQuery *joinQuery, OrgApacheLuceneSearchWeight *childWeight, id<OrgApacheLuceneSearchJoinBitSetProducer> parentsFilter, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight *self = [OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight alloc];
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight_initWithOrgApacheLuceneSearchQuery_withOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchJoinBitSetProducer_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, joinQuery, childWeight, parentsFilter, scoreMode);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinWeight)

@implementation OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer

- (instancetype)initWithOrgApacheLuceneSearchWeight:(OrgApacheLuceneSearchWeight *)weight
                    withOrgApacheLuceneSearchScorer:(OrgApacheLuceneSearchScorer *)childScorer
                      withOrgApacheLuceneUtilBitSet:(OrgApacheLuceneUtilBitSet *)parentBits
                                            withInt:(jint)firstChildDoc
         withOrgApacheLuceneSearchJoinScoreModeEnum:(OrgApacheLuceneSearchJoinScoreModeEnum *)scoreMode {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer_initWithOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchScorer_withOrgApacheLuceneUtilBitSet_withInt_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, weight, childScorer, parentBits, firstChildDoc, scoreMode);
  return self;
}

- (id<JavaUtilCollection>)getChildren {
  return JavaUtilCollections_singletonWithId_([new_OrgApacheLuceneSearchScorer_ChildScorer_initWithOrgApacheLuceneSearchScorer_withNSString_(childScorer_, @"BLOCK_JOIN") autorelease]);
}

- (jint)getChildCount {
  return childDocUpto_;
}

- (jint)getParentDoc {
  return parentDoc_;
}

- (IOSIntArray *)swapChildDocsWithIntArray:(IOSIntArray *)other {
  IOSIntArray *ret = pendingChildDocs_;
  if (other == nil) {
    JreStrongAssignAndConsume(&pendingChildDocs_, [IOSIntArray newArrayWithLength:5]);
  }
  else {
    JreStrongAssign(&pendingChildDocs_, other);
  }
  return ret;
}

- (IOSFloatArray *)swapChildScoresWithFloatArray:(IOSFloatArray *)other {
  if (scoreMode_ == JreLoadStatic(OrgApacheLuceneSearchJoinScoreModeEnum, None)) {
    @throw [new_JavaLangIllegalStateException_initWithNSString_(@"ScoreMode is None; you must pass trackScores=false to ToParentBlockJoinCollector") autorelease];
  }
  IOSFloatArray *ret = pendingChildScores_;
  if (other == nil) {
    JreStrongAssignAndConsume(&pendingChildScores_, [IOSFloatArray newArrayWithLength:5]);
  }
  else {
    JreStrongAssign(&pendingChildScores_, other);
  }
  return ret;
}

- (jint)nextDoc {
  if (nextChildDoc_ == OrgApacheLuceneSearchDocIdSetIterator_NO_MORE_DOCS) {
    return parentDoc_ = OrgApacheLuceneSearchDocIdSetIterator_NO_MORE_DOCS;
  }
  parentDoc_ = [((OrgApacheLuceneUtilBitSet *) nil_chk(parentBits_)) nextSetBitWithInt:nextChildDoc_];
  if (nextChildDoc_ == parentDoc_) {
    @throw [new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$I$@", @"child query must only match non-parent docs, but parent docID=", nextChildDoc_, @" matched childScorer=", [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer_)) getClass])) autorelease];
  }
  JreAssert((parentDoc_ != OrgApacheLuceneSearchDocIdSetIterator_NO_MORE_DOCS), (@"org/apache/lucene/search/join/ToParentBlockJoinQuery.java:272 condition failed: assert parentDoc != DocIdSetIterator.NO_MORE_DOCS;"));
  jfloat totalScore = 0;
  jfloat maxScore = JavaLangFloat_NEGATIVE_INFINITY;
  jfloat minScore = JavaLangFloat_POSITIVE_INFINITY;
  childDocUpto_ = 0;
  parentFreq_ = 0;
  do {
    if (pendingChildDocs_ != nil && pendingChildDocs_->size_ == childDocUpto_) {
      JreStrongAssign(&pendingChildDocs_, OrgApacheLuceneUtilArrayUtil_growWithIntArray_(pendingChildDocs_));
    }
    if (pendingChildScores_ != nil && scoreMode_ != JreLoadStatic(OrgApacheLuceneSearchJoinScoreModeEnum, None) && pendingChildScores_->size_ == childDocUpto_) {
      JreStrongAssign(&pendingChildScores_, OrgApacheLuceneUtilArrayUtil_growWithFloatArray_(pendingChildScores_));
    }
    if (pendingChildDocs_ != nil) {
      *IOSIntArray_GetRef(pendingChildDocs_, childDocUpto_) = nextChildDoc_;
    }
    if (scoreMode_ != JreLoadStatic(OrgApacheLuceneSearchJoinScoreModeEnum, None)) {
      jfloat childScore = [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer_)) score];
      jint childFreq = [childScorer_ freq];
      if (pendingChildScores_ != nil) {
        *IOSFloatArray_GetRef(pendingChildScores_, childDocUpto_) = childScore;
      }
      maxScore = JavaLangMath_maxWithFloat_withFloat_(childScore, maxScore);
      minScore = JavaLangMath_minWithFloat_withFloat_(childScore, minScore);
      JrePlusAssignFloatF(&totalScore, childScore);
      parentFreq_ += childFreq;
    }
    childDocUpto_++;
    nextChildDoc_ = [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer_)) nextDoc];
  }
  while (nextChildDoc_ < parentDoc_);
  if (nextChildDoc_ == parentDoc_) {
    @throw [new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$I$@", @"child query must only match non-parent docs, but parent docID=", nextChildDoc_, @" matched childScorer=", [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer_)) getClass])) autorelease];
  }
  switch ([scoreMode_ ordinal]) {
    case OrgApacheLuceneSearchJoinScoreMode_Avg:
    parentScore_ = totalScore / childDocUpto_;
    break;
    case OrgApacheLuceneSearchJoinScoreMode_Max:
    parentScore_ = maxScore;
    break;
    case OrgApacheLuceneSearchJoinScoreMode_Min:
    parentScore_ = minScore;
    break;
    case OrgApacheLuceneSearchJoinScoreMode_Total:
    parentScore_ = totalScore;
    break;
    case OrgApacheLuceneSearchJoinScoreMode_None:
    break;
  }
  return parentDoc_;
}

- (jint)docID {
  return parentDoc_;
}

- (jfloat)score {
  return parentScore_;
}

- (jint)freq {
  return parentFreq_;
}

- (jint)advanceWithInt:(jint)parentTarget {
  if (parentTarget == OrgApacheLuceneSearchDocIdSetIterator_NO_MORE_DOCS) {
    return parentDoc_ = OrgApacheLuceneSearchDocIdSetIterator_NO_MORE_DOCS;
  }
  if (parentTarget == 0) {
    return [self nextDoc];
  }
  prevParentDoc_ = [((OrgApacheLuceneUtilBitSet *) nil_chk(parentBits_)) prevSetBitWithInt:parentTarget - 1];
  JreAssert((prevParentDoc_ >= parentDoc_), (@"org/apache/lucene/search/join/ToParentBlockJoinQuery.java:371 condition failed: assert prevParentDoc >= parentDoc;"));
  if (prevParentDoc_ > nextChildDoc_) {
    nextChildDoc_ = [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer_)) advanceWithInt:prevParentDoc_];
  }
  if (nextChildDoc_ == prevParentDoc_) {
    @throw [new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$I$@", @"child query must only match non-parent docs, but parent docID=", nextChildDoc_, @" matched childScorer=", [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer_)) getClass])) autorelease];
  }
  jint nd = [self nextDoc];
  return nd;
}

- (OrgApacheLuceneSearchExplanation *)explainWithInt:(jint)docBase {
  jint start = docBase + prevParentDoc_ + 1;
  jint end = docBase + parentDoc_ - 1;
  return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_([self score], NSString_formatWithJavaUtilLocale_withNSString_withNSObjectArray_(JreLoadStatic(JavaUtilLocale, ROOT_), @"Score based on child doc range from %d to %d", [IOSObjectArray arrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_(start), JavaLangInteger_valueOfWithInt_(end) } count:2 type:NSObject_class_()]), [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()]);
}

- (jlong)cost {
  return [((OrgApacheLuceneSearchScorer *) nil_chk(childScorer_)) cost];
}

- (void)trackPendingChildHits {
  JreStrongAssignAndConsume(&pendingChildDocs_, [IOSIntArray newArrayWithLength:5]);
  if (scoreMode_ != JreLoadStatic(OrgApacheLuceneSearchJoinScoreModeEnum, None)) {
    JreStrongAssignAndConsume(&pendingChildScores_, [IOSFloatArray newArrayWithLength:5]);
  }
}

- (void)dealloc {
  RELEASE_(childScorer_);
  RELEASE_(parentBits_);
  RELEASE_(scoreMode_);
  RELEASE_(pendingChildDocs_);
  RELEASE_(pendingChildScores_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSearchWeight:withOrgApacheLuceneSearchScorer:withOrgApacheLuceneUtilBitSet:withInt:withOrgApacheLuceneSearchJoinScoreModeEnum:", "BlockJoinScorer", NULL, 0x1, NULL, NULL },
    { "getChildren", NULL, "Ljava.util.Collection;", 0x1, NULL, NULL },
    { "getChildCount", NULL, "I", 0x0, NULL, NULL },
    { "getParentDoc", NULL, "I", 0x0, NULL, NULL },
    { "swapChildDocsWithIntArray:", "swapChildDocs", "[I", 0x0, NULL, NULL },
    { "swapChildScoresWithFloatArray:", "swapChildScores", "[F", 0x0, NULL, NULL },
    { "nextDoc", NULL, "I", 0x1, "Ljava.io.IOException;", NULL },
    { "docID", NULL, "I", 0x1, NULL, NULL },
    { "score", NULL, "F", 0x1, "Ljava.io.IOException;", NULL },
    { "freq", NULL, "I", 0x1, NULL, NULL },
    { "advanceWithInt:", "advance", "I", 0x1, "Ljava.io.IOException;", NULL },
    { "explainWithInt:", "explain", "Lorg.apache.lucene.search.Explanation;", 0x1, "Ljava.io.IOException;", NULL },
    { "cost", NULL, "J", 0x1, NULL, NULL },
    { "trackPendingChildHits", NULL, "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "childScorer_", NULL, 0x12, "Lorg.apache.lucene.search.Scorer;", NULL, NULL, .constantValue.asLong = 0 },
    { "parentBits_", NULL, 0x12, "Lorg.apache.lucene.util.BitSet;", NULL, NULL, .constantValue.asLong = 0 },
    { "scoreMode_", NULL, 0x12, "Lorg.apache.lucene.search.join.ScoreMode;", NULL, NULL, .constantValue.asLong = 0 },
    { "parentDoc_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "prevParentDoc_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "parentScore_", NULL, 0x2, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "parentFreq_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "nextChildDoc_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "pendingChildDocs_", NULL, 0x2, "[I", NULL, NULL, .constantValue.asLong = 0 },
    { "pendingChildScores_", NULL, 0x2, "[F", NULL, NULL, .constantValue.asLong = 0 },
    { "childDocUpto_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer = { 2, "BlockJoinScorer", "org.apache.lucene.search.join", "ToParentBlockJoinQuery", 0x8, 14, methods, 11, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer;
}

@end

void OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer_initWithOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchScorer_withOrgApacheLuceneUtilBitSet_withInt_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer *self, OrgApacheLuceneSearchWeight *weight, OrgApacheLuceneSearchScorer *childScorer, OrgApacheLuceneUtilBitSet *parentBits, jint firstChildDoc, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchScorer_initWithOrgApacheLuceneSearchWeight_(self, weight);
  self->parentDoc_ = -1;
  JreStrongAssign(&self->parentBits_, parentBits);
  JreStrongAssign(&self->childScorer_, childScorer);
  JreStrongAssign(&self->scoreMode_, scoreMode);
  self->nextChildDoc_ = firstChildDoc;
}

OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer *new_OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer_initWithOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchScorer_withOrgApacheLuceneUtilBitSet_withInt_withOrgApacheLuceneSearchJoinScoreModeEnum_(OrgApacheLuceneSearchWeight *weight, OrgApacheLuceneSearchScorer *childScorer, OrgApacheLuceneUtilBitSet *parentBits, jint firstChildDoc, OrgApacheLuceneSearchJoinScoreModeEnum *scoreMode) {
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer *self = [OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer alloc];
  OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer_initWithOrgApacheLuceneSearchWeight_withOrgApacheLuceneSearchScorer_withOrgApacheLuceneUtilBitSet_withInt_withOrgApacheLuceneSearchJoinScoreModeEnum_(self, weight, childScorer, parentBits, firstChildDoc, scoreMode);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchJoinToParentBlockJoinQuery_BlockJoinScorer)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./sandbox/src/java/org/apache/lucene/sandbox/queries/FuzzyLikeThisQuery.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Float.h"
#include "java/lang/Throwable.h"
#include "java/util/ArrayList.h"
#include "java/util/Collection.h"
#include "java/util/HashMap.h"
#include "java/util/HashSet.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "org/apache/lucene/analysis/Analyzer.h"
#include "org/apache/lucene/analysis/TokenStream.h"
#include "org/apache/lucene/analysis/tokenattributes/CharTermAttribute.h"
#include "org/apache/lucene/index/IndexReader.h"
#include "org/apache/lucene/index/IndexReaderContext.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/index/MultiFields.h"
#include "org/apache/lucene/index/Term.h"
#include "org/apache/lucene/index/TermContext.h"
#include "org/apache/lucene/index/TermState.h"
#include "org/apache/lucene/index/Terms.h"
#include "org/apache/lucene/index/TermsEnum.h"
#include "org/apache/lucene/sandbox/queries/FuzzyLikeThisQuery.h"
#include "org/apache/lucene/sandbox/queries/SlowFuzzyTermsEnum.h"
#include "org/apache/lucene/search/BooleanClause.h"
#include "org/apache/lucene/search/BooleanQuery.h"
#include "org/apache/lucene/search/BoostAttribute.h"
#include "org/apache/lucene/search/ConstantScoreQuery.h"
#include "org/apache/lucene/search/MaxNonCompetitiveBoostAttribute.h"
#include "org/apache/lucene/search/Query.h"
#include "org/apache/lucene/search/TermQuery.h"
#include "org/apache/lucene/search/similarities/DefaultSimilarity.h"
#include "org/apache/lucene/search/similarities/TFIDFSimilarity.h"
#include "org/apache/lucene/util/AttributeSource.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/PriorityQueue.h"

@interface OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery () {
 @public
  jint maxNumTerms_;
}

- (void)addTermsWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *)f;

- (OrgApacheLuceneSearchQuery *)newTermQueryWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
                                                   withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term OBJC_METHOD_FAMILY_NONE;

@end

__attribute__((unused)) static void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *f);

__attribute__((unused)) static OrgApacheLuceneSearchQuery *OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term);

@interface OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm : NSObject {
 @public
  OrgApacheLuceneIndexTerm *term_;
  jfloat score_;
  OrgApacheLuceneIndexTerm *fuzziedSourceTerm_;
}

- (instancetype)initWithOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term
                                       withFloat:(jfloat)score
                    withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)fuzziedSourceTerm;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm)

J2OBJC_FIELD_SETTER(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm, term_, OrgApacheLuceneIndexTerm *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm, fuzziedSourceTerm_, OrgApacheLuceneIndexTerm *)

__attribute__((unused)) static void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *self, OrgApacheLuceneIndexTerm *term, jfloat score, OrgApacheLuceneIndexTerm *fuzziedSourceTerm);

__attribute__((unused)) static OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneIndexTerm *term, jfloat score, OrgApacheLuceneIndexTerm *fuzziedSourceTerm) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery)

OrgApacheLuceneSearchSimilaritiesTFIDFSimilarity *OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim_;

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery

- (NSUInteger)hash {
  jint prime = 31;
  jint result = ((jint) [super hash]);
  result = prime * result + ((analyzer_ == nil) ? 0 : ((jint) [analyzer_ hash]));
  result = prime * result + ((fieldVals_ == nil) ? 0 : ((jint) [fieldVals_ hash]));
  result = prime * result + (ignoreTF_ ? 1231 : 1237);
  result = prime * result + maxNumTerms_;
  return result;
}

- (jboolean)isEqual:(id)obj {
  if (self == obj) return true;
  if (obj == nil) return false;
  if ([self getClass] != [nil_chk(obj) getClass]) return false;
  if (![super isEqual:obj]) {
    return false;
  }
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *other = (OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *) check_class_cast(obj, [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery class]);
  if (analyzer_ == nil) {
    if (other->analyzer_ != nil) return false;
  }
  else if (![analyzer_ isEqual:other->analyzer_]) return false;
  if (fieldVals_ == nil) {
    if (other->fieldVals_ != nil) return false;
  }
  else if (![fieldVals_ isEqual:other->fieldVals_]) return false;
  if (ignoreTF_ != other->ignoreTF_) return false;
  if (maxNumTerms_ != other->maxNumTerms_) return false;
  return true;
}

- (instancetype)initWithInt:(jint)maxNumTerms
withOrgApacheLuceneAnalysisAnalyzer:(OrgApacheLuceneAnalysisAnalyzer *)analyzer {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(self, maxNumTerms, analyzer);
  return self;
}

- (void)addTermsWithNSString:(NSString *)queryString
                withNSString:(NSString *)fieldName
                   withFloat:(jfloat)minSimilarity
                     withInt:(jint)prefixLength {
  [((JavaUtilArrayList *) nil_chk(fieldVals_)) addWithId:[new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(self, fieldName, minSimilarity, prefixLength, queryString) autorelease]];
}

- (void)addTermsWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *)f {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(self, reader, f);
}

- (OrgApacheLuceneSearchQuery *)newTermQueryWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
                                                   withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term {
  return OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(self, reader, term);
}

- (OrgApacheLuceneSearchQuery *)rewriteWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader {
  if (rewrittenQuery_ != nil) {
    return rewrittenQuery_;
  }
  for (id<JavaUtilIterator> iter = [((JavaUtilArrayList *) nil_chk(fieldVals_)) iterator]; [((id<JavaUtilIterator>) nil_chk(iter)) hasNext]; ) {
    OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *f = [iter next];
    OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(self, reader, f);
  }
  [fieldVals_ clear];
  OrgApacheLuceneSearchBooleanQuery_Builder *bq = [new_OrgApacheLuceneSearchBooleanQuery_Builder_init() autorelease];
  JavaUtilHashMap *variantQueries = [new_JavaUtilHashMap_init() autorelease];
  jint size = [((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *) nil_chk(q_)) size];
  for (jint i = 0; i < size; i++) {
    OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = [q_ pop];
    JavaUtilArrayList *l = [variantQueries getWithId:((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->fuzziedSourceTerm_];
    if (l == nil) {
      l = [new_JavaUtilArrayList_init() autorelease];
      [variantQueries putWithId:st->fuzziedSourceTerm_ withId:l];
    }
    [((JavaUtilArrayList *) nil_chk(l)) addWithId:st];
  }
  for (id<JavaUtilIterator> iter = [((id<JavaUtilCollection>) nil_chk([variantQueries values])) iterator]; [((id<JavaUtilIterator>) nil_chk(iter)) hasNext]; ) {
    JavaUtilArrayList *variants = [iter next];
    if ([((JavaUtilArrayList *) nil_chk(variants)) size] == 1) {
      OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = [variants getWithInt:0];
      OrgApacheLuceneSearchQuery *tq = OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(self, reader, ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->term_);
      [((OrgApacheLuceneSearchQuery *) nil_chk(tq)) setBoostWithFloat:st->score_];
      [bq addWithOrgApacheLuceneSearchQuery:tq withOrgApacheLuceneSearchBooleanClause_OccurEnum:JreLoadStatic(OrgApacheLuceneSearchBooleanClause_OccurEnum, SHOULD)];
    }
    else {
      OrgApacheLuceneSearchBooleanQuery_Builder *termVariants = [new_OrgApacheLuceneSearchBooleanQuery_Builder_init() autorelease];
      [termVariants setDisableCoordWithBoolean:true];
      for (id<JavaUtilIterator> iterator2 = [variants iterator]; [((id<JavaUtilIterator>) nil_chk(iterator2)) hasNext]; ) {
        OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = [iterator2 next];
        OrgApacheLuceneSearchQuery *tq = OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(self, reader, ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->term_);
        [((OrgApacheLuceneSearchQuery *) nil_chk(tq)) setBoostWithFloat:st->score_];
        [termVariants addWithOrgApacheLuceneSearchQuery:tq withOrgApacheLuceneSearchBooleanClause_OccurEnum:JreLoadStatic(OrgApacheLuceneSearchBooleanClause_OccurEnum, SHOULD)];
      }
      [bq addWithOrgApacheLuceneSearchQuery:[termVariants build] withOrgApacheLuceneSearchBooleanClause_OccurEnum:JreLoadStatic(OrgApacheLuceneSearchBooleanClause_OccurEnum, SHOULD)];
    }
  }
  OrgApacheLuceneSearchQuery *q = [bq build];
  [((OrgApacheLuceneSearchQuery *) nil_chk(q)) setBoostWithFloat:[self getBoost]];
  JreStrongAssign(&self->rewrittenQuery_, q);
  return q;
}

- (NSString *)toStringWithNSString:(NSString *)field {
  return nil;
}

- (jboolean)isIgnoreTF {
  return ignoreTF_;
}

- (void)setIgnoreTFWithBoolean:(jboolean)ignoreTF {
  self->ignoreTF_ = ignoreTF;
}

- (void)dealloc {
  RELEASE_(rewrittenQuery_);
  RELEASE_(fieldVals_);
  RELEASE_(analyzer_);
  RELEASE_(q_);
  [super dealloc];
}

+ (void)initialize {
  if (self == [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery class]) {
    JreStrongAssignAndConsume(&OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim_, new_OrgApacheLuceneSearchSimilaritiesDefaultSimilarity_init());
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "hash", "hashCode", "I", 0x1, NULL, NULL },
    { "isEqual:", "equals", "Z", 0x1, NULL, NULL },
    { "initWithInt:withOrgApacheLuceneAnalysisAnalyzer:", "FuzzyLikeThisQuery", NULL, 0x1, NULL, NULL },
    { "addTermsWithNSString:withNSString:withFloat:withInt:", "addTerms", "V", 0x1, NULL, NULL },
    { "addTermsWithOrgApacheLuceneIndexIndexReader:withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals:", "addTerms", "V", 0x2, "Ljava.io.IOException;", NULL },
    { "newTermQueryWithOrgApacheLuceneIndexIndexReader:withOrgApacheLuceneIndexTerm:", "newTermQuery", "Lorg.apache.lucene.search.Query;", 0x2, "Ljava.io.IOException;", NULL },
    { "rewriteWithOrgApacheLuceneIndexIndexReader:", "rewrite", "Lorg.apache.lucene.search.Query;", 0x1, "Ljava.io.IOException;", NULL },
    { "toStringWithNSString:", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
    { "isIgnoreTF", NULL, "Z", 0x1, NULL, NULL },
    { "setIgnoreTFWithBoolean:", "setIgnoreTF", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "sim_", NULL, 0x8, "Lorg.apache.lucene.search.similarities.TFIDFSimilarity;", &OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim_, NULL, .constantValue.asLong = 0 },
    { "rewrittenQuery_", NULL, 0x0, "Lorg.apache.lucene.search.Query;", NULL, NULL, .constantValue.asLong = 0 },
    { "fieldVals_", NULL, 0x0, "Ljava.util.ArrayList;", NULL, "Ljava/util/ArrayList<Lorg/apache/lucene/sandbox/queries/FuzzyLikeThisQuery$FieldVals;>;", .constantValue.asLong = 0 },
    { "analyzer_", NULL, 0x0, "Lorg.apache.lucene.analysis.Analyzer;", NULL, NULL, .constantValue.asLong = 0 },
    { "q_", NULL, 0x0, "Lorg.apache.lucene.sandbox.queries.FuzzyLikeThisQuery$ScoreTermQueue;", NULL, NULL, .constantValue.asLong = 0 },
    { "MAX_VARIANTS_PER_TERM_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "ignoreTF_", NULL, 0x0, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "maxNumTerms_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.sandbox.queries.FuzzyLikeThisQuery$FieldVals;", "Lorg.apache.lucene.sandbox.queries.FuzzyLikeThisQuery$ScoreTerm;", "Lorg.apache.lucene.sandbox.queries.FuzzyLikeThisQuery$ScoreTermQueue;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery = { 2, "FuzzyLikeThisQuery", "org.apache.lucene.sandbox.queries", NULL, 0x1, 10, methods, 8, fields, 0, NULL, 3, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery;
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, jint maxNumTerms, OrgApacheLuceneAnalysisAnalyzer *analyzer) {
  OrgApacheLuceneSearchQuery_init(self);
  JreStrongAssign(&self->rewrittenQuery_, nil);
  JreStrongAssignAndConsume(&self->fieldVals_, new_JavaUtilArrayList_init());
  self->MAX_VARIANTS_PER_TERM_ = 50;
  self->ignoreTF_ = false;
  JreStrongAssignAndConsume(&self->q_, new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(maxNumTerms));
  JreStrongAssign(&self->analyzer_, analyzer);
  self->maxNumTerms_ = maxNumTerms;
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(jint maxNumTerms, OrgApacheLuceneAnalysisAnalyzer *analyzer) {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self = [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery alloc];
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_initWithInt_withOrgApacheLuceneAnalysisAnalyzer_(self, maxNumTerms, analyzer);
  return self;
}

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_addTermsWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *f) {
  if (((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *) nil_chk(f))->queryString_ == nil) return;
  OrgApacheLuceneIndexTerms *terms = OrgApacheLuceneIndexMultiFields_getTermsWithOrgApacheLuceneIndexIndexReader_withNSString_(reader, f->fieldName_);
  if (terms == nil) {
    return;
  }
  {
    OrgApacheLuceneAnalysisTokenStream *ts = [((OrgApacheLuceneAnalysisAnalyzer *) nil_chk(self->analyzer_)) tokenStreamWithNSString:f->fieldName_ withNSString:f->queryString_];
    JavaLangThrowable *__primaryException1 = nil;
    @try {
      id<OrgApacheLuceneAnalysisTokenattributesCharTermAttribute> termAtt = [((OrgApacheLuceneAnalysisTokenStream *) nil_chk(ts)) addAttributeWithIOSClass:OrgApacheLuceneAnalysisTokenattributesCharTermAttribute_class_()];
      jint corpusNumDocs = [((OrgApacheLuceneIndexIndexReader *) nil_chk(reader)) numDocs];
      JavaUtilHashSet *processedTerms = [new_JavaUtilHashSet_init() autorelease];
      [ts reset];
      while ([ts incrementToken]) {
        NSString *term = [((id<OrgApacheLuceneAnalysisTokenattributesCharTermAttribute>) nil_chk(termAtt)) description];
        if (![processedTerms containsWithId:term]) {
          [processedTerms addWithId:term];
          OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *variantsQ = [new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(self->MAX_VARIANTS_PER_TERM_) autorelease];
          jfloat minScore = 0;
          OrgApacheLuceneIndexTerm *startTerm = [new_OrgApacheLuceneIndexTerm_initWithNSString_withNSString_(f->fieldName_, term) autorelease];
          OrgApacheLuceneUtilAttributeSource *atts = [new_OrgApacheLuceneUtilAttributeSource_init() autorelease];
          id<OrgApacheLuceneSearchMaxNonCompetitiveBoostAttribute> maxBoostAtt = [atts addAttributeWithIOSClass:OrgApacheLuceneSearchMaxNonCompetitiveBoostAttribute_class_()];
          OrgApacheLuceneSandboxQueriesSlowFuzzyTermsEnum *fe = [new_OrgApacheLuceneSandboxQueriesSlowFuzzyTermsEnum_initWithOrgApacheLuceneIndexTerms_withOrgApacheLuceneUtilAttributeSource_withOrgApacheLuceneIndexTerm_withFloat_withInt_(terms, atts, startTerm, f->minSimilarity_, f->prefixLength_) autorelease];
          jint df = [reader docFreqWithOrgApacheLuceneIndexTerm:startTerm];
          jint numVariants = 0;
          jint totalVariantDocFreqs = 0;
          OrgApacheLuceneUtilBytesRef *possibleMatch;
          id<OrgApacheLuceneSearchBoostAttribute> boostAtt = [((OrgApacheLuceneUtilAttributeSource *) nil_chk([fe attributes])) addAttributeWithIOSClass:OrgApacheLuceneSearchBoostAttribute_class_()];
          while ((possibleMatch = [fe next]) != nil) {
            numVariants++;
            totalVariantDocFreqs += [fe docFreq];
            jfloat score = [((id<OrgApacheLuceneSearchBoostAttribute>) nil_chk(boostAtt)) getBoost];
            if ([variantsQ size] < self->MAX_VARIANTS_PER_TERM_ || score > minScore) {
              OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = [new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_([new_OrgApacheLuceneIndexTerm_initWithNSString_withOrgApacheLuceneUtilBytesRef_([startTerm field], OrgApacheLuceneUtilBytesRef_deepCopyOfWithOrgApacheLuceneUtilBytesRef_(possibleMatch)) autorelease], score, startTerm) autorelease];
              [variantsQ insertWithOverflowWithId:st];
              minScore = ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk([variantsQ top]))->score_;
            }
            [((id<OrgApacheLuceneSearchMaxNonCompetitiveBoostAttribute>) nil_chk(maxBoostAtt)) setMaxNonCompetitiveBoostWithFloat:[variantsQ size] >= self->MAX_VARIANTS_PER_TERM_ ? minScore : JavaLangFloat_NEGATIVE_INFINITY];
          }
          if (numVariants > 0) {
            jint avgDf = totalVariantDocFreqs / numVariants;
            if (df == 0) {
              df = avgDf;
            }
            jint size = [variantsQ size];
            for (jint i = 0; i < size; i++) {
              OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *st = [variantsQ pop];
              ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(st))->score_ = (st->score_ * st->score_) * [((OrgApacheLuceneSearchSimilaritiesTFIDFSimilarity *) nil_chk(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_sim_)) idfWithLong:df withLong:corpusNumDocs];
              [((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *) nil_chk(self->q_)) insertWithOverflowWithId:st];
            }
          }
        }
      }
      [ts end];
    }
    @catch (JavaLangThrowable *e) {
      __primaryException1 = e;
      @throw e;
    }
    @finally {
      if (ts != nil) {
        if (__primaryException1 != nil) {
          @try {
            [ts close];
          } @catch (JavaLangThrowable *e) {
            [__primaryException1 addSuppressedWithJavaLangThrowable:e];
          }
        } else {
          [ts close];
        }
      }
    }
  }
}

OrgApacheLuceneSearchQuery *OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_newTermQueryWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term) {
  if (self->ignoreTF_) {
    return [new_OrgApacheLuceneSearchConstantScoreQuery_initWithOrgApacheLuceneSearchQuery_([new_OrgApacheLuceneSearchTermQuery_initWithOrgApacheLuceneIndexTerm_(term) autorelease]) autorelease];
  }
  else {
    OrgApacheLuceneIndexTermContext *context = [new_OrgApacheLuceneIndexTermContext_initWithOrgApacheLuceneIndexIndexReaderContext_([((OrgApacheLuceneIndexIndexReader *) nil_chk(reader)) getContext]) autorelease];
    for (OrgApacheLuceneIndexLeafReaderContext * __strong leafContext in nil_chk([reader leaves])) {
      OrgApacheLuceneIndexTerms *terms = [((OrgApacheLuceneIndexLeafReader *) nil_chk([((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(leafContext)) reader])) termsWithNSString:[((OrgApacheLuceneIndexTerm *) nil_chk(term)) field]];
      if (terms != nil) {
        OrgApacheLuceneIndexTermsEnum *termsEnum = [terms iterator];
        if ([((OrgApacheLuceneIndexTermsEnum *) nil_chk(termsEnum)) seekExactWithOrgApacheLuceneUtilBytesRef:[term bytes]]) {
          jint freq = 1 - [context docFreq];
          [context register__WithOrgApacheLuceneIndexTermState:[termsEnum termState] withInt:leafContext->ord_ withInt:freq withLong:freq];
        }
      }
    }
    return [new_OrgApacheLuceneSearchTermQuery_initWithOrgApacheLuceneIndexTerm_withOrgApacheLuceneIndexTermContext_(term, context) autorelease];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery)

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals

- (instancetype)initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *)outer$
                                                           withNSString:(NSString *)name
                                                              withFloat:(jfloat)similarity
                                                                withInt:(jint)length
                                                           withNSString:(NSString *)queryString {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(self, outer$, name, similarity, length, queryString);
  return self;
}

- (NSUInteger)hash {
  jint prime = 31;
  jint result = 1;
  result = prime * result + ((fieldName_ == nil) ? 0 : ((jint) [fieldName_ hash]));
  result = prime * result + JavaLangFloat_floatToIntBitsWithFloat_(minSimilarity_);
  result = prime * result + prefixLength_;
  result = prime * result + ((queryString_ == nil) ? 0 : ((jint) [queryString_ hash]));
  return result;
}

- (jboolean)isEqual:(id)obj {
  if (self == obj) return true;
  if (obj == nil) return false;
  if ([self getClass] != [nil_chk(obj) getClass]) return false;
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *other = (OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *) check_class_cast(obj, [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals class]);
  if (fieldName_ == nil) {
    if (other->fieldName_ != nil) return false;
  }
  else if (![fieldName_ isEqual:other->fieldName_]) return false;
  if (JavaLangFloat_floatToIntBitsWithFloat_(minSimilarity_) != JavaLangFloat_floatToIntBitsWithFloat_(other->minSimilarity_)) return false;
  if (prefixLength_ != other->prefixLength_) return false;
  if (queryString_ == nil) {
    if (other->queryString_ != nil) return false;
  }
  else if (![queryString_ isEqual:other->queryString_]) return false;
  return true;
}

- (void)dealloc {
  RELEASE_(queryString_);
  RELEASE_(fieldName_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery:withNSString:withFloat:withInt:withNSString:", "FieldVals", NULL, 0x1, NULL, NULL },
    { "hash", "hashCode", "I", 0x1, NULL, NULL },
    { "isEqual:", "equals", "Z", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "queryString_", NULL, 0x0, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "fieldName_", NULL, 0x0, "Ljava.lang.String;", NULL, NULL, .constantValue.asLong = 0 },
    { "minSimilarity_", NULL, 0x0, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "prefixLength_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals = { 2, "FieldVals", "org.apache.lucene.sandbox.queries", "FuzzyLikeThisQuery", 0x0, 3, methods, 4, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals;
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *self, OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *outer$, NSString *name, jfloat similarity, jint length, NSString *queryString) {
  NSObject_init(self);
  JreStrongAssign(&self->fieldName_, name);
  self->minSimilarity_ = similarity;
  self->prefixLength_ = length;
  JreStrongAssign(&self->queryString_, queryString);
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery *outer$, NSString *name, jfloat similarity, jint length, NSString *queryString) {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals *self = [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals alloc];
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals_initWithOrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_withNSString_withFloat_withInt_withNSString_(self, outer$, name, similarity, length, queryString);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_FieldVals)

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm

- (instancetype)initWithOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term
                                       withFloat:(jfloat)score
                    withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)fuzziedSourceTerm {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(self, term, score, fuzziedSourceTerm);
  return self;
}

- (void)dealloc {
  RELEASE_(term_);
  RELEASE_(fuzziedSourceTerm_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneIndexTerm:withFloat:withOrgApacheLuceneIndexTerm:", "ScoreTerm", NULL, 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "term_", NULL, 0x1, "Lorg.apache.lucene.index.Term;", NULL, NULL, .constantValue.asLong = 0 },
    { "score_", NULL, 0x1, "F", NULL, NULL, .constantValue.asLong = 0 },
    { "fuzziedSourceTerm_", NULL, 0x0, "Lorg.apache.lucene.index.Term;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm = { 2, "ScoreTerm", "org.apache.lucene.sandbox.queries", "FuzzyLikeThisQuery", 0xa, 1, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm;
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *self, OrgApacheLuceneIndexTerm *term, jfloat score, OrgApacheLuceneIndexTerm *fuzziedSourceTerm) {
  NSObject_init(self);
  JreStrongAssign(&self->term_, term);
  self->score_ = score;
  JreStrongAssign(&self->fuzziedSourceTerm_, fuzziedSourceTerm);
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneIndexTerm *term, jfloat score, OrgApacheLuceneIndexTerm *fuzziedSourceTerm) {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *self = [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm alloc];
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm_initWithOrgApacheLuceneIndexTerm_withFloat_withOrgApacheLuceneIndexTerm_(self, term, score, fuzziedSourceTerm);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm)

@implementation OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue

- (instancetype)initWithInt:(jint)size {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(self, size);
  return self;
}

- (jboolean)lessThanWithId:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *)termA
                    withId:(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *)termB {
  if (((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(termA))->score_ == ((OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTerm *) nil_chk(termB))->score_) return [((OrgApacheLuceneIndexTerm *) nil_chk(termA->term_)) compareToWithId:termB->term_] > 0;
  else return termA->score_ < termB->score_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithInt:", "ScoreTermQueue", NULL, 0x1, NULL, NULL },
    { "lessThanWithId:withId:", "lessThan", "Z", 0x4, NULL, NULL },
  };
  static const char *superclass_type_args[] = {"Lorg.apache.lucene.sandbox.queries.FuzzyLikeThisQuery$ScoreTerm;"};
  static const J2ObjcClassInfo _OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue = { 2, "ScoreTermQueue", "org.apache.lucene.sandbox.queries", "FuzzyLikeThisQuery", 0xa, 2, methods, 0, NULL, 1, superclass_type_args, 0, NULL, NULL, "Lorg/apache/lucene/util/PriorityQueue<Lorg/apache/lucene/sandbox/queries/FuzzyLikeThisQuery$ScoreTerm;>;" };
  return &_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue;
}

@end

void OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *self, jint size) {
  OrgApacheLuceneUtilPriorityQueue_initWithInt_(self, size);
}

OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *new_OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(jint size) {
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue *self = [OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue alloc];
  OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue_initWithInt_(self, size);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSandboxQueriesFuzzyLikeThisQuery_ScoreTermQueue)

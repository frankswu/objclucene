//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./expressions/src/java/org/apache/lucene/expressions/ExpressionRescorer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/util/ArrayList.h"
#include "java/util/Arrays.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "org/apache/lucene/expressions/Bindings.h"
#include "org/apache/lucene/expressions/Expression.h"
#include "org/apache/lucene/expressions/ExpressionRescorer.h"
#include "org/apache/lucene/expressions/FakeScorer.h"
#include "org/apache/lucene/index/IndexReader.h"
#include "org/apache/lucene/index/LeafReaderContext.h"
#include "org/apache/lucene/index/ReaderUtil.h"
#include "org/apache/lucene/queries/function/FunctionValues.h"
#include "org/apache/lucene/queries/function/ValueSource.h"
#include "org/apache/lucene/search/Explanation.h"
#include "org/apache/lucene/search/IndexSearcher.h"
#include "org/apache/lucene/search/Sort.h"
#include "org/apache/lucene/search/SortField.h"
#include "org/apache/lucene/search/SortRescorer.h"

@interface OrgApacheLuceneExpressionsExpressionRescorer () {
 @public
  OrgApacheLuceneExpressionsExpression *expression_;
  OrgApacheLuceneExpressionsBindings *bindings_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneExpressionsExpressionRescorer, expression_, OrgApacheLuceneExpressionsExpression *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneExpressionsExpressionRescorer, bindings_, OrgApacheLuceneExpressionsBindings *)

@implementation OrgApacheLuceneExpressionsExpressionRescorer

- (instancetype)initWithOrgApacheLuceneExpressionsExpression:(OrgApacheLuceneExpressionsExpression *)expression
                      withOrgApacheLuceneExpressionsBindings:(OrgApacheLuceneExpressionsBindings *)bindings {
  OrgApacheLuceneExpressionsExpressionRescorer_initWithOrgApacheLuceneExpressionsExpression_withOrgApacheLuceneExpressionsBindings_(self, expression, bindings);
  return self;
}

- (OrgApacheLuceneSearchExplanation *)explainWithOrgApacheLuceneSearchIndexSearcher:(OrgApacheLuceneSearchIndexSearcher *)searcher
                                               withOrgApacheLuceneSearchExplanation:(OrgApacheLuceneSearchExplanation *)firstPassExplanation
                                                                            withInt:(jint)docID {
  OrgApacheLuceneSearchExplanation *superExpl = [super explainWithOrgApacheLuceneSearchIndexSearcher:searcher withOrgApacheLuceneSearchExplanation:firstPassExplanation withInt:docID];
  id<JavaUtilList> leaves = [((OrgApacheLuceneIndexIndexReader *) nil_chk([((OrgApacheLuceneSearchIndexSearcher *) nil_chk(searcher)) getIndexReader])) leaves];
  jint subReader = OrgApacheLuceneIndexReaderUtil_subIndexWithInt_withJavaUtilList_(docID, leaves);
  OrgApacheLuceneIndexLeafReaderContext *readerContext = [((id<JavaUtilList>) nil_chk(leaves)) getWithInt:subReader];
  jint docIDInSegment = docID - ((OrgApacheLuceneIndexLeafReaderContext *) nil_chk(readerContext))->docBase_;
  id<JavaUtilMap> context = [new_JavaUtilHashMap_init() autorelease];
  OrgApacheLuceneExpressionsFakeScorer *fakeScorer = [new_OrgApacheLuceneExpressionsFakeScorer_init() autorelease];
  fakeScorer->score_ = [((OrgApacheLuceneSearchExplanation *) nil_chk(firstPassExplanation)) getValue];
  fakeScorer->doc_ = docIDInSegment;
  [context putWithId:@"scorer" withId:fakeScorer];
  id<JavaUtilList> subs = [new_JavaUtilArrayList_initWithJavaUtilCollection_(JavaUtilArrays_asListWithNSObjectArray_([((OrgApacheLuceneSearchExplanation *) nil_chk(superExpl)) getDetails])) autorelease];
  {
    IOSObjectArray *a__ = ((OrgApacheLuceneExpressionsExpression *) nil_chk(expression_))->variables_;
    NSString * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    NSString * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      NSString *variable = *b__++;
      [subs addWithId:OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withOrgApacheLuceneSearchExplanationArray_((jfloat) [((OrgApacheLuceneQueriesFunctionFunctionValues *) nil_chk([((OrgApacheLuceneQueriesFunctionValueSource *) nil_chk([((OrgApacheLuceneExpressionsBindings *) nil_chk(bindings_)) getValueSourceWithNSString:variable])) getValuesWithJavaUtilMap:context withOrgApacheLuceneIndexLeafReaderContext:readerContext])) doubleValWithInt:docIDInSegment], JreStrcat("$$C", @"variable \"", variable, '"'), [IOSObjectArray arrayWithLength:0 type:OrgApacheLuceneSearchExplanation_class_()])];
    }
  }
  return OrgApacheLuceneSearchExplanation_matchWithFloat_withNSString_withJavaUtilCollection_([superExpl getValue], [superExpl getDescription], subs);
}

- (void)dealloc {
  RELEASE_(expression_);
  RELEASE_(bindings_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneExpressionsExpression:withOrgApacheLuceneExpressionsBindings:", "ExpressionRescorer", NULL, 0x1, NULL, NULL },
    { "explainWithOrgApacheLuceneSearchIndexSearcher:withOrgApacheLuceneSearchExplanation:withInt:", "explain", "Lorg.apache.lucene.search.Explanation;", 0x1, "Ljava.io.IOException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "expression_", NULL, 0x12, "Lorg.apache.lucene.expressions.Expression;", NULL, NULL, .constantValue.asLong = 0 },
    { "bindings_", NULL, 0x12, "Lorg.apache.lucene.expressions.Bindings;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneExpressionsExpressionRescorer = { 2, "ExpressionRescorer", "org.apache.lucene.expressions", NULL, 0x0, 2, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneExpressionsExpressionRescorer;
}

@end

void OrgApacheLuceneExpressionsExpressionRescorer_initWithOrgApacheLuceneExpressionsExpression_withOrgApacheLuceneExpressionsBindings_(OrgApacheLuceneExpressionsExpressionRescorer *self, OrgApacheLuceneExpressionsExpression *expression, OrgApacheLuceneExpressionsBindings *bindings) {
  OrgApacheLuceneSearchSortRescorer_initWithOrgApacheLuceneSearchSort_(self, [new_OrgApacheLuceneSearchSort_initWithOrgApacheLuceneSearchSortField_([((OrgApacheLuceneExpressionsExpression *) nil_chk(expression)) getSortFieldWithOrgApacheLuceneExpressionsBindings:bindings withBoolean:YES]) autorelease]);
  JreStrongAssign(&self->expression_, expression);
  JreStrongAssign(&self->bindings_, bindings);
}

OrgApacheLuceneExpressionsExpressionRescorer *new_OrgApacheLuceneExpressionsExpressionRescorer_initWithOrgApacheLuceneExpressionsExpression_withOrgApacheLuceneExpressionsBindings_(OrgApacheLuceneExpressionsExpression *expression, OrgApacheLuceneExpressionsBindings *bindings) {
  OrgApacheLuceneExpressionsExpressionRescorer *self = [OrgApacheLuceneExpressionsExpressionRescorer alloc];
  OrgApacheLuceneExpressionsExpressionRescorer_initWithOrgApacheLuceneExpressionsExpression_withOrgApacheLuceneExpressionsBindings_(self, expression, bindings);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneExpressionsExpressionRescorer)

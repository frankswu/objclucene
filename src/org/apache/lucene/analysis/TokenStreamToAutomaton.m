//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/analysis/TokenStreamToAutomaton.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Character.h"
#include "java/lang/Math.h"
#include "org/apache/lucene/analysis/TokenStream.h"
#include "org/apache/lucene/analysis/TokenStreamToAutomaton.h"
#include "org/apache/lucene/analysis/tokenattributes/OffsetAttribute.h"
#include "org/apache/lucene/analysis/tokenattributes/PositionIncrementAttribute.h"
#include "org/apache/lucene/analysis/tokenattributes/PositionLengthAttribute.h"
#include "org/apache/lucene/analysis/tokenattributes/TermToBytesRefAttribute.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/RollingBuffer.h"
#include "org/apache/lucene/util/automaton/Automaton.h"

@interface OrgApacheLuceneAnalysisTokenStreamToAutomaton () {
 @public
  jboolean preservePositionIncrements_;
  jboolean unicodeArcs_;
}

+ (void)addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder:(OrgApacheLuceneUtilAutomatonAutomaton_Builder *)builder
                             withOrgApacheLuceneUtilRollingBuffer:(OrgApacheLuceneUtilRollingBuffer *)positions
                                                          withInt:(jint)pos;

@end

__attribute__((unused)) static void OrgApacheLuceneAnalysisTokenStreamToAutomaton_addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder_withOrgApacheLuceneUtilRollingBuffer_withInt_(OrgApacheLuceneUtilAutomatonAutomaton_Builder *builder, OrgApacheLuceneUtilRollingBuffer *positions, jint pos);

@interface OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position : NSObject < OrgApacheLuceneUtilRollingBuffer_Resettable > {
 @public
  jint arriving_;
  jint leaving_;
}

- (void)reset;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position)

__attribute__((unused)) static void OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position_init(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *self);

__attribute__((unused)) static OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *new_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position_init() NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position)

@interface OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions : OrgApacheLuceneUtilRollingBuffer

- (OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *)newInstance OBJC_METHOD_FAMILY_NONE;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions)

__attribute__((unused)) static void OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions_init(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions *self);

__attribute__((unused)) static OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions *new_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions_init() NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions)

@implementation OrgApacheLuceneAnalysisTokenStreamToAutomaton

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (void)setPreservePositionIncrementsWithBoolean:(jboolean)enablePositionIncrements {
  self->preservePositionIncrements_ = enablePositionIncrements;
}

- (void)setUnicodeArcsWithBoolean:(jboolean)unicodeArcs {
  self->unicodeArcs_ = unicodeArcs;
}

- (OrgApacheLuceneUtilBytesRef *)changeTokenWithOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)inArg {
  return inArg;
}

- (OrgApacheLuceneUtilAutomatonAutomaton *)toAutomatonWithOrgApacheLuceneAnalysisTokenStream:(OrgApacheLuceneAnalysisTokenStream *)inArg {
  OrgApacheLuceneUtilAutomatonAutomaton_Builder *builder = [new_OrgApacheLuceneUtilAutomatonAutomaton_Builder_init() autorelease];
  [builder createState];
  id<OrgApacheLuceneAnalysisTokenattributesTermToBytesRefAttribute> termBytesAtt = [((OrgApacheLuceneAnalysisTokenStream *) nil_chk(inArg)) addAttributeWithIOSClass:OrgApacheLuceneAnalysisTokenattributesTermToBytesRefAttribute_class_()];
  id<OrgApacheLuceneAnalysisTokenattributesPositionIncrementAttribute> posIncAtt = [inArg addAttributeWithIOSClass:OrgApacheLuceneAnalysisTokenattributesPositionIncrementAttribute_class_()];
  id<OrgApacheLuceneAnalysisTokenattributesPositionLengthAttribute> posLengthAtt = [inArg addAttributeWithIOSClass:OrgApacheLuceneAnalysisTokenattributesPositionLengthAttribute_class_()];
  id<OrgApacheLuceneAnalysisTokenattributesOffsetAttribute> offsetAtt = [inArg addAttributeWithIOSClass:OrgApacheLuceneAnalysisTokenattributesOffsetAttribute_class_()];
  [inArg reset];
  OrgApacheLuceneUtilRollingBuffer *positions = [new_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions_init() autorelease];
  jint pos = -1;
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *posData = nil;
  jint maxOffset = 0;
  while ([inArg incrementToken]) {
    jint posInc = [((id<OrgApacheLuceneAnalysisTokenattributesPositionIncrementAttribute>) nil_chk(posIncAtt)) getPositionIncrement];
    if (!preservePositionIncrements_ && posInc > 1) {
      posInc = 1;
    }
    JreAssert((pos > -1 || posInc > 0), (@"org/apache/lucene/analysis/TokenStreamToAutomaton.java:123 condition failed: assert pos > -1 || posInc > 0;"));
    if (posInc > 0) {
      pos += posInc;
      posData = [positions getWithInt:pos];
      JreAssert((((OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *) nil_chk(posData))->leaving_ == -1), (@"org/apache/lucene/analysis/TokenStreamToAutomaton.java:131 condition failed: assert posData.leaving == -1;"));
      if (posData->arriving_ == -1) {
        if (pos == 0) {
          posData->leaving_ = 0;
        }
        else {
          posData->leaving_ = [builder createState];
          OrgApacheLuceneAnalysisTokenStreamToAutomaton_addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder_withOrgApacheLuceneUtilRollingBuffer_withInt_(builder, positions, pos);
        }
      }
      else {
        posData->leaving_ = [builder createState];
        [builder addTransitionWithInt:posData->arriving_ withInt:posData->leaving_ withInt:OrgApacheLuceneAnalysisTokenStreamToAutomaton_POS_SEP];
        if (posInc > 1) {
          OrgApacheLuceneAnalysisTokenStreamToAutomaton_addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder_withOrgApacheLuceneUtilRollingBuffer_withInt_(builder, positions, pos);
        }
      }
      [positions freeBeforeWithInt:pos];
    }
    jint endPos = pos + [((id<OrgApacheLuceneAnalysisTokenattributesPositionLengthAttribute>) nil_chk(posLengthAtt)) getPositionLength];
    OrgApacheLuceneUtilBytesRef *termUTF8 = [self changeTokenWithOrgApacheLuceneUtilBytesRef:[((id<OrgApacheLuceneAnalysisTokenattributesTermToBytesRefAttribute>) nil_chk(termBytesAtt)) getBytesRef]];
    IOSIntArray *termUnicode = nil;
    OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *endPosData = [positions getWithInt:endPos];
    if (((OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *) nil_chk(endPosData))->arriving_ == -1) {
      endPosData->arriving_ = [builder createState];
    }
    jint termLen;
    if (unicodeArcs_) {
      NSString *utf16 = [((OrgApacheLuceneUtilBytesRef *) nil_chk(termUTF8)) utf8ToString];
      termUnicode = [IOSIntArray arrayWithLength:[utf16 codePointCount:0 endIndex:((jint) [((NSString *) nil_chk(utf16)) length])]];
      termLen = termUnicode->size_;
      for (jint cp, i = 0, j = 0; i < ((jint) [utf16 length]); i += JavaLangCharacter_charCountWithInt_(cp)) {
        *IOSIntArray_GetRef(termUnicode, j++) = cp = [utf16 codePointAt:i];
      }
    }
    else {
      termLen = ((OrgApacheLuceneUtilBytesRef *) nil_chk(termUTF8))->length_;
    }
    jint state = ((OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *) nil_chk(posData))->leaving_;
    for (jint byteIDX = 0; byteIDX < termLen; byteIDX++) {
      jint nextState = byteIDX == termLen - 1 ? endPosData->arriving_ : [builder createState];
      jint c;
      if (unicodeArcs_) {
        c = IOSIntArray_Get(nil_chk(termUnicode), byteIDX);
      }
      else {
        c = IOSByteArray_Get(nil_chk(((OrgApacheLuceneUtilBytesRef *) nil_chk(termUTF8))->bytes_), termUTF8->offset_ + byteIDX) & (jint) 0xff;
      }
      [builder addTransitionWithInt:state withInt:nextState withInt:c];
      state = nextState;
    }
    maxOffset = JavaLangMath_maxWithInt_withInt_(maxOffset, [((id<OrgApacheLuceneAnalysisTokenattributesOffsetAttribute>) nil_chk(offsetAtt)) endOffset]);
  }
  [inArg end];
  jint endState = -1;
  if ([((id<OrgApacheLuceneAnalysisTokenattributesOffsetAttribute>) nil_chk(offsetAtt)) endOffset] > maxOffset) {
    endState = [builder createState];
    [builder setAcceptWithInt:endState withBoolean:true];
  }
  pos++;
  while (pos <= [positions getMaxPos]) {
    posData = [positions getWithInt:pos];
    if (((OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *) nil_chk(posData))->arriving_ != -1) {
      if (endState != -1) {
        [builder addTransitionWithInt:posData->arriving_ withInt:endState withInt:OrgApacheLuceneAnalysisTokenStreamToAutomaton_POS_SEP];
      }
      else {
        [builder setAcceptWithInt:posData->arriving_ withBoolean:true];
      }
    }
    pos++;
  }
  return [builder finish];
}

+ (void)addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder:(OrgApacheLuceneUtilAutomatonAutomaton_Builder *)builder
                             withOrgApacheLuceneUtilRollingBuffer:(OrgApacheLuceneUtilRollingBuffer *)positions
                                                          withInt:(jint)pos {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder_withOrgApacheLuceneUtilRollingBuffer_withInt_(builder, positions, pos);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", "TokenStreamToAutomaton", NULL, 0x1, NULL, NULL },
    { "setPreservePositionIncrementsWithBoolean:", "setPreservePositionIncrements", "V", 0x1, NULL, NULL },
    { "setUnicodeArcsWithBoolean:", "setUnicodeArcs", "V", 0x1, NULL, NULL },
    { "changeTokenWithOrgApacheLuceneUtilBytesRef:", "changeToken", "Lorg.apache.lucene.util.BytesRef;", 0x4, NULL, NULL },
    { "toAutomatonWithOrgApacheLuceneAnalysisTokenStream:", "toAutomaton", "Lorg.apache.lucene.util.automaton.Automaton;", 0x1, "Ljava.io.IOException;", NULL },
    { "addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder:withOrgApacheLuceneUtilRollingBuffer:withInt:", "addHoles", "V", 0xa, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "preservePositionIncrements_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "unicodeArcs_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "POS_SEP", "POS_SEP", 0x19, "I", NULL, NULL, .constantValue.asInt = OrgApacheLuceneAnalysisTokenStreamToAutomaton_POS_SEP },
    { "HOLE", "HOLE", 0x19, "I", NULL, NULL, .constantValue.asInt = OrgApacheLuceneAnalysisTokenStreamToAutomaton_HOLE },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.analysis.TokenStreamToAutomaton$Position;", "Lorg.apache.lucene.analysis.TokenStreamToAutomaton$Positions;"};
  static const J2ObjcClassInfo _OrgApacheLuceneAnalysisTokenStreamToAutomaton = { 2, "TokenStreamToAutomaton", "org.apache.lucene.analysis", NULL, 0x1, 6, methods, 4, fields, 0, NULL, 2, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneAnalysisTokenStreamToAutomaton;
}

@end

void OrgApacheLuceneAnalysisTokenStreamToAutomaton_init(OrgApacheLuceneAnalysisTokenStreamToAutomaton *self) {
  NSObject_init(self);
  self->preservePositionIncrements_ = true;
}

OrgApacheLuceneAnalysisTokenStreamToAutomaton *new_OrgApacheLuceneAnalysisTokenStreamToAutomaton_init() {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton *self = [OrgApacheLuceneAnalysisTokenStreamToAutomaton alloc];
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_init(self);
  return self;
}

void OrgApacheLuceneAnalysisTokenStreamToAutomaton_addHolesWithOrgApacheLuceneUtilAutomatonAutomaton_Builder_withOrgApacheLuceneUtilRollingBuffer_withInt_(OrgApacheLuceneUtilAutomatonAutomaton_Builder *builder, OrgApacheLuceneUtilRollingBuffer *positions, jint pos) {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_initialize();
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *posData = [((OrgApacheLuceneUtilRollingBuffer *) nil_chk(positions)) getWithInt:pos];
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *prevPosData = [positions getWithInt:pos - 1];
  while (((OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *) nil_chk(posData))->arriving_ == -1 || ((OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *) nil_chk(prevPosData))->leaving_ == -1) {
    if (posData->arriving_ == -1) {
      posData->arriving_ = [((OrgApacheLuceneUtilAutomatonAutomaton_Builder *) nil_chk(builder)) createState];
      [builder addTransitionWithInt:posData->arriving_ withInt:posData->leaving_ withInt:OrgApacheLuceneAnalysisTokenStreamToAutomaton_POS_SEP];
    }
    if (((OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *) nil_chk(prevPosData))->leaving_ == -1) {
      if (pos == 1) {
        prevPosData->leaving_ = 0;
      }
      else {
        prevPosData->leaving_ = [((OrgApacheLuceneUtilAutomatonAutomaton_Builder *) nil_chk(builder)) createState];
      }
      if (prevPosData->arriving_ != -1) {
        [((OrgApacheLuceneUtilAutomatonAutomaton_Builder *) nil_chk(builder)) addTransitionWithInt:prevPosData->arriving_ withInt:prevPosData->leaving_ withInt:OrgApacheLuceneAnalysisTokenStreamToAutomaton_POS_SEP];
      }
    }
    [((OrgApacheLuceneUtilAutomatonAutomaton_Builder *) nil_chk(builder)) addTransitionWithInt:prevPosData->leaving_ withInt:posData->arriving_ withInt:OrgApacheLuceneAnalysisTokenStreamToAutomaton_HOLE];
    pos--;
    if (pos <= 0) {
      break;
    }
    posData = prevPosData;
    prevPosData = [positions getWithInt:pos - 1];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneAnalysisTokenStreamToAutomaton)

@implementation OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position

- (void)reset {
  arriving_ = -1;
  leaving_ = -1;
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "reset", NULL, "V", 0x1, NULL, NULL },
    { "init", NULL, NULL, 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "arriving_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "leaving_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position = { 2, "Position", "org.apache.lucene.analysis", "TokenStreamToAutomaton", 0xa, 2, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position;
}

@end

void OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position_init(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *self) {
  NSObject_init(self);
  self->arriving_ = -1;
  self->leaving_ = -1;
}

OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *new_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position_init() {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *self = [OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position alloc];
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position)

@implementation OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions

- (OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position *)newInstance {
  return [new_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Position_init() autorelease];
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "newInstance", NULL, "Lorg.apache.lucene.analysis.TokenStreamToAutomaton$Position;", 0x4, NULL, NULL },
    { "init", NULL, NULL, 0x2, NULL, NULL },
  };
  static const char *superclass_type_args[] = {"Lorg.apache.lucene.analysis.TokenStreamToAutomaton$Position;"};
  static const J2ObjcClassInfo _OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions = { 2, "Positions", "org.apache.lucene.analysis", "TokenStreamToAutomaton", 0xa, 2, methods, 0, NULL, 1, superclass_type_args, 0, NULL, NULL, "Lorg/apache/lucene/util/RollingBuffer<Lorg/apache/lucene/analysis/TokenStreamToAutomaton$Position;>;" };
  return &_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions;
}

@end

void OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions_init(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions *self) {
  OrgApacheLuceneUtilRollingBuffer_init(self);
}

OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions *new_OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions_init() {
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions *self = [OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions alloc];
  OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneAnalysisTokenStreamToAutomaton_Positions)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./queryparser/src/java/org/apache/lucene/queryparser/xml/builders/CachedFilterBuilder.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/util/HashMap.h"
#include "java/util/LinkedHashMap.h"
#include "java/util/Map.h"
#include "org/apache/lucene/queryparser/xml/DOMUtils.h"
#include "org/apache/lucene/queryparser/xml/FilterBuilderFactory.h"
#include "org/apache/lucene/queryparser/xml/ParserException.h"
#include "org/apache/lucene/queryparser/xml/QueryBuilder.h"
#include "org/apache/lucene/queryparser/xml/QueryBuilderFactory.h"
#include "org/apache/lucene/queryparser/xml/builders/CachedFilterBuilder.h"
#include "org/apache/lucene/search/CachingWrapperQuery.h"
#include "org/apache/lucene/search/Filter.h"
#include "org/apache/lucene/search/Query.h"
#include "org/apache/lucene/search/QueryWrapperFilter.h"
#include "org/w3c/dom/Element.h"

@interface OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder () {
 @public
  OrgApacheLuceneQueryparserXmlQueryBuilderFactory *queryFactory_;
  OrgApacheLuceneQueryparserXmlFilterBuilderFactory *filterFactory_;
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *filterCache_;
  jint cacheSize_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, queryFactory_, OrgApacheLuceneQueryparserXmlQueryBuilderFactory *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, filterFactory_, OrgApacheLuceneQueryparserXmlFilterBuilderFactory *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder, filterCache_, OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *)

@implementation OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder

- (instancetype)initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory:(OrgApacheLuceneQueryparserXmlQueryBuilderFactory *)queryFactory
                   withOrgApacheLuceneQueryparserXmlFilterBuilderFactory:(OrgApacheLuceneQueryparserXmlFilterBuilderFactory *)filterFactory
                                                                 withInt:(jint)cacheSize {
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(self, queryFactory, filterFactory, cacheSize);
  return self;
}

- (OrgApacheLuceneSearchFilter *)getFilterWithOrgW3cDomElement:(id<OrgW3cDomElement>)e {
  @synchronized(self) {
    id<OrgW3cDomElement> childElement = OrgApacheLuceneQueryparserXmlDOMUtils_getFirstChildOrFailWithOrgW3cDomElement_(e);
    if (filterCache_ == nil) {
      JreStrongAssignAndConsume(&filterCache_, new_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(cacheSize_));
    }
    id<OrgApacheLuceneQueryparserXmlQueryBuilder> qb = [((OrgApacheLuceneQueryparserXmlQueryBuilderFactory *) nil_chk(queryFactory_)) getQueryBuilderWithNSString:[((id<OrgW3cDomElement>) nil_chk(childElement)) getNodeName]];
    id cacheKey = nil;
    OrgApacheLuceneSearchQuery *q = nil;
    OrgApacheLuceneSearchFilter *f = nil;
    if (qb != nil) {
      q = [qb getQueryWithOrgW3cDomElement:childElement];
      cacheKey = q;
    }
    else {
      f = [((OrgApacheLuceneQueryparserXmlFilterBuilderFactory *) nil_chk(filterFactory_)) getFilterWithOrgW3cDomElement:childElement];
      cacheKey = f;
    }
    OrgApacheLuceneSearchQuery *cachedFilter = [((OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *) nil_chk(filterCache_)) getWithId:cacheKey];
    if (cachedFilter != nil) {
      return [new_OrgApacheLuceneSearchQueryWrapperFilter_initWithOrgApacheLuceneSearchQuery_(cachedFilter) autorelease];
    }
    if (qb != nil) {
      cachedFilter = [new_OrgApacheLuceneSearchQueryWrapperFilter_initWithOrgApacheLuceneSearchQuery_(q) autorelease];
    }
    else {
      cachedFilter = [new_OrgApacheLuceneSearchCachingWrapperQuery_initWithOrgApacheLuceneSearchQuery_(f) autorelease];
    }
    [filterCache_ putWithId:cacheKey withId:cachedFilter];
    return [new_OrgApacheLuceneSearchQueryWrapperFilter_initWithOrgApacheLuceneSearchQuery_(cachedFilter) autorelease];
  }
}

- (void)dealloc {
  RELEASE_(queryFactory_);
  RELEASE_(filterFactory_);
  RELEASE_(filterCache_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory:withOrgApacheLuceneQueryparserXmlFilterBuilderFactory:withInt:", "CachedFilterBuilder", NULL, 0x1, NULL, NULL },
    { "getFilterWithOrgW3cDomElement:", "getFilter", "Lorg.apache.lucene.search.Filter;", 0x21, "Lorg.apache.lucene.queryparser.xml.ParserException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "queryFactory_", NULL, 0x12, "Lorg.apache.lucene.queryparser.xml.QueryBuilderFactory;", NULL, NULL, .constantValue.asLong = 0 },
    { "filterFactory_", NULL, 0x12, "Lorg.apache.lucene.queryparser.xml.FilterBuilderFactory;", NULL, NULL, .constantValue.asLong = 0 },
    { "filterCache_", NULL, 0x2, "Lorg.apache.lucene.queryparser.xml.builders.CachedFilterBuilder$LRUCache;", NULL, "Lorg/apache/lucene/queryparser/xml/builders/CachedFilterBuilder$LRUCache<Ljava/lang/Object;Lorg/apache/lucene/search/Query;>;", .constantValue.asLong = 0 },
    { "cacheSize_", NULL, 0x12, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.queryparser.xml.builders.CachedFilterBuilder$LRUCache;"};
  static const J2ObjcClassInfo _OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder = { 2, "CachedFilterBuilder", "org.apache.lucene.queryparser.xml.builders", NULL, 0x1, 2, methods, 4, fields, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder;
}

@end

void OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder *self, OrgApacheLuceneQueryparserXmlQueryBuilderFactory *queryFactory, OrgApacheLuceneQueryparserXmlFilterBuilderFactory *filterFactory, jint cacheSize) {
  NSObject_init(self);
  JreStrongAssign(&self->queryFactory_, queryFactory);
  JreStrongAssign(&self->filterFactory_, filterFactory);
  self->cacheSize_ = cacheSize;
}

OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder *new_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(OrgApacheLuceneQueryparserXmlQueryBuilderFactory *queryFactory, OrgApacheLuceneQueryparserXmlFilterBuilderFactory *filterFactory, jint cacheSize) {
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder *self = [OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder alloc];
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_initWithOrgApacheLuceneQueryparserXmlQueryBuilderFactory_withOrgApacheLuceneQueryparserXmlFilterBuilderFactory_withInt_(self, queryFactory, filterFactory, cacheSize);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder)

@implementation OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache

- (instancetype)initWithInt:(jint)maxsize {
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(self, maxsize);
  return self;
}

- (jboolean)removeEldestEntryWithJavaUtilMap_Entry:(id<JavaUtilMap_Entry>)eldest {
  return [self size] > maxsize_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithInt:", "LRUCache", NULL, 0x1, NULL, NULL },
    { "removeEldestEntryWithJavaUtilMap_Entry:", "removeEldestEntry", "Z", 0x4, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "maxsize_", NULL, 0x4, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *superclass_type_args[] = {"TK;", "TV;"};
  static const J2ObjcClassInfo _OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache = { 2, "LRUCache", "org.apache.lucene.queryparser.xml.builders", "CachedFilterBuilder", 0x8, 2, methods, 1, fields, 2, superclass_type_args, 0, NULL, NULL, "<K:Ljava/lang/Object;V:Ljava/lang/Object;>Ljava/util/LinkedHashMap<TK;TV;>;" };
  return &_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache;
}

@end

void OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *self, jint maxsize) {
  JavaUtilLinkedHashMap_initWithInt_withFloat_withBoolean_(self, maxsize * 4 / 3 + 1, 0.75f, YES);
  self->maxsize_ = maxsize;
}

OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *new_OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(jint maxsize) {
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache *self = [OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache alloc];
  OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache_initWithInt_(self, maxsize);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneQueryparserXmlBuildersCachedFilterBuilder_LRUCache)

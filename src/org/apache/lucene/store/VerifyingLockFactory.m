//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/store/VerifyingLockFactory.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/io/InputStream.h"
#include "java/io/OutputStream.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/Throwable.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/Lock.h"
#include "org/apache/lucene/store/LockFactory.h"
#include "org/apache/lucene/store/VerifyingLockFactory.h"

@interface OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock : OrgApacheLuceneStoreLock {
 @public
  OrgApacheLuceneStoreVerifyingLockFactory *this$0_;
  OrgApacheLuceneStoreLock *lock_;
}

- (instancetype)initWithOrgApacheLuceneStoreVerifyingLockFactory:(OrgApacheLuceneStoreVerifyingLockFactory *)outer$
                                    withOrgApacheLuceneStoreLock:(OrgApacheLuceneStoreLock *)lock;

- (void)ensureValid;

- (void)close;

- (void)verifyWithByte:(jbyte)message;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock)

J2OBJC_FIELD_SETTER(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock, this$0_, OrgApacheLuceneStoreVerifyingLockFactory *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock, lock_, OrgApacheLuceneStoreLock *)

__attribute__((unused)) static void OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_initWithOrgApacheLuceneStoreVerifyingLockFactory_withOrgApacheLuceneStoreLock_(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock *self, OrgApacheLuceneStoreVerifyingLockFactory *outer$, OrgApacheLuceneStoreLock *lock);

__attribute__((unused)) static OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock *new_OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_initWithOrgApacheLuceneStoreVerifyingLockFactory_withOrgApacheLuceneStoreLock_(OrgApacheLuceneStoreVerifyingLockFactory *outer$, OrgApacheLuceneStoreLock *lock) NS_RETURNS_RETAINED;

__attribute__((unused)) static void OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_verifyWithByte_(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock *self, jbyte message);

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock)

@implementation OrgApacheLuceneStoreVerifyingLockFactory

- (instancetype)initWithOrgApacheLuceneStoreLockFactory:(OrgApacheLuceneStoreLockFactory *)lf
                                  withJavaIoInputStream:(JavaIoInputStream *)inArg
                                 withJavaIoOutputStream:(JavaIoOutputStream *)outArg {
  OrgApacheLuceneStoreVerifyingLockFactory_initWithOrgApacheLuceneStoreLockFactory_withJavaIoInputStream_withJavaIoOutputStream_(self, lf, inArg, outArg);
  return self;
}

- (OrgApacheLuceneStoreLock *)obtainLockWithOrgApacheLuceneStoreDirectory:(OrgApacheLuceneStoreDirectory *)dir
                                                             withNSString:(NSString *)lockName {
  return [new_OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_initWithOrgApacheLuceneStoreVerifyingLockFactory_withOrgApacheLuceneStoreLock_(self, [((OrgApacheLuceneStoreLockFactory *) nil_chk(lf_)) obtainLockWithOrgApacheLuceneStoreDirectory:dir withNSString:lockName]) autorelease];
}

- (void)dealloc {
  RELEASE_(lf_);
  RELEASE_(in_);
  RELEASE_(out_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneStoreLockFactory:withJavaIoInputStream:withJavaIoOutputStream:", "VerifyingLockFactory", NULL, 0x1, "Ljava.io.IOException;", NULL },
    { "obtainLockWithOrgApacheLuceneStoreDirectory:withNSString:", "obtainLock", "Lorg.apache.lucene.store.Lock;", 0x1, "Ljava.io.IOException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "lf_", NULL, 0x10, "Lorg.apache.lucene.store.LockFactory;", NULL, NULL, .constantValue.asLong = 0 },
    { "in_", NULL, 0x10, "Ljava.io.InputStream;", NULL, NULL, .constantValue.asLong = 0 },
    { "out_", NULL, 0x10, "Ljava.io.OutputStream;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.store.VerifyingLockFactory$CheckedLock;"};
  static const J2ObjcClassInfo _OrgApacheLuceneStoreVerifyingLockFactory = { 2, "VerifyingLockFactory", "org.apache.lucene.store", NULL, 0x11, 2, methods, 3, fields, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneStoreVerifyingLockFactory;
}

@end

void OrgApacheLuceneStoreVerifyingLockFactory_initWithOrgApacheLuceneStoreLockFactory_withJavaIoInputStream_withJavaIoOutputStream_(OrgApacheLuceneStoreVerifyingLockFactory *self, OrgApacheLuceneStoreLockFactory *lf, JavaIoInputStream *inArg, JavaIoOutputStream *outArg) {
  OrgApacheLuceneStoreLockFactory_init(self);
  JreStrongAssign(&self->lf_, lf);
  JreStrongAssign(&self->in_, inArg);
  JreStrongAssign(&self->out_, outArg);
}

OrgApacheLuceneStoreVerifyingLockFactory *new_OrgApacheLuceneStoreVerifyingLockFactory_initWithOrgApacheLuceneStoreLockFactory_withJavaIoInputStream_withJavaIoOutputStream_(OrgApacheLuceneStoreLockFactory *lf, JavaIoInputStream *inArg, JavaIoOutputStream *outArg) {
  OrgApacheLuceneStoreVerifyingLockFactory *self = [OrgApacheLuceneStoreVerifyingLockFactory alloc];
  OrgApacheLuceneStoreVerifyingLockFactory_initWithOrgApacheLuceneStoreLockFactory_withJavaIoInputStream_withJavaIoOutputStream_(self, lf, inArg, outArg);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneStoreVerifyingLockFactory)

@implementation OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock

- (instancetype)initWithOrgApacheLuceneStoreVerifyingLockFactory:(OrgApacheLuceneStoreVerifyingLockFactory *)outer$
                                    withOrgApacheLuceneStoreLock:(OrgApacheLuceneStoreLock *)lock {
  OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_initWithOrgApacheLuceneStoreVerifyingLockFactory_withOrgApacheLuceneStoreLock_(self, outer$, lock);
  return self;
}

- (void)ensureValid {
  [((OrgApacheLuceneStoreLock *) nil_chk(lock_)) ensureValid];
}

- (void)close {
  {
    OrgApacheLuceneStoreLock *l = lock_;
    JavaLangThrowable *__primaryException1 = nil;
    @try {
      [((OrgApacheLuceneStoreLock *) nil_chk(l)) ensureValid];
      OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_verifyWithByte_(self, (jbyte) 0);
    }
    @catch (JavaLangThrowable *e) {
      __primaryException1 = e;
      @throw e;
    }
    @finally {
      if (l != nil) {
        if (__primaryException1 != nil) {
          @try {
            [l close];
          } @catch (JavaLangThrowable *e) {
            [__primaryException1 addSuppressedWithJavaLangThrowable:e];
          }
        } else {
          [l close];
        }
      }
    }
  }
}

- (void)verifyWithByte:(jbyte)message {
  OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_verifyWithByte_(self, message);
}

- (void)dealloc {
  RELEASE_(this$0_);
  RELEASE_(lock_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneStoreVerifyingLockFactory:withOrgApacheLuceneStoreLock:", "CheckedLock", NULL, 0x1, NULL, NULL },
    { "ensureValid", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "close", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "verifyWithByte:", "verify", "V", 0x2, "Ljava.io.IOException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lorg.apache.lucene.store.VerifyingLockFactory;", NULL, NULL, .constantValue.asLong = 0 },
    { "lock_", NULL, 0x12, "Lorg.apache.lucene.store.Lock;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock = { 2, "CheckedLock", "org.apache.lucene.store", "VerifyingLockFactory", 0x2, 4, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock;
}

@end

void OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_initWithOrgApacheLuceneStoreVerifyingLockFactory_withOrgApacheLuceneStoreLock_(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock *self, OrgApacheLuceneStoreVerifyingLockFactory *outer$, OrgApacheLuceneStoreLock *lock) {
  JreStrongAssign(&self->this$0_, outer$);
  OrgApacheLuceneStoreLock_init(self);
  JreStrongAssign(&self->lock_, lock);
  OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_verifyWithByte_(self, (jbyte) 1);
}

OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock *new_OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_initWithOrgApacheLuceneStoreVerifyingLockFactory_withOrgApacheLuceneStoreLock_(OrgApacheLuceneStoreVerifyingLockFactory *outer$, OrgApacheLuceneStoreLock *lock) {
  OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock *self = [OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock alloc];
  OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_initWithOrgApacheLuceneStoreVerifyingLockFactory_withOrgApacheLuceneStoreLock_(self, outer$, lock);
  return self;
}

void OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock_verifyWithByte_(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock *self, jbyte message) {
  [((JavaIoOutputStream *) nil_chk(self->this$0_->out_)) writeWithInt:message];
  [self->this$0_->out_ flush];
  jint ret = [((JavaIoInputStream *) nil_chk(self->this$0_->in_)) read];
  if (ret < 0) {
    @throw [new_JavaLangIllegalStateException_initWithNSString_(@"Lock server died because of locking error.") autorelease];
  }
  if (ret != message) {
    @throw [new_JavaIoIOException_initWithNSString_(@"Protocol violation.") autorelease];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneStoreVerifyingLockFactory_CheckedLock)

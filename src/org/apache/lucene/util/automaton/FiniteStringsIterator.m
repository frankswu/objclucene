//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/util/automaton/FiniteStringsIterator.java
//

#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/System.h"
#include "java/util/BitSet.h"
#include "org/apache/lucene/util/ArrayUtil.h"
#include "org/apache/lucene/util/IntsRef.h"
#include "org/apache/lucene/util/IntsRefBuilder.h"
#include "org/apache/lucene/util/RamUsageEstimator.h"
#include "org/apache/lucene/util/automaton/Automaton.h"
#include "org/apache/lucene/util/automaton/FiniteStringsIterator.h"
#include "org/apache/lucene/util/automaton/Transition.h"

@interface OrgApacheLuceneUtilAutomatonFiniteStringsIterator () {
 @public
  /*!
   @brief Automaton to create finite string from.
   */
  OrgApacheLuceneUtilAutomatonAutomaton *a_;
  /*!
   @brief Tracks which states are in the current path, for cycle detection.
   */
  JavaUtilBitSet *pathStates_;
  /*!
   @brief Builder for current finite string.
   */
  OrgApacheLuceneUtilIntsRefBuilder *string_;
  /*!
   @brief Stack to hold our current state in the recursion/iteration.
   */
  IOSObjectArray *nodes_;
  /*!
   @brief Emit empty string?.
   */
  jboolean emitEmptyString_;
}

/*!
 @brief Grow path stack, if required.
 */
- (void)growStackWithInt:(jint)depth;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, a_, OrgApacheLuceneUtilAutomatonAutomaton *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, pathStates_, JavaUtilBitSet *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, string_, OrgApacheLuceneUtilIntsRefBuilder *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, nodes_, IOSObjectArray *)

/*!
 @brief Empty string.
 */
inline OrgApacheLuceneUtilIntsRef *OrgApacheLuceneUtilAutomatonFiniteStringsIterator_get_EMPTY();
static OrgApacheLuceneUtilIntsRef *OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY;
J2OBJC_STATIC_FIELD_OBJ_FINAL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, EMPTY, OrgApacheLuceneUtilIntsRef *)

__attribute__((unused)) static void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(OrgApacheLuceneUtilAutomatonFiniteStringsIterator *self, jint depth);

/*!
 @brief Nodes for path stack.
 */
@interface OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode : NSObject {
 @public
  /*!
   @brief Which state the path node ends on, whose
 transitions we are enumerating.
   */
  jint state_;
  /*!
   @brief Which state the current transition leads to.
   */
  jint to_;
  /*!
   @brief Which transition we are on.
   */
  jint transition_;
  /*!
   @brief Which label we are on, in the min-max range of the
 current Transition
   */
  jint label_;
  OrgApacheLuceneUtilAutomatonTransition *t_;
}

- (void)resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a
                                                    withInt:(jint)state;

/*!
 @brief Returns next label of current transition, or
 advances to next transition and returns its first
 label, if current one is exhausted.
 If there are
 no more transitions, returns -1. 
 */
- (jint)nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode)

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode, t_, OrgApacheLuceneUtilAutomatonTransition *)

__attribute__((unused)) static void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *self);

__attribute__((unused)) static OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init() NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *create_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init();

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneUtilAutomatonFiniteStringsIterator)

@implementation OrgApacheLuceneUtilAutomatonFiniteStringsIterator

- (instancetype)initWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a {
  OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(self, a);
  return self;
}

- (OrgApacheLuceneUtilIntsRef *)next {
  if (emitEmptyString_) {
    emitEmptyString_ = false;
    return OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY;
  }
  for (jint depth = [((OrgApacheLuceneUtilIntsRefBuilder *) nil_chk(string_)) length]; depth > 0; ) {
    OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *node = IOSObjectArray_Get(nil_chk(nodes_), depth - 1);
    jint label = [((OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *) nil_chk(node)) nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:a_];
    if (label != -1) {
      [string_ setIntAtWithInt:depth - 1 withInt:label];
      jint to = node->to_;
      if ([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a_)) getNumTransitionsWithInt:to] != 0) {
        if ([((JavaUtilBitSet *) nil_chk(pathStates_)) getWithInt:to]) {
          @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"automaton has cycles");
        }
        [pathStates_ setWithInt:to];
        OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(self, depth);
        [((OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *) nil_chk(IOSObjectArray_Get(nil_chk(nodes_), depth))) resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:a_ withInt:to];
        depth++;
        [string_ setLengthWithInt:depth];
        [string_ growWithInt:depth];
      }
      else if ([a_ isAcceptWithInt:to]) {
        return [string_ get];
      }
    }
    else {
      jint state = node->state_;
      JreAssert(([((JavaUtilBitSet *) nil_chk(pathStates_)) getWithInt:state]), (@"org/apache/lucene/util/automaton/FiniteStringsIterator.java:138 condition failed: assert pathStates.get(state);"));
      [pathStates_ clearWithInt:state];
      depth--;
      [string_ setLengthWithInt:depth];
      if ([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a_)) isAcceptWithInt:state]) {
        return [string_ get];
      }
    }
  }
  return nil;
}

- (void)growStackWithInt:(jint)depth {
  OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(self, depth);
}

- (void)dealloc {
  RELEASE_(a_);
  RELEASE_(pathStates_);
  RELEASE_(string_);
  RELEASE_(nodes_);
  [super dealloc];
}

+ (void)initialize {
  if (self == [OrgApacheLuceneUtilAutomatonFiniteStringsIterator class]) {
    JreStrongAssignAndConsume(&OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY, new_OrgApacheLuceneUtilIntsRef_init());
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneUtilAutomatonFiniteStringsIterator)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneUtilAutomatonAutomaton:", "FiniteStringsIterator", NULL, 0x1, NULL, NULL },
    { "next", NULL, "Lorg.apache.lucene.util.IntsRef;", 0x1, NULL, NULL },
    { "growStackWithInt:", "growStack", "V", 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "EMPTY", "EMPTY", 0x1a, "Lorg.apache.lucene.util.IntsRef;", &OrgApacheLuceneUtilAutomatonFiniteStringsIterator_EMPTY, NULL, .constantValue.asLong = 0 },
    { "a_", NULL, 0x12, "Lorg.apache.lucene.util.automaton.Automaton;", NULL, NULL, .constantValue.asLong = 0 },
    { "pathStates_", NULL, 0x12, "Ljava.util.BitSet;", NULL, NULL, .constantValue.asLong = 0 },
    { "string_", NULL, 0x12, "Lorg.apache.lucene.util.IntsRefBuilder;", NULL, NULL, .constantValue.asLong = 0 },
    { "nodes_", NULL, 0x2, "[Lorg.apache.lucene.util.automaton.FiniteStringsIterator$PathNode;", NULL, NULL, .constantValue.asLong = 0 },
    { "emitEmptyString_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.util.automaton.FiniteStringsIterator$PathNode;"};
  static const J2ObjcClassInfo _OrgApacheLuceneUtilAutomatonFiniteStringsIterator = { 2, "FiniteStringsIterator", "org.apache.lucene.util.automaton", NULL, 0x1, 3, methods, 6, fields, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneUtilAutomatonFiniteStringsIterator;
}

@end

void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(OrgApacheLuceneUtilAutomatonFiniteStringsIterator *self, OrgApacheLuceneUtilAutomatonAutomaton *a) {
  NSObject_init(self);
  JreStrongAssign(&self->a_, a);
  JreStrongAssignAndConsume(&self->nodes_, [IOSObjectArray newArrayWithLength:16 type:OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_class_()]);
  for (jint i = 0, end = self->nodes_->size_; i < end; i++) {
    IOSObjectArray_SetAndConsume(nil_chk(self->nodes_), i, new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init());
  }
  JreStrongAssignAndConsume(&self->string_, new_OrgApacheLuceneUtilIntsRefBuilder_init());
  JreStrongAssignAndConsume(&self->pathStates_, new_JavaUtilBitSet_initWithInt_([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a)) getNumStates]));
  [self->string_ setLengthWithInt:0];
  self->emitEmptyString_ = [a isAcceptWithInt:0];
  if ([a getNumTransitionsWithInt:0] > 0) {
    [self->pathStates_ setWithInt:0];
    [((OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *) nil_chk(IOSObjectArray_Get(nil_chk(self->nodes_), 0))) resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:a withInt:0];
    [self->string_ appendWithInt:0];
  }
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator *new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(OrgApacheLuceneUtilAutomatonAutomaton *a) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, initWithOrgApacheLuceneUtilAutomatonAutomaton_, a)
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator *create_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_initWithOrgApacheLuceneUtilAutomatonAutomaton_(OrgApacheLuceneUtilAutomatonAutomaton *a) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator, initWithOrgApacheLuceneUtilAutomatonAutomaton_, a)
}

void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_growStackWithInt_(OrgApacheLuceneUtilAutomatonFiniteStringsIterator *self, jint depth) {
  if (((IOSObjectArray *) nil_chk(self->nodes_))->size_ == depth) {
    IOSObjectArray *newNodes = [IOSObjectArray arrayWithLength:OrgApacheLuceneUtilArrayUtil_oversizeWithInt_withInt_(self->nodes_->size_ + 1, JreLoadStatic(OrgApacheLuceneUtilRamUsageEstimator, NUM_BYTES_OBJECT_REF)) type:OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_class_()];
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(self->nodes_, 0, newNodes, 0, ((IOSObjectArray *) nil_chk(self->nodes_))->size_);
    for (jint i = depth, end = newNodes->size_; i < end; i++) {
      IOSObjectArray_SetAndConsume(newNodes, i, new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init());
    }
    JreStrongAssign(&self->nodes_, newNodes);
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilAutomatonFiniteStringsIterator)

@implementation OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode

- (void)resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a
                                                    withInt:(jint)state {
  JreAssert(([((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a)) getNumTransitionsWithInt:state] != 0), (@"org/apache/lucene/util/automaton/FiniteStringsIterator.java:190 condition failed: assert a.getNumTransitions(state) != 0;"));
  self->state_ = state;
  transition_ = 0;
  [a getTransitionWithInt:state withInt:0 withOrgApacheLuceneUtilAutomatonTransition:t_];
  label_ = ((OrgApacheLuceneUtilAutomatonTransition *) nil_chk(t_))->min_;
  to_ = t_->dest_;
}

- (jint)nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:(OrgApacheLuceneUtilAutomatonAutomaton *)a {
  if (label_ > ((OrgApacheLuceneUtilAutomatonTransition *) nil_chk(t_))->max_) {
    transition_++;
    if (transition_ >= [((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(a)) getNumTransitionsWithInt:state_]) {
      label_ = -1;
      return -1;
    }
    [a getTransitionWithInt:state_ withInt:transition_ withOrgApacheLuceneUtilAutomatonTransition:t_];
    label_ = t_->min_;
    to_ = t_->dest_;
  }
  return label_++;
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (void)dealloc {
  RELEASE_(t_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "resetStateWithOrgApacheLuceneUtilAutomatonAutomaton:withInt:", "resetState", "V", 0x1, NULL, NULL },
    { "nextLabelWithOrgApacheLuceneUtilAutomatonAutomaton:", "nextLabel", "I", 0x1, NULL, NULL },
    { "init", "PathNode", NULL, 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "state_", NULL, 0x1, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "to_", NULL, 0x1, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "transition_", NULL, 0x1, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "label_", NULL, 0x1, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "t_", NULL, 0x12, "Lorg.apache.lucene.util.automaton.Transition;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode = { 2, "PathNode", "org.apache.lucene.util.automaton", "FiniteStringsIterator", 0xa, 3, methods, 5, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode;
}

@end

void OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *self) {
  NSObject_init(self);
  JreStrongAssignAndConsume(&self->t_, new_OrgApacheLuceneUtilAutomatonTransition_init());
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *new_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init() {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode, init)
}

OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode *create_OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode_init() {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode, init)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilAutomatonFiniteStringsIterator_PathNode)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./core/src/java/org/apache/lucene/util/BitDocIdSet.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Deprecated.h"
#include "java/lang/annotation/Annotation.h"
#include "org/apache/lucene/search/DocIdSet.h"
#include "org/apache/lucene/search/DocIdSetIterator.h"
#include "org/apache/lucene/util/BitDocIdSet.h"
#include "org/apache/lucene/util/BitSet.h"
#include "org/apache/lucene/util/BitSetIterator.h"
#include "org/apache/lucene/util/FixedBitSet.h"
#include "org/apache/lucene/util/RamUsageEstimator.h"
#include "org/apache/lucene/util/SparseFixedBitSet.h"

@interface OrgApacheLuceneUtilBitDocIdSet () {
 @public
  OrgApacheLuceneUtilBitSet *set_;
  jlong cost_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilBitDocIdSet, set_, OrgApacheLuceneUtilBitSet *)

inline jlong OrgApacheLuceneUtilBitDocIdSet_get_BASE_RAM_BYTES_USED();
static jlong OrgApacheLuceneUtilBitDocIdSet_BASE_RAM_BYTES_USED;
J2OBJC_STATIC_FIELD_PRIMITIVE_FINAL(OrgApacheLuceneUtilBitDocIdSet, BASE_RAM_BYTES_USED, jlong)

@interface OrgApacheLuceneUtilBitDocIdSet_Builder () {
 @public
  jint maxDoc_;
  jint threshold_;
  OrgApacheLuceneUtilSparseFixedBitSet *sparseSet_;
  OrgApacheLuceneUtilFixedBitSet *denseSet_;
  jlong costUpperBound_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilBitDocIdSet_Builder, sparseSet_, OrgApacheLuceneUtilSparseFixedBitSet *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilBitDocIdSet_Builder, denseSet_, OrgApacheLuceneUtilFixedBitSet *)

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneUtilBitDocIdSet)

@implementation OrgApacheLuceneUtilBitDocIdSet

- (instancetype)initWithOrgApacheLuceneUtilBitSet:(OrgApacheLuceneUtilBitSet *)set
                                         withLong:(jlong)cost {
  OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_withLong_(self, set, cost);
  return self;
}

- (instancetype)initWithOrgApacheLuceneUtilBitSet:(OrgApacheLuceneUtilBitSet *)set {
  OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_(self, set);
  return self;
}

- (OrgApacheLuceneSearchDocIdSetIterator *)iterator {
  return create_OrgApacheLuceneUtilBitSetIterator_initWithOrgApacheLuceneUtilBitSet_withLong_(set_, cost_);
}

- (OrgApacheLuceneUtilBitSet *)bits {
  return set_;
}

- (jboolean)isCacheable {
  return true;
}

- (jlong)ramBytesUsed {
  return OrgApacheLuceneUtilBitDocIdSet_BASE_RAM_BYTES_USED + [((OrgApacheLuceneUtilBitSet *) nil_chk(set_)) ramBytesUsed];
}

- (NSString *)description {
  return JreStrcat("$$@$JC", [[self getClass] getSimpleName], @"(set=", set_, @",cost=", cost_, ')');
}

- (void)dealloc {
  RELEASE_(set_);
  [super dealloc];
}

+ (void)initialize {
  if (self == [OrgApacheLuceneUtilBitDocIdSet class]) {
    OrgApacheLuceneUtilBitDocIdSet_BASE_RAM_BYTES_USED = OrgApacheLuceneUtilRamUsageEstimator_shallowSizeOfInstanceWithIOSClass_(OrgApacheLuceneUtilBitDocIdSet_class_());
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneUtilBitDocIdSet)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneUtilBitSet:withLong:", "BitDocIdSet", NULL, 0x1, NULL, NULL },
    { "initWithOrgApacheLuceneUtilBitSet:", "BitDocIdSet", NULL, 0x1, NULL, NULL },
    { "iterator", NULL, "Lorg.apache.lucene.search.DocIdSetIterator;", 0x1, NULL, NULL },
    { "bits", NULL, "Lorg.apache.lucene.util.BitSet;", 0x1, NULL, NULL },
    { "isCacheable", NULL, "Z", 0x1, NULL, NULL },
    { "ramBytesUsed", NULL, "J", 0x1, NULL, NULL },
    { "description", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "BASE_RAM_BYTES_USED", "BASE_RAM_BYTES_USED", 0x1a, "J", &OrgApacheLuceneUtilBitDocIdSet_BASE_RAM_BYTES_USED, NULL, .constantValue.asLong = 0 },
    { "set_", NULL, 0x12, "Lorg.apache.lucene.util.BitSet;", NULL, NULL, .constantValue.asLong = 0 },
    { "cost_", NULL, 0x12, "J", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.util.BitDocIdSet$Builder;"};
  static const J2ObjcClassInfo _OrgApacheLuceneUtilBitDocIdSet = { 2, "BitDocIdSet", "org.apache.lucene.util", NULL, 0x1, 7, methods, 3, fields, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneUtilBitDocIdSet;
}

@end

void OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_withLong_(OrgApacheLuceneUtilBitDocIdSet *self, OrgApacheLuceneUtilBitSet *set, jlong cost) {
  OrgApacheLuceneSearchDocIdSet_init(self);
  JreStrongAssign(&self->set_, set);
  self->cost_ = cost;
}

OrgApacheLuceneUtilBitDocIdSet *new_OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_withLong_(OrgApacheLuceneUtilBitSet *set, jlong cost) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilBitDocIdSet, initWithOrgApacheLuceneUtilBitSet_withLong_, set, cost)
}

OrgApacheLuceneUtilBitDocIdSet *create_OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_withLong_(OrgApacheLuceneUtilBitSet *set, jlong cost) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilBitDocIdSet, initWithOrgApacheLuceneUtilBitSet_withLong_, set, cost)
}

void OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_(OrgApacheLuceneUtilBitDocIdSet *self, OrgApacheLuceneUtilBitSet *set) {
  OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_withLong_(self, set, [((OrgApacheLuceneUtilBitSet *) nil_chk(set)) approximateCardinality]);
}

OrgApacheLuceneUtilBitDocIdSet *new_OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_(OrgApacheLuceneUtilBitSet *set) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilBitDocIdSet, initWithOrgApacheLuceneUtilBitSet_, set)
}

OrgApacheLuceneUtilBitDocIdSet *create_OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_(OrgApacheLuceneUtilBitSet *set) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilBitDocIdSet, initWithOrgApacheLuceneUtilBitSet_, set)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilBitDocIdSet)

@implementation OrgApacheLuceneUtilBitDocIdSet_Builder

- (instancetype)initWithInt:(jint)maxDoc
                withBoolean:(jboolean)full {
  OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_withBoolean_(self, maxDoc, full);
  return self;
}

- (instancetype)initWithInt:(jint)maxDoc {
  OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_(self, maxDoc);
  return self;
}

- (jboolean)dense {
  return denseSet_ != nil;
}

- (jboolean)isDefinitelyEmpty {
  return sparseSet_ == nil && denseSet_ == nil;
}

- (void)or__WithOrgApacheLuceneSearchDocIdSetIterator:(OrgApacheLuceneSearchDocIdSetIterator *)it {
  if (denseSet_ != nil) {
    [denseSet_ or__WithOrgApacheLuceneSearchDocIdSetIterator:it];
    return;
  }
  jlong itCost = [((OrgApacheLuceneSearchDocIdSetIterator *) nil_chk(it)) cost];
  costUpperBound_ += itCost;
  if (costUpperBound_ >= threshold_) {
    costUpperBound_ = (sparseSet_ == nil ? 0 : [sparseSet_ approximateCardinality]) + itCost;
    if (costUpperBound_ >= threshold_) {
      JreStrongAssignAndConsume(&denseSet_, new_OrgApacheLuceneUtilFixedBitSet_initWithInt_(maxDoc_));
      [denseSet_ or__WithOrgApacheLuceneSearchDocIdSetIterator:it];
      if (sparseSet_ != nil) {
        [((OrgApacheLuceneUtilFixedBitSet *) nil_chk(denseSet_)) or__WithOrgApacheLuceneSearchDocIdSetIterator:create_OrgApacheLuceneUtilBitSetIterator_initWithOrgApacheLuceneUtilBitSet_withLong_(sparseSet_, 0LL)];
      }
      return;
    }
  }
  if (sparseSet_ == nil) {
    JreStrongAssignAndConsume(&sparseSet_, new_OrgApacheLuceneUtilSparseFixedBitSet_initWithInt_(maxDoc_));
  }
  [sparseSet_ or__WithOrgApacheLuceneSearchDocIdSetIterator:it];
}

- (void)and__WithOrgApacheLuceneSearchDocIdSetIterator:(OrgApacheLuceneSearchDocIdSetIterator *)it {
  if (denseSet_ != nil) {
    [denseSet_ and__WithOrgApacheLuceneSearchDocIdSetIterator:it];
  }
  else if (sparseSet_ != nil) {
    [sparseSet_ and__WithOrgApacheLuceneSearchDocIdSetIterator:it];
  }
}

- (void)andNotWithOrgApacheLuceneSearchDocIdSetIterator:(OrgApacheLuceneSearchDocIdSetIterator *)it {
  if (denseSet_ != nil) {
    [denseSet_ andNotWithOrgApacheLuceneSearchDocIdSetIterator:it];
  }
  else if (sparseSet_ != nil) {
    [sparseSet_ andNotWithOrgApacheLuceneSearchDocIdSetIterator:it];
  }
}

- (OrgApacheLuceneUtilBitDocIdSet *)build {
  OrgApacheLuceneUtilBitDocIdSet *result;
  if (denseSet_ != nil) {
    result = create_OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_(denseSet_);
  }
  else if (sparseSet_ != nil) {
    result = create_OrgApacheLuceneUtilBitDocIdSet_initWithOrgApacheLuceneUtilBitSet_(sparseSet_);
  }
  else {
    result = nil;
  }
  JreStrongAssign(&denseSet_, nil);
  JreStrongAssign(&sparseSet_, nil);
  costUpperBound_ = 0;
  return result;
}

+ (IOSObjectArray *)__annotations_and__WithOrgApacheLuceneSearchDocIdSetIterator_ {
  return [IOSObjectArray arrayWithObjects:(id[]){ create_JavaLangDeprecated() } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

+ (IOSObjectArray *)__annotations_andNotWithOrgApacheLuceneSearchDocIdSetIterator_ {
  return [IOSObjectArray arrayWithObjects:(id[]){ create_JavaLangDeprecated() } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

- (void)dealloc {
  RELEASE_(sparseSet_);
  RELEASE_(denseSet_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithInt:withBoolean:", "Builder", NULL, 0x1, NULL, NULL },
    { "initWithInt:", "Builder", NULL, 0x1, NULL, NULL },
    { "dense", NULL, "Z", 0x0, NULL, NULL },
    { "isDefinitelyEmpty", NULL, "Z", 0x1, NULL, NULL },
    { "or__WithOrgApacheLuceneSearchDocIdSetIterator:", "or", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "and__WithOrgApacheLuceneSearchDocIdSetIterator:", "and", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "andNotWithOrgApacheLuceneSearchDocIdSetIterator:", "andNot", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "build", NULL, "Lorg.apache.lucene.util.BitDocIdSet;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "maxDoc_", NULL, 0x12, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "threshold_", NULL, 0x12, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "sparseSet_", NULL, 0x2, "Lorg.apache.lucene.util.SparseFixedBitSet;", NULL, NULL, .constantValue.asLong = 0 },
    { "denseSet_", NULL, 0x2, "Lorg.apache.lucene.util.FixedBitSet;", NULL, NULL, .constantValue.asLong = 0 },
    { "costUpperBound_", NULL, 0x2, "J", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilBitDocIdSet_Builder = { 2, "Builder", "org.apache.lucene.util", "BitDocIdSet", 0x19, 8, methods, 5, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneUtilBitDocIdSet_Builder;
}

@end

void OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_withBoolean_(OrgApacheLuceneUtilBitDocIdSet_Builder *self, jint maxDoc, jboolean full) {
  NSObject_init(self);
  self->maxDoc_ = maxDoc;
  self->threshold_ = JreURShift32(maxDoc, 10);
  if (full) {
    JreStrongAssignAndConsume(&self->denseSet_, new_OrgApacheLuceneUtilFixedBitSet_initWithInt_(maxDoc));
    [self->denseSet_ setWithInt:0 withInt:maxDoc];
  }
}

OrgApacheLuceneUtilBitDocIdSet_Builder *new_OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_withBoolean_(jint maxDoc, jboolean full) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilBitDocIdSet_Builder, initWithInt_withBoolean_, maxDoc, full)
}

OrgApacheLuceneUtilBitDocIdSet_Builder *create_OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_withBoolean_(jint maxDoc, jboolean full) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilBitDocIdSet_Builder, initWithInt_withBoolean_, maxDoc, full)
}

void OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_(OrgApacheLuceneUtilBitDocIdSet_Builder *self, jint maxDoc) {
  OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_withBoolean_(self, maxDoc, false);
}

OrgApacheLuceneUtilBitDocIdSet_Builder *new_OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_(jint maxDoc) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilBitDocIdSet_Builder, initWithInt_, maxDoc)
}

OrgApacheLuceneUtilBitDocIdSet_Builder *create_OrgApacheLuceneUtilBitDocIdSet_Builder_initWithInt_(jint maxDoc) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilBitDocIdSet_Builder, initWithInt_, maxDoc)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilBitDocIdSet_Builder)

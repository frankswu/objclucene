//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./sandbox/src/java/org/apache/lucene/bkdtree/BKDTreeDocValuesProducer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Closeable.h"
#include "java/io/IOException.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Integer.h"
#include "java/lang/Long.h"
#include "java/lang/Thread.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/ArrayList.h"
#include "java/util/Collection.h"
#include "java/util/HashMap.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "java/util/concurrent/atomic/AtomicLong.h"
#include "org/apache/lucene/bkdtree/BKDTreeDocValuesFormat.h"
#include "org/apache/lucene/bkdtree/BKDTreeDocValuesProducer.h"
#include "org/apache/lucene/bkdtree/BKDTreeReader.h"
#include "org/apache/lucene/bkdtree/BKDTreeSortedNumericDocValues.h"
#include "org/apache/lucene/codecs/CodecUtil.h"
#include "org/apache/lucene/codecs/DocValuesProducer.h"
#include "org/apache/lucene/index/BinaryDocValues.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/IndexFileNames.h"
#include "org/apache/lucene/index/NumericDocValues.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentReadState.h"
#include "org/apache/lucene/index/SortedDocValues.h"
#include "org/apache/lucene/index/SortedNumericDocValues.h"
#include "org/apache/lucene/index/SortedSetDocValues.h"
#include "org/apache/lucene/store/ChecksumIndexInput.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IOContext.h"
#include "org/apache/lucene/store/IndexInput.h"
#include "org/apache/lucene/util/Accountable.h"
#include "org/apache/lucene/util/Accountables.h"
#include "org/apache/lucene/util/Bits.h"
#include "org/apache/lucene/util/IOUtils.h"
#include "org/apache/lucene/util/RamUsageEstimator.h"

@interface OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer () {
 @public
  id<JavaUtilMap> treeReaders_;
  id<JavaUtilMap> fieldToIndexFPs_;
  OrgApacheLuceneStoreIndexInput *datIn_;
  JavaUtilConcurrentAtomicAtomicLong *ramBytesUsed_;
  jint maxDoc_;
  OrgApacheLuceneCodecsDocValuesProducer *delegate_;
  jboolean merging_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, treeReaders_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, fieldToIndexFPs_, id<JavaUtilMap>)
J2OBJC_FIELD_SETTER(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, datIn_, OrgApacheLuceneStoreIndexInput *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, ramBytesUsed_, JavaUtilConcurrentAtomicAtomicLong *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, delegate_, OrgApacheLuceneCodecsDocValuesProducer *)

@implementation OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer

- (instancetype)initWithOrgApacheLuceneCodecsDocValuesProducer:(OrgApacheLuceneCodecsDocValuesProducer *)delegate
                      withOrgApacheLuceneIndexSegmentReadState:(OrgApacheLuceneIndexSegmentReadState *)state {
  OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneCodecsDocValuesProducer_withOrgApacheLuceneIndexSegmentReadState_(self, delegate, state);
  return self;
}

- (instancetype)initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer:(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *)orig {
  OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_(self, orig);
  return self;
}

- (OrgApacheLuceneIndexSortedNumericDocValues *)getSortedNumericWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field {
  @synchronized(self) {
    OrgApacheLuceneBkdtreeBKDTreeReader *treeReader = [((id<JavaUtilMap>) nil_chk(treeReaders_)) getWithId:((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->name_];
    if (treeReader == nil) {
      JavaLangLong *fp = [((id<JavaUtilMap>) nil_chk(fieldToIndexFPs_)) getWithId:JavaLangInteger_valueOfWithInt_(field->number_)];
      if (fp == nil) {
        @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"this field was not indexed as a BKDPointField");
      }
      [((OrgApacheLuceneStoreIndexInput *) nil_chk(datIn_)) seekWithLong:[fp longLongValue]];
      treeReader = create_OrgApacheLuceneBkdtreeBKDTreeReader_initWithOrgApacheLuceneStoreIndexInput_withInt_(datIn_, maxDoc_);
      if (merging_ == false) {
        [treeReaders_ putWithId:field->name_ withId:treeReader];
        [((JavaUtilConcurrentAtomicAtomicLong *) nil_chk(ramBytesUsed_)) addAndGetWithLong:[treeReader ramBytesUsed]];
      }
    }
    return create_OrgApacheLuceneBkdtreeBKDTreeSortedNumericDocValues_initWithOrgApacheLuceneBkdtreeBKDTreeReader_withOrgApacheLuceneIndexSortedNumericDocValues_(treeReader, [((OrgApacheLuceneCodecsDocValuesProducer *) nil_chk(delegate_)) getSortedNumericWithOrgApacheLuceneIndexFieldInfo:field]);
  }
}

- (void)close {
  OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ datIn_, delegate_ } count:2 type:JavaIoCloseable_class_()]);
}

- (void)checkIntegrity {
  OrgApacheLuceneCodecsCodecUtil_checksumEntireFileWithOrgApacheLuceneStoreIndexInput_(datIn_);
}

- (OrgApacheLuceneIndexNumericDocValues *)getNumericWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (OrgApacheLuceneIndexBinaryDocValues *)getBinaryWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (OrgApacheLuceneIndexSortedDocValues *)getSortedWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (OrgApacheLuceneIndexSortedSetDocValues *)getSortedSetWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (id<OrgApacheLuceneUtilBits>)getDocsWithFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field {
  return [((OrgApacheLuceneCodecsDocValuesProducer *) nil_chk(delegate_)) getDocsWithFieldWithOrgApacheLuceneIndexFieldInfo:field];
}

- (id<JavaUtilCollection>)getChildResources {
  @synchronized(self) {
    id<JavaUtilList> resources = create_JavaUtilArrayList_init();
    for (id<JavaUtilMap_Entry> __strong ent in nil_chk([((id<JavaUtilMap>) nil_chk(treeReaders_)) entrySet])) {
      [resources addWithId:OrgApacheLuceneUtilAccountables_namedAccountableWithNSString_withOrgApacheLuceneUtilAccountable_(JreStrcat("$$", @"field ", [((id<JavaUtilMap_Entry>) nil_chk(ent)) getKey]), [ent getValue])];
    }
    [resources addWithId:OrgApacheLuceneUtilAccountables_namedAccountableWithNSString_withOrgApacheLuceneUtilAccountable_(@"delegate", delegate_)];
    return resources;
  }
}

- (OrgApacheLuceneCodecsDocValuesProducer *)getMergeInstance {
  @synchronized(self) {
    return create_OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_(self);
  }
}

- (jlong)ramBytesUsed {
  return [((JavaUtilConcurrentAtomicAtomicLong *) nil_chk(ramBytesUsed_)) get] + [((OrgApacheLuceneCodecsDocValuesProducer *) nil_chk(delegate_)) ramBytesUsed];
}

- (void)dealloc {
  RELEASE_(treeReaders_);
  RELEASE_(fieldToIndexFPs_);
  RELEASE_(datIn_);
  RELEASE_(ramBytesUsed_);
  RELEASE_(delegate_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneCodecsDocValuesProducer:withOrgApacheLuceneIndexSegmentReadState:", "BKDTreeDocValuesProducer", NULL, 0x1, "Ljava.io.IOException;", NULL },
    { "initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer:", "BKDTreeDocValuesProducer", NULL, 0x0, "Ljava.io.IOException;", NULL },
    { "getSortedNumericWithOrgApacheLuceneIndexFieldInfo:", "getSortedNumeric", "Lorg.apache.lucene.index.SortedNumericDocValues;", 0x21, "Ljava.io.IOException;", NULL },
    { "close", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "checkIntegrity", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "getNumericWithOrgApacheLuceneIndexFieldInfo:", "getNumeric", "Lorg.apache.lucene.index.NumericDocValues;", 0x1, NULL, NULL },
    { "getBinaryWithOrgApacheLuceneIndexFieldInfo:", "getBinary", "Lorg.apache.lucene.index.BinaryDocValues;", 0x1, NULL, NULL },
    { "getSortedWithOrgApacheLuceneIndexFieldInfo:", "getSorted", "Lorg.apache.lucene.index.SortedDocValues;", 0x1, NULL, NULL },
    { "getSortedSetWithOrgApacheLuceneIndexFieldInfo:", "getSortedSet", "Lorg.apache.lucene.index.SortedSetDocValues;", 0x1, NULL, NULL },
    { "getDocsWithFieldWithOrgApacheLuceneIndexFieldInfo:", "getDocsWithField", "Lorg.apache.lucene.util.Bits;", 0x1, "Ljava.io.IOException;", NULL },
    { "getChildResources", NULL, "Ljava.util.Collection;", 0x21, NULL, "()Ljava/util/Collection<Lorg/apache/lucene/util/Accountable;>;" },
    { "getMergeInstance", NULL, "Lorg.apache.lucene.codecs.DocValuesProducer;", 0x21, "Ljava.io.IOException;", NULL },
    { "ramBytesUsed", NULL, "J", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "treeReaders_", NULL, 0x12, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/String;Lorg/apache/lucene/bkdtree/BKDTreeReader;>;", .constantValue.asLong = 0 },
    { "fieldToIndexFPs_", NULL, 0x12, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/Integer;Ljava/lang/Long;>;", .constantValue.asLong = 0 },
    { "datIn_", NULL, 0x12, "Lorg.apache.lucene.store.IndexInput;", NULL, NULL, .constantValue.asLong = 0 },
    { "ramBytesUsed_", NULL, 0x12, "Ljava.util.concurrent.atomic.AtomicLong;", NULL, NULL, .constantValue.asLong = 0 },
    { "maxDoc_", NULL, 0x12, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "delegate_", NULL, 0x12, "Lorg.apache.lucene.codecs.DocValuesProducer;", NULL, NULL, .constantValue.asLong = 0 },
    { "merging_", NULL, 0x12, "Z", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer = { 2, "BKDTreeDocValuesProducer", "org.apache.lucene.bkdtree", NULL, 0x0, 13, methods, 7, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer;
}

@end

void OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneCodecsDocValuesProducer_withOrgApacheLuceneIndexSegmentReadState_(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *self, OrgApacheLuceneCodecsDocValuesProducer *delegate, OrgApacheLuceneIndexSegmentReadState *state) {
  OrgApacheLuceneCodecsDocValuesProducer_init(self);
  JreStrongAssignAndConsume(&self->treeReaders_, new_JavaUtilHashMap_init());
  JreStrongAssignAndConsume(&self->fieldToIndexFPs_, new_JavaUtilHashMap_init());
  NSString *metaFileName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentReadState *) nil_chk(state))->segmentInfo_))->name_, state->segmentSuffix_, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_META_EXTENSION);
  OrgApacheLuceneStoreChecksumIndexInput *metaIn = [((OrgApacheLuceneStoreDirectory *) nil_chk(state->directory_)) openChecksumInputWithNSString:metaFileName withOrgApacheLuceneStoreIOContext:state->context_];
  OrgApacheLuceneCodecsCodecUtil_checkIndexHeaderWithOrgApacheLuceneStoreDataInput_withNSString_withInt_withInt_withByteArray_withNSString_(metaIn, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_META_CODEC_NAME, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_META_VERSION_START, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_META_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
  jint fieldCount = [((OrgApacheLuceneStoreChecksumIndexInput *) nil_chk(metaIn)) readVInt];
  for (jint i = 0; i < fieldCount; i++) {
    jint fieldNumber = [metaIn readVInt];
    jlong indexFP = [metaIn readVLong];
    [self->fieldToIndexFPs_ putWithId:JavaLangInteger_valueOfWithInt_(fieldNumber) withId:JavaLangLong_valueOfWithLong_(indexFP)];
  }
  OrgApacheLuceneCodecsCodecUtil_checkFooterWithOrgApacheLuceneStoreChecksumIndexInput_(metaIn);
  [metaIn close];
  NSString *datFileName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(state->segmentInfo_->name_, state->segmentSuffix_, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_DATA_EXTENSION);
  JreStrongAssign(&self->datIn_, [state->directory_ openInputWithNSString:datFileName withOrgApacheLuceneStoreIOContext:state->context_]);
  OrgApacheLuceneCodecsCodecUtil_checkIndexHeaderWithOrgApacheLuceneStoreDataInput_withNSString_withInt_withInt_withByteArray_withNSString_(self->datIn_, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_DATA_CODEC_NAME, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_DATA_VERSION_START, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_DATA_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
  JreStrongAssignAndConsume(&self->ramBytesUsed_, new_JavaUtilConcurrentAtomicAtomicLong_initWithLong_(OrgApacheLuceneUtilRamUsageEstimator_shallowSizeOfInstanceWithIOSClass_([self getClass])));
  self->maxDoc_ = [state->segmentInfo_ maxDoc];
  JreStrongAssign(&self->delegate_, delegate);
  self->merging_ = false;
}

OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *new_OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneCodecsDocValuesProducer_withOrgApacheLuceneIndexSegmentReadState_(OrgApacheLuceneCodecsDocValuesProducer *delegate, OrgApacheLuceneIndexSegmentReadState *state) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, initWithOrgApacheLuceneCodecsDocValuesProducer_withOrgApacheLuceneIndexSegmentReadState_, delegate, state)
}

OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *create_OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneCodecsDocValuesProducer_withOrgApacheLuceneIndexSegmentReadState_(OrgApacheLuceneCodecsDocValuesProducer *delegate, OrgApacheLuceneIndexSegmentReadState *state) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, initWithOrgApacheLuceneCodecsDocValuesProducer_withOrgApacheLuceneIndexSegmentReadState_, delegate, state)
}

void OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *self, OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *orig) {
  OrgApacheLuceneCodecsDocValuesProducer_init(self);
  JreStrongAssignAndConsume(&self->treeReaders_, new_JavaUtilHashMap_init());
  JreStrongAssignAndConsume(&self->fieldToIndexFPs_, new_JavaUtilHashMap_init());
  JreAssert((JavaLangThread_holdsLockWithId_(orig)), (@"org/apache/lucene/bkdtree/BKDTreeDocValuesProducer.java:83 condition failed: assert Thread.holdsLock(orig);"));
  JreStrongAssign(&self->datIn_, [((OrgApacheLuceneStoreIndexInput *) nil_chk(((OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *) nil_chk(orig))->datIn_)) clone]);
  JreStrongAssignAndConsume(&self->ramBytesUsed_, new_JavaUtilConcurrentAtomicAtomicLong_initWithLong_([((JavaUtilConcurrentAtomicAtomicLong *) nil_chk(orig->ramBytesUsed_)) get]));
  JreStrongAssign(&self->delegate_, [((OrgApacheLuceneCodecsDocValuesProducer *) nil_chk(orig->delegate_)) getMergeInstance]);
  [self->fieldToIndexFPs_ putAllWithJavaUtilMap:orig->fieldToIndexFPs_];
  [self->treeReaders_ putAllWithJavaUtilMap:orig->treeReaders_];
  self->merging_ = true;
  self->maxDoc_ = orig->maxDoc_;
}

OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *new_OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *orig) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_, orig)
}

OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *create_OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer *orig) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer, initWithOrgApacheLuceneBkdtreeBKDTreeDocValuesProducer_, orig)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneBkdtreeBKDTreeDocValuesProducer)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./sandbox/src/java/org/apache/lucene/bkdtree/BKDTreeDocValuesConsumer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Closeable.h"
#include "java/io/IOException.h"
#include "java/lang/Integer.h"
#include "java/lang/Iterable.h"
#include "java/lang/Long.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/HashMap.h"
#include "java/util/Iterator.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "org/apache/lucene/bkdtree/BKDTreeDocValuesConsumer.h"
#include "org/apache/lucene/bkdtree/BKDTreeDocValuesFormat.h"
#include "org/apache/lucene/bkdtree/BKDTreeWriter.h"
#include "org/apache/lucene/codecs/CodecUtil.h"
#include "org/apache/lucene/codecs/DocValuesConsumer.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/IndexFileNames.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentWriteState.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IOContext.h"
#include "org/apache/lucene/store/IndexOutput.h"
#include "org/apache/lucene/util/IOUtils.h"

@implementation OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer

- (instancetype)initWithOrgApacheLuceneCodecsDocValuesConsumer:(OrgApacheLuceneCodecsDocValuesConsumer *)delegate
                     withOrgApacheLuceneIndexSegmentWriteState:(OrgApacheLuceneIndexSegmentWriteState *)state
                                                       withInt:(jint)maxPointsInLeafNode
                                                       withInt:(jint)maxPointsSortInHeap {
  OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer_initWithOrgApacheLuceneCodecsDocValuesConsumer_withOrgApacheLuceneIndexSegmentWriteState_withInt_withInt_(self, delegate, state, maxPointsInLeafNode, maxPointsSortInHeap);
  return self;
}

- (void)close {
  jboolean success = false;
  @try {
    OrgApacheLuceneCodecsCodecUtil_writeFooterWithOrgApacheLuceneStoreIndexOutput_(out_);
    success = true;
  }
  @finally {
    if (success) {
      OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ delegate_, out_ } count:2 type:JavaIoCloseable_class_()]);
    }
    else {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ delegate_, out_ } count:2 type:JavaIoCloseable_class_()]);
    }
  }
  NSString *metaFileName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentWriteState *) nil_chk(state_))->segmentInfo_))->name_, state_->segmentSuffix_, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_META_EXTENSION);
  OrgApacheLuceneStoreIndexOutput *metaOut = [((OrgApacheLuceneStoreDirectory *) nil_chk(state_->directory_)) createOutputWithNSString:metaFileName withOrgApacheLuceneStoreIOContext:state_->context_];
  success = false;
  @try {
    OrgApacheLuceneCodecsCodecUtil_writeIndexHeaderWithOrgApacheLuceneStoreDataOutput_withNSString_withInt_withByteArray_withNSString_(metaOut, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_META_CODEC_NAME, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_META_VERSION_CURRENT, [state_->segmentInfo_ getId], state_->segmentSuffix_);
    [((OrgApacheLuceneStoreIndexOutput *) nil_chk(metaOut)) writeVIntWithInt:[((id<JavaUtilMap>) nil_chk(fieldIndexFPs_)) size]];
    for (id<JavaUtilMap_Entry> __strong ent in nil_chk([fieldIndexFPs_ entrySet])) {
      [metaOut writeVIntWithInt:[((JavaLangInteger *) nil_chk([((id<JavaUtilMap_Entry>) nil_chk(ent)) getKey])) intValue]];
      [metaOut writeVLongWithLong:[((JavaLangLong *) nil_chk([ent getValue])) longLongValue]];
    }
    OrgApacheLuceneCodecsCodecUtil_writeFooterWithOrgApacheLuceneStoreIndexOutput_(metaOut);
    success = true;
  }
  @finally {
    if (success) {
      OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ metaOut } count:1 type:JavaIoCloseable_class_()]);
    }
    else {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ metaOut } count:1 type:JavaIoCloseable_class_()]);
    }
  }
}

- (void)addSortedNumericFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                          withJavaLangIterable:(id<JavaLangIterable>)docToValueCount
                                          withJavaLangIterable:(id<JavaLangIterable>)values {
  [((OrgApacheLuceneCodecsDocValuesConsumer *) nil_chk(delegate_)) addSortedNumericFieldWithOrgApacheLuceneIndexFieldInfo:field withJavaLangIterable:docToValueCount withJavaLangIterable:values];
  OrgApacheLuceneBkdtreeBKDTreeWriter *writer = create_OrgApacheLuceneBkdtreeBKDTreeWriter_initWithInt_withInt_(maxPointsInLeafNode_, maxPointsSortInHeap_);
  id<JavaUtilIterator> valueIt = [((id<JavaLangIterable>) nil_chk(values)) iterator];
  id<JavaUtilIterator> valueCountIt = [((id<JavaLangIterable>) nil_chk(docToValueCount)) iterator];
  for (jint docID = 0; docID < [((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentWriteState *) nil_chk(state_))->segmentInfo_)) maxDoc]; docID++) {
    JreAssert(([((id<JavaUtilIterator>) nil_chk(valueCountIt)) hasNext]), (@"org/apache/lucene/bkdtree/BKDTreeDocValuesConsumer.java:98 condition failed: assert valueCountIt.hasNext();"));
    jint count = [((NSNumber *) nil_chk([valueCountIt next])) intValue];
    for (jint i = 0; i < count; i++) {
      JreAssert(([((id<JavaUtilIterator>) nil_chk(valueIt)) hasNext]), (@"org/apache/lucene/bkdtree/BKDTreeDocValuesConsumer.java:101 condition failed: assert valueIt.hasNext();"));
      jlong value = [((NSNumber *) nil_chk([valueIt next])) longLongValue];
      jint latEnc = (jint) (JreRShift64(value, 32));
      jint lonEnc = (jint) (value & (jint) 0xffffffff);
      [writer addWithInt:latEnc withInt:lonEnc withInt:docID];
    }
  }
  jlong indexStartFP = [writer finishWithOrgApacheLuceneStoreIndexOutput:out_];
  [((id<JavaUtilMap>) nil_chk(fieldIndexFPs_)) putWithId:JavaLangInteger_valueOfWithInt_(((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->number_) withId:JavaLangLong_valueOfWithLong_(indexStartFP)];
}

- (void)addNumericFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                    withJavaLangIterable:(id<JavaLangIterable>)values {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (void)addBinaryFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                   withJavaLangIterable:(id<JavaLangIterable>)values {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (void)addSortedFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                   withJavaLangIterable:(id<JavaLangIterable>)values
                                   withJavaLangIterable:(id<JavaLangIterable>)docToOrd {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (void)addSortedSetFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                      withJavaLangIterable:(id<JavaLangIterable>)values
                                      withJavaLangIterable:(id<JavaLangIterable>)docToOrdCount
                                      withJavaLangIterable:(id<JavaLangIterable>)ords {
  @throw create_JavaLangUnsupportedOperationException_init();
}

- (void)dealloc {
  RELEASE_(delegate_);
  RELEASE_(out_);
  RELEASE_(fieldIndexFPs_);
  RELEASE_(state_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneCodecsDocValuesConsumer:withOrgApacheLuceneIndexSegmentWriteState:withInt:withInt:", "BKDTreeDocValuesConsumer", NULL, 0x1, "Ljava.io.IOException;", NULL },
    { "close", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "addSortedNumericFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:withJavaLangIterable:", "addSortedNumericField", "V", 0x1, "Ljava.io.IOException;", "(Lorg/apache/lucene/index/FieldInfo;Ljava/lang/Iterable<Ljava/lang/Number;>;Ljava/lang/Iterable<Ljava/lang/Number;>;)V" },
    { "addNumericFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:", "addNumericField", "V", 0x1, "Ljava.io.IOException;", "(Lorg/apache/lucene/index/FieldInfo;Ljava/lang/Iterable<Ljava/lang/Number;>;)V" },
    { "addBinaryFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:", "addBinaryField", "V", 0x1, NULL, "(Lorg/apache/lucene/index/FieldInfo;Ljava/lang/Iterable<Lorg/apache/lucene/util/BytesRef;>;)V" },
    { "addSortedFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:withJavaLangIterable:", "addSortedField", "V", 0x1, NULL, "(Lorg/apache/lucene/index/FieldInfo;Ljava/lang/Iterable<Lorg/apache/lucene/util/BytesRef;>;Ljava/lang/Iterable<Ljava/lang/Number;>;)V" },
    { "addSortedSetFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:withJavaLangIterable:withJavaLangIterable:", "addSortedSetField", "V", 0x1, NULL, "(Lorg/apache/lucene/index/FieldInfo;Ljava/lang/Iterable<Lorg/apache/lucene/util/BytesRef;>;Ljava/lang/Iterable<Ljava/lang/Number;>;Ljava/lang/Iterable<Ljava/lang/Number;>;)V" },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "delegate_", NULL, 0x10, "Lorg.apache.lucene.codecs.DocValuesConsumer;", NULL, NULL, .constantValue.asLong = 0 },
    { "maxPointsInLeafNode_", NULL, 0x10, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "maxPointsSortInHeap_", NULL, 0x10, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "out_", NULL, 0x10, "Lorg.apache.lucene.store.IndexOutput;", NULL, NULL, .constantValue.asLong = 0 },
    { "fieldIndexFPs_", NULL, 0x10, "Ljava.util.Map;", NULL, "Ljava/util/Map<Ljava/lang/Integer;Ljava/lang/Long;>;", .constantValue.asLong = 0 },
    { "state_", NULL, 0x10, "Lorg.apache.lucene.index.SegmentWriteState;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer = { 2, "BKDTreeDocValuesConsumer", "org.apache.lucene.bkdtree", NULL, 0x0, 7, methods, 6, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer;
}

@end

void OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer_initWithOrgApacheLuceneCodecsDocValuesConsumer_withOrgApacheLuceneIndexSegmentWriteState_withInt_withInt_(OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer *self, OrgApacheLuceneCodecsDocValuesConsumer *delegate, OrgApacheLuceneIndexSegmentWriteState *state, jint maxPointsInLeafNode, jint maxPointsSortInHeap) {
  OrgApacheLuceneCodecsDocValuesConsumer_init(self);
  JreStrongAssignAndConsume(&self->fieldIndexFPs_, new_JavaUtilHashMap_init());
  OrgApacheLuceneBkdtreeBKDTreeWriter_verifyParamsWithInt_withInt_(maxPointsInLeafNode, maxPointsSortInHeap);
  JreStrongAssign(&self->delegate_, delegate);
  self->maxPointsInLeafNode_ = maxPointsInLeafNode;
  self->maxPointsSortInHeap_ = maxPointsSortInHeap;
  JreStrongAssign(&self->state_, state);
  NSString *datFileName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentWriteState *) nil_chk(state))->segmentInfo_))->name_, state->segmentSuffix_, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_DATA_EXTENSION);
  JreStrongAssign(&self->out_, [((OrgApacheLuceneStoreDirectory *) nil_chk(state->directory_)) createOutputWithNSString:datFileName withOrgApacheLuceneStoreIOContext:state->context_]);
  OrgApacheLuceneCodecsCodecUtil_writeIndexHeaderWithOrgApacheLuceneStoreDataOutput_withNSString_withInt_withByteArray_withNSString_(self->out_, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_DATA_CODEC_NAME, OrgApacheLuceneBkdtreeBKDTreeDocValuesFormat_DATA_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
}

OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer *new_OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer_initWithOrgApacheLuceneCodecsDocValuesConsumer_withOrgApacheLuceneIndexSegmentWriteState_withInt_withInt_(OrgApacheLuceneCodecsDocValuesConsumer *delegate, OrgApacheLuceneIndexSegmentWriteState *state, jint maxPointsInLeafNode, jint maxPointsSortInHeap) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer, initWithOrgApacheLuceneCodecsDocValuesConsumer_withOrgApacheLuceneIndexSegmentWriteState_withInt_withInt_, delegate, state, maxPointsInLeafNode, maxPointsSortInHeap)
}

OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer *create_OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer_initWithOrgApacheLuceneCodecsDocValuesConsumer_withOrgApacheLuceneIndexSegmentWriteState_withInt_withInt_(OrgApacheLuceneCodecsDocValuesConsumer *delegate, OrgApacheLuceneIndexSegmentWriteState *state, jint maxPointsInLeafNode, jint maxPointsSortInHeap) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer, initWithOrgApacheLuceneCodecsDocValuesConsumer_withOrgApacheLuceneIndexSegmentWriteState_withInt_withInt_, delegate, state, maxPointsInLeafNode, maxPointsSortInHeap)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneBkdtreeBKDTreeDocValuesConsumer)

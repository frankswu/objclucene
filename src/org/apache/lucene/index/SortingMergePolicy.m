//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./misc/src/java/org/apache/lucene/index/SortingMergePolicy.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/IllegalStateException.h"
#include "java/util/ArrayList.h"
#include "java/util/Collections.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "org/apache/lucene/index/CodecReader.h"
#include "org/apache/lucene/index/CompositeReader.h"
#include "org/apache/lucene/index/FilterLeafReader.h"
#include "org/apache/lucene/index/IndexWriter.h"
#include "org/apache/lucene/index/LeafReader.h"
#include "org/apache/lucene/index/MergePolicy.h"
#include "org/apache/lucene/index/MergeReaderWrapper.h"
#include "org/apache/lucene/index/MergeState.h"
#include "org/apache/lucene/index/MergeTrigger.h"
#include "org/apache/lucene/index/MultiReader.h"
#include "org/apache/lucene/index/SegmentCommitInfo.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentInfos.h"
#include "org/apache/lucene/index/SegmentReader.h"
#include "org/apache/lucene/index/SlowCodecReaderWrapper.h"
#include "org/apache/lucene/index/SlowCompositeReaderWrapper.h"
#include "org/apache/lucene/index/Sorter.h"
#include "org/apache/lucene/index/SortingLeafReader.h"
#include "org/apache/lucene/index/SortingMergePolicy.h"
#include "org/apache/lucene/search/Sort.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/util/Bits.h"
#include "org/apache/lucene/util/InfoStream.h"
#include "org/apache/lucene/util/packed/PackedInts.h"
#include "org/apache/lucene/util/packed/PackedLongValues.h"

@interface OrgApacheLuceneIndexSortingMergePolicy ()

+ (NSString *)getSortDescriptionWithOrgApacheLuceneIndexLeafReader:(OrgApacheLuceneIndexLeafReader *)reader;

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification:(OrgApacheLuceneIndexMergePolicy_MergeSpecification *)specification
                                                                                                     withOrgApacheLuceneUtilInfoStream:(OrgApacheLuceneUtilInfoStream *)infoStream;

@end

__attribute__((unused)) static NSString *OrgApacheLuceneIndexSortingMergePolicy_getSortDescriptionWithOrgApacheLuceneIndexLeafReader_(OrgApacheLuceneIndexLeafReader *reader);

__attribute__((unused)) static OrgApacheLuceneIndexMergePolicy_MergeSpecification *OrgApacheLuceneIndexSortingMergePolicy_sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification_withOrgApacheLuceneUtilInfoStream_(OrgApacheLuceneIndexSortingMergePolicy *self, OrgApacheLuceneIndexMergePolicy_MergeSpecification *specification, OrgApacheLuceneUtilInfoStream *infoStream);

@interface OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge () {
 @public
  OrgApacheLuceneIndexSortingMergePolicy *this$0_;
}

- (OrgApacheLuceneUtilPackedPackedLongValues *)getDeletesWithJavaUtilList:(id<JavaUtilList>)readers;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge, this$0_, OrgApacheLuceneIndexSortingMergePolicy *)

__attribute__((unused)) static OrgApacheLuceneUtilPackedPackedLongValues *OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_getDeletesWithJavaUtilList_(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *self, id<JavaUtilList> readers);

@interface OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 : OrgApacheLuceneIndexMergePolicy_DocMap {
 @public
  OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *this$0_;
  OrgApacheLuceneUtilPackedPackedLongValues *val$deletes_;
  OrgApacheLuceneIndexMergeState *val$mergeState_;
}

- (jint)mapWithInt:(jint)old;

- (instancetype)initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge:(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *)outer$
                                 withOrgApacheLuceneUtilPackedPackedLongValues:(OrgApacheLuceneUtilPackedPackedLongValues *)capture$0
                                            withOrgApacheLuceneIndexMergeState:(OrgApacheLuceneIndexMergeState *)capture$1;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1)

J2OBJC_FIELD_SETTER(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1, this$0_, OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1, val$deletes_, OrgApacheLuceneUtilPackedPackedLongValues *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1, val$mergeState_, OrgApacheLuceneIndexMergeState *)

__attribute__((unused)) static void OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1_initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_withOrgApacheLuceneUtilPackedPackedLongValues_withOrgApacheLuceneIndexMergeState_(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 *self, OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *outer$, OrgApacheLuceneUtilPackedPackedLongValues *capture$0, OrgApacheLuceneIndexMergeState *capture$1);

__attribute__((unused)) static OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 *new_OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1_initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_withOrgApacheLuceneUtilPackedPackedLongValues_withOrgApacheLuceneIndexMergeState_(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *outer$, OrgApacheLuceneUtilPackedPackedLongValues *capture$0, OrgApacheLuceneIndexMergeState *capture$1) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1)

@interface OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification () {
 @public
  OrgApacheLuceneIndexSortingMergePolicy *this$0_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification, this$0_, OrgApacheLuceneIndexSortingMergePolicy *)

NSString *OrgApacheLuceneIndexSortingMergePolicy_SORTER_ID_PROP_ = @"sorter";

@implementation OrgApacheLuceneIndexSortingMergePolicy

+ (jboolean)isSortedWithOrgApacheLuceneIndexLeafReader:(OrgApacheLuceneIndexLeafReader *)reader
                         withOrgApacheLuceneSearchSort:(OrgApacheLuceneSearchSort *)sort {
  return OrgApacheLuceneIndexSortingMergePolicy_isSortedWithOrgApacheLuceneIndexLeafReader_withOrgApacheLuceneSearchSort_(reader, sort);
}

+ (NSString *)getSortDescriptionWithOrgApacheLuceneIndexLeafReader:(OrgApacheLuceneIndexLeafReader *)reader {
  return OrgApacheLuceneIndexSortingMergePolicy_getSortDescriptionWithOrgApacheLuceneIndexLeafReader_(reader);
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification:(OrgApacheLuceneIndexMergePolicy_MergeSpecification *)specification
                                                                                                     withOrgApacheLuceneUtilInfoStream:(OrgApacheLuceneUtilInfoStream *)infoStream {
  return OrgApacheLuceneIndexSortingMergePolicy_sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification_withOrgApacheLuceneUtilInfoStream_(self, specification, infoStream);
}

- (instancetype)initWithOrgApacheLuceneIndexMergePolicy:(OrgApacheLuceneIndexMergePolicy *)inArg
                          withOrgApacheLuceneSearchSort:(OrgApacheLuceneSearchSort *)sort {
  OrgApacheLuceneIndexSortingMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_withOrgApacheLuceneSearchSort_(self, inArg, sort);
  return self;
}

- (OrgApacheLuceneSearchSort *)getSort {
  return sort_;
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findMergesWithOrgApacheLuceneIndexMergeTriggerEnum:(OrgApacheLuceneIndexMergeTriggerEnum *)mergeTrigger
                                                                      withOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                       withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return OrgApacheLuceneIndexSortingMergePolicy_sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification_withOrgApacheLuceneUtilInfoStream_(self, [((OrgApacheLuceneIndexMergePolicy *) nil_chk(in_)) findMergesWithOrgApacheLuceneIndexMergeTriggerEnum:mergeTrigger withOrgApacheLuceneIndexSegmentInfos:segmentInfos withOrgApacheLuceneIndexIndexWriter:writer], ((OrgApacheLuceneIndexIndexWriter *) nil_chk(writer))->infoStream_);
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                                                     withInt:(jint)maxSegmentCount
                                                                                             withJavaUtilMap:(id<JavaUtilMap>)segmentsToMerge
                                                                         withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return OrgApacheLuceneIndexSortingMergePolicy_sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification_withOrgApacheLuceneUtilInfoStream_(self, [((OrgApacheLuceneIndexMergePolicy *) nil_chk(in_)) findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:segmentInfos withInt:maxSegmentCount withJavaUtilMap:segmentsToMerge withOrgApacheLuceneIndexIndexWriter:writer], ((OrgApacheLuceneIndexIndexWriter *) nil_chk(writer))->infoStream_);
}

- (OrgApacheLuceneIndexMergePolicy_MergeSpecification *)findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segmentInfos
                                                                                withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return OrgApacheLuceneIndexSortingMergePolicy_sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification_withOrgApacheLuceneUtilInfoStream_(self, [((OrgApacheLuceneIndexMergePolicy *) nil_chk(in_)) findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:segmentInfos withOrgApacheLuceneIndexIndexWriter:writer], ((OrgApacheLuceneIndexIndexWriter *) nil_chk(writer))->infoStream_);
}

- (jboolean)useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:(OrgApacheLuceneIndexSegmentInfos *)segments
                      withOrgApacheLuceneIndexSegmentCommitInfo:(OrgApacheLuceneIndexSegmentCommitInfo *)newSegment
                            withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(in_)) useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:segments withOrgApacheLuceneIndexSegmentCommitInfo:newSegment withOrgApacheLuceneIndexIndexWriter:writer];
}

- (jlong)sizeWithOrgApacheLuceneIndexSegmentCommitInfo:(OrgApacheLuceneIndexSegmentCommitInfo *)info
                   withOrgApacheLuceneIndexIndexWriter:(OrgApacheLuceneIndexIndexWriter *)writer {
  return [((OrgApacheLuceneIndexMergePolicy *) nil_chk(in_)) sizeWithOrgApacheLuceneIndexSegmentCommitInfo:info withOrgApacheLuceneIndexIndexWriter:writer];
}

- (NSString *)description {
  return JreStrcat("$@$@C", @"SortingMergePolicy(", in_, @", sorter=", sorter_, ')');
}

- (void)dealloc {
  RELEASE_(in_);
  RELEASE_(sorter_);
  RELEASE_(sort_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "isSortedWithOrgApacheLuceneIndexLeafReader:withOrgApacheLuceneSearchSort:", "isSorted", "Z", 0x9, NULL, NULL },
    { "getSortDescriptionWithOrgApacheLuceneIndexLeafReader:", "getSortDescription", "Ljava.lang.String;", 0xa, NULL, NULL },
    { "sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification:withOrgApacheLuceneUtilInfoStream:", "sortedMergeSpecification", "Lorg.apache.lucene.index.MergePolicy$MergeSpecification;", 0x2, NULL, NULL },
    { "initWithOrgApacheLuceneIndexMergePolicy:withOrgApacheLuceneSearchSort:", "SortingMergePolicy", NULL, 0x1, NULL, NULL },
    { "getSort", NULL, "Lorg.apache.lucene.search.Sort;", 0x1, NULL, NULL },
    { "findMergesWithOrgApacheLuceneIndexMergeTriggerEnum:withOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexIndexWriter:", "findMerges", "Lorg.apache.lucene.index.MergePolicy$MergeSpecification;", 0x1, "Ljava.io.IOException;", NULL },
    { "findForcedMergesWithOrgApacheLuceneIndexSegmentInfos:withInt:withJavaUtilMap:withOrgApacheLuceneIndexIndexWriter:", "findForcedMerges", "Lorg.apache.lucene.index.MergePolicy$MergeSpecification;", 0x1, "Ljava.io.IOException;", NULL },
    { "findForcedDeletesMergesWithOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexIndexWriter:", "findForcedDeletesMerges", "Lorg.apache.lucene.index.MergePolicy$MergeSpecification;", 0x1, "Ljava.io.IOException;", NULL },
    { "useCompoundFileWithOrgApacheLuceneIndexSegmentInfos:withOrgApacheLuceneIndexSegmentCommitInfo:withOrgApacheLuceneIndexIndexWriter:", "useCompoundFile", "Z", 0x1, "Ljava.io.IOException;", NULL },
    { "sizeWithOrgApacheLuceneIndexSegmentCommitInfo:withOrgApacheLuceneIndexIndexWriter:", "size", "J", 0x4, "Ljava.io.IOException;", NULL },
    { "description", "toString", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "SORTER_ID_PROP_", NULL, 0x19, "Ljava.lang.String;", &OrgApacheLuceneIndexSortingMergePolicy_SORTER_ID_PROP_, NULL, .constantValue.asLong = 0 },
    { "in_", NULL, 0x10, "Lorg.apache.lucene.index.MergePolicy;", NULL, NULL, .constantValue.asLong = 0 },
    { "sorter_", NULL, 0x10, "Lorg.apache.lucene.index.Sorter;", NULL, NULL, .constantValue.asLong = 0 },
    { "sort_", NULL, 0x10, "Lorg.apache.lucene.search.Sort;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lorg.apache.lucene.index.SortingMergePolicy$SortingOneMerge;", "Lorg.apache.lucene.index.SortingMergePolicy$SortingMergeSpecification;"};
  static const J2ObjcClassInfo _OrgApacheLuceneIndexSortingMergePolicy = { 2, "SortingMergePolicy", "org.apache.lucene.index", NULL, 0x11, 11, methods, 4, fields, 0, NULL, 2, inner_classes, NULL, NULL };
  return &_OrgApacheLuceneIndexSortingMergePolicy;
}

@end

jboolean OrgApacheLuceneIndexSortingMergePolicy_isSortedWithOrgApacheLuceneIndexLeafReader_withOrgApacheLuceneSearchSort_(OrgApacheLuceneIndexLeafReader *reader, OrgApacheLuceneSearchSort *sort) {
  OrgApacheLuceneIndexSortingMergePolicy_initialize();
  NSString *description_ = OrgApacheLuceneIndexSortingMergePolicy_getSortDescriptionWithOrgApacheLuceneIndexLeafReader_(reader);
  if (description_ != nil && [description_ isEqual:[((OrgApacheLuceneSearchSort *) nil_chk(sort)) description]]) {
    return true;
  }
  return false;
}

NSString *OrgApacheLuceneIndexSortingMergePolicy_getSortDescriptionWithOrgApacheLuceneIndexLeafReader_(OrgApacheLuceneIndexLeafReader *reader) {
  OrgApacheLuceneIndexSortingMergePolicy_initialize();
  if ([reader isKindOfClass:[OrgApacheLuceneIndexSegmentReader class]]) {
    OrgApacheLuceneIndexSegmentReader *segReader = (OrgApacheLuceneIndexSegmentReader *) check_class_cast(reader, [OrgApacheLuceneIndexSegmentReader class]);
    id<JavaUtilMap> diagnostics = [((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentCommitInfo *) nil_chk([((OrgApacheLuceneIndexSegmentReader *) nil_chk(segReader)) getSegmentInfo]))->info_)) getDiagnostics];
    if (diagnostics != nil) {
      return [diagnostics getWithId:OrgApacheLuceneIndexSortingMergePolicy_SORTER_ID_PROP_];
    }
  }
  else if ([reader isKindOfClass:[OrgApacheLuceneIndexFilterLeafReader class]]) {
    return OrgApacheLuceneIndexSortingMergePolicy_getSortDescriptionWithOrgApacheLuceneIndexLeafReader_(OrgApacheLuceneIndexFilterLeafReader_unwrapWithOrgApacheLuceneIndexLeafReader_(reader));
  }
  return nil;
}

OrgApacheLuceneIndexMergePolicy_MergeSpecification *OrgApacheLuceneIndexSortingMergePolicy_sortedMergeSpecificationWithOrgApacheLuceneIndexMergePolicy_MergeSpecification_withOrgApacheLuceneUtilInfoStream_(OrgApacheLuceneIndexSortingMergePolicy *self, OrgApacheLuceneIndexMergePolicy_MergeSpecification *specification, OrgApacheLuceneUtilInfoStream *infoStream) {
  if (specification == nil) {
    return nil;
  }
  OrgApacheLuceneIndexMergePolicy_MergeSpecification *sortingSpec = [new_OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification_initWithOrgApacheLuceneIndexSortingMergePolicy_withOrgApacheLuceneUtilInfoStream_(self, infoStream) autorelease];
  for (OrgApacheLuceneIndexMergePolicy_OneMerge * __strong merge in nil_chk(((OrgApacheLuceneIndexMergePolicy_MergeSpecification *) nil_chk(specification))->merges_)) {
    [sortingSpec addWithOrgApacheLuceneIndexMergePolicy_OneMerge:merge];
  }
  return sortingSpec;
}

void OrgApacheLuceneIndexSortingMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_withOrgApacheLuceneSearchSort_(OrgApacheLuceneIndexSortingMergePolicy *self, OrgApacheLuceneIndexMergePolicy *inArg, OrgApacheLuceneSearchSort *sort) {
  OrgApacheLuceneIndexMergePolicy_init(self);
  JreStrongAssign(&self->in_, inArg);
  JreStrongAssignAndConsume(&self->sorter_, new_OrgApacheLuceneIndexSorter_initWithOrgApacheLuceneSearchSort_(sort));
  JreStrongAssign(&self->sort_, sort);
}

OrgApacheLuceneIndexSortingMergePolicy *new_OrgApacheLuceneIndexSortingMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_withOrgApacheLuceneSearchSort_(OrgApacheLuceneIndexMergePolicy *inArg, OrgApacheLuceneSearchSort *sort) {
  OrgApacheLuceneIndexSortingMergePolicy *self = [OrgApacheLuceneIndexSortingMergePolicy alloc];
  OrgApacheLuceneIndexSortingMergePolicy_initWithOrgApacheLuceneIndexMergePolicy_withOrgApacheLuceneSearchSort_(self, inArg, sort);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneIndexSortingMergePolicy)

@implementation OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge

- (instancetype)initWithOrgApacheLuceneIndexSortingMergePolicy:(OrgApacheLuceneIndexSortingMergePolicy *)outer$
                                              withJavaUtilList:(id<JavaUtilList>)segments
                             withOrgApacheLuceneUtilInfoStream:(OrgApacheLuceneUtilInfoStream *)infoStream {
  OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_initWithOrgApacheLuceneIndexSortingMergePolicy_withJavaUtilList_withOrgApacheLuceneUtilInfoStream_(self, outer$, segments, infoStream);
  return self;
}

- (id<JavaUtilList>)getMergeReaders {
  if (unsortedReaders_ == nil) {
    JreStrongAssign(&unsortedReaders_, [super getMergeReaders]);
    if ([((OrgApacheLuceneUtilInfoStream *) nil_chk(infoStream_)) isEnabledWithNSString:@"SMP"]) {
      [infoStream_ messageWithNSString:@"SMP" withNSString:JreStrcat("$@", @"sorting ", unsortedReaders_)];
      for (OrgApacheLuceneIndexLeafReader * __strong leaf in nil_chk(unsortedReaders_)) {
        NSString *sortDescription = OrgApacheLuceneIndexSortingMergePolicy_getSortDescriptionWithOrgApacheLuceneIndexLeafReader_(leaf);
        if (sortDescription == nil) {
          sortDescription = @"not sorted";
        }
        [infoStream_ messageWithNSString:@"SMP" withNSString:JreStrcat("$@C$", @"seg=", leaf, ' ', sortDescription)];
      }
    }
    id<JavaUtilList> wrapped = [new_JavaUtilArrayList_initWithInt_([((id<JavaUtilList>) nil_chk(unsortedReaders_)) size]) autorelease];
    for (OrgApacheLuceneIndexLeafReader * __strong leaf in unsortedReaders_) {
      if ([leaf isKindOfClass:[OrgApacheLuceneIndexSegmentReader class]]) {
        leaf = [new_OrgApacheLuceneIndexMergeReaderWrapper_initWithOrgApacheLuceneIndexSegmentReader_((OrgApacheLuceneIndexSegmentReader *) check_class_cast(leaf, [OrgApacheLuceneIndexSegmentReader class])) autorelease];
      }
      [wrapped addWithId:leaf];
    }
    OrgApacheLuceneIndexLeafReader *atomicView;
    if ([wrapped size] == 1) {
      atomicView = [wrapped getWithInt:0];
    }
    else {
      OrgApacheLuceneIndexCompositeReader *multiReader = [new_OrgApacheLuceneIndexMultiReader_initWithOrgApacheLuceneIndexIndexReaderArray_([wrapped toArrayWithNSObjectArray:[IOSObjectArray arrayWithLength:[wrapped size] type:OrgApacheLuceneIndexLeafReader_class_()]]) autorelease];
      atomicView = [new_OrgApacheLuceneIndexSlowCompositeReaderWrapper_initWithOrgApacheLuceneIndexCompositeReader_withBoolean_(multiReader, true) autorelease];
    }
    JreStrongAssign(&docMap_, [((OrgApacheLuceneIndexSorter *) nil_chk(this$0_->sorter_)) sortWithOrgApacheLuceneIndexLeafReader:atomicView]);
    JreStrongAssign(&sortedView_, OrgApacheLuceneIndexSortingLeafReader_wrapWithOrgApacheLuceneIndexLeafReader_withOrgApacheLuceneIndexSorter_DocMap_(atomicView, docMap_));
  }
  if (docMap_ == nil) {
    if ([((OrgApacheLuceneUtilInfoStream *) nil_chk(infoStream_)) isEnabledWithNSString:@"SMP"]) {
      [infoStream_ messageWithNSString:@"SMP" withNSString:@"readers already sorted, omitting sort"];
    }
    return unsortedReaders_;
  }
  else {
    if ([((OrgApacheLuceneUtilInfoStream *) nil_chk(infoStream_)) isEnabledWithNSString:@"SMP"]) {
      [infoStream_ messageWithNSString:@"SMP" withNSString:JreStrcat("$@", @"sorting readers by ", this$0_->sort_)];
    }
    return JavaUtilCollections_singletonListWithId_(OrgApacheLuceneIndexSlowCodecReaderWrapper_wrapWithOrgApacheLuceneIndexLeafReader_(sortedView_));
  }
}

- (void)setMergeInfoWithOrgApacheLuceneIndexSegmentCommitInfo:(OrgApacheLuceneIndexSegmentCommitInfo *)info {
  id<JavaUtilMap> diagnostics = [((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentCommitInfo *) nil_chk(info))->info_)) getDiagnostics];
  [((id<JavaUtilMap>) nil_chk(diagnostics)) putWithId:OrgApacheLuceneIndexSortingMergePolicy_SORTER_ID_PROP_ withId:[((OrgApacheLuceneIndexSorter *) nil_chk(this$0_->sorter_)) getID]];
  [super setMergeInfoWithOrgApacheLuceneIndexSegmentCommitInfo:info];
}

- (OrgApacheLuceneUtilPackedPackedLongValues *)getDeletesWithJavaUtilList:(id<JavaUtilList>)readers {
  return OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_getDeletesWithJavaUtilList_(self, readers);
}

- (OrgApacheLuceneIndexMergePolicy_DocMap *)getDocMapWithOrgApacheLuceneIndexMergeState:(OrgApacheLuceneIndexMergeState *)mergeState {
  if (unsortedReaders_ == nil) {
    @throw [new_JavaLangIllegalStateException_init() autorelease];
  }
  if (docMap_ == nil) {
    return [super getDocMapWithOrgApacheLuceneIndexMergeState:mergeState];
  }
  JreAssert((((IOSObjectArray *) nil_chk(((OrgApacheLuceneIndexMergeState *) nil_chk(mergeState))->docMaps_))->size_ == 1), (@"org/apache/lucene/index/SortingMergePolicy.java:156 condition failed: assert mergeState.docMaps.length == 1;"));
  OrgApacheLuceneUtilPackedPackedLongValues *deletes = OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_getDeletesWithJavaUtilList_(self, unsortedReaders_);
  return [new_OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1_initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_withOrgApacheLuceneUtilPackedPackedLongValues_withOrgApacheLuceneIndexMergeState_(self, deletes, mergeState) autorelease];
}

- (void)dealloc {
  RELEASE_(this$0_);
  RELEASE_(unsortedReaders_);
  RELEASE_(docMap_);
  RELEASE_(sortedView_);
  RELEASE_(infoStream_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneIndexSortingMergePolicy:withJavaUtilList:withOrgApacheLuceneUtilInfoStream:", "SortingOneMerge", NULL, 0x0, NULL, NULL },
    { "getMergeReaders", NULL, "Ljava.util.List;", 0x1, "Ljava.io.IOException;", NULL },
    { "setMergeInfoWithOrgApacheLuceneIndexSegmentCommitInfo:", "setMergeInfo", "V", 0x1, NULL, NULL },
    { "getDeletesWithJavaUtilList:", "getDeletes", "Lorg.apache.lucene.util.packed.PackedLongValues;", 0x2, NULL, NULL },
    { "getDocMapWithOrgApacheLuceneIndexMergeState:", "getDocMap", "Lorg.apache.lucene.index.MergePolicy$DocMap;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lorg.apache.lucene.index.SortingMergePolicy;", NULL, NULL, .constantValue.asLong = 0 },
    { "unsortedReaders_", NULL, 0x0, "Ljava.util.List;", NULL, "Ljava/util/List<Lorg/apache/lucene/index/CodecReader;>;", .constantValue.asLong = 0 },
    { "docMap_", NULL, 0x0, "Lorg.apache.lucene.index.Sorter$DocMap;", NULL, NULL, .constantValue.asLong = 0 },
    { "sortedView_", NULL, 0x0, "Lorg.apache.lucene.index.LeafReader;", NULL, NULL, .constantValue.asLong = 0 },
    { "infoStream_", NULL, 0x10, "Lorg.apache.lucene.util.InfoStream;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge = { 2, "SortingOneMerge", "org.apache.lucene.index", "SortingMergePolicy", 0x0, 5, methods, 5, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge;
}

@end

void OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_initWithOrgApacheLuceneIndexSortingMergePolicy_withJavaUtilList_withOrgApacheLuceneUtilInfoStream_(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *self, OrgApacheLuceneIndexSortingMergePolicy *outer$, id<JavaUtilList> segments, OrgApacheLuceneUtilInfoStream *infoStream) {
  JreStrongAssign(&self->this$0_, outer$);
  OrgApacheLuceneIndexMergePolicy_OneMerge_initWithJavaUtilList_(self, segments);
  JreStrongAssign(&self->infoStream_, infoStream);
}

OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *new_OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_initWithOrgApacheLuceneIndexSortingMergePolicy_withJavaUtilList_withOrgApacheLuceneUtilInfoStream_(OrgApacheLuceneIndexSortingMergePolicy *outer$, id<JavaUtilList> segments, OrgApacheLuceneUtilInfoStream *infoStream) {
  OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *self = [OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge alloc];
  OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_initWithOrgApacheLuceneIndexSortingMergePolicy_withJavaUtilList_withOrgApacheLuceneUtilInfoStream_(self, outer$, segments, infoStream);
  return self;
}

OrgApacheLuceneUtilPackedPackedLongValues *OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_getDeletesWithJavaUtilList_(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *self, id<JavaUtilList> readers) {
  OrgApacheLuceneUtilPackedPackedLongValues_Builder *deletes = OrgApacheLuceneUtilPackedPackedLongValues_monotonicBuilderWithFloat_(OrgApacheLuceneUtilPackedPackedInts_COMPACT);
  jint deleteCount = 0;
  for (OrgApacheLuceneIndexLeafReader * __strong reader in nil_chk(readers)) {
    jint maxDoc = [((OrgApacheLuceneIndexLeafReader *) nil_chk(reader)) maxDoc];
    id<OrgApacheLuceneUtilBits> liveDocs = [reader getLiveDocs];
    for (jint i = 0; i < maxDoc; ++i) {
      if (liveDocs != nil && ![liveDocs getWithInt:i]) {
        ++deleteCount;
      }
      else {
        [((OrgApacheLuceneUtilPackedPackedLongValues_Builder *) nil_chk(deletes)) addWithLong:deleteCount];
      }
    }
  }
  return [((OrgApacheLuceneUtilPackedPackedLongValues_Builder *) nil_chk(deletes)) build];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge)

@implementation OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1

- (jint)mapWithInt:(jint)old {
  jint oldWithDeletes = old + (jint) [((OrgApacheLuceneUtilPackedPackedLongValues *) nil_chk(val$deletes_)) getWithInt:old];
  jint newWithDeletes = [((OrgApacheLuceneIndexSorter_DocMap *) nil_chk(this$0_->docMap_)) oldToNewWithInt:oldWithDeletes];
  return [((OrgApacheLuceneIndexMergeState_DocMap *) nil_chk(IOSObjectArray_Get(nil_chk(((OrgApacheLuceneIndexMergeState *) nil_chk(val$mergeState_))->docMaps_), 0))) getWithInt:newWithDeletes];
}

- (instancetype)initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge:(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *)outer$
                                 withOrgApacheLuceneUtilPackedPackedLongValues:(OrgApacheLuceneUtilPackedPackedLongValues *)capture$0
                                            withOrgApacheLuceneIndexMergeState:(OrgApacheLuceneIndexMergeState *)capture$1 {
  OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1_initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_withOrgApacheLuceneUtilPackedPackedLongValues_withOrgApacheLuceneIndexMergeState_(self, outer$, capture$0, capture$1);
  return self;
}

- (void)dealloc {
  RELEASE_(this$0_);
  RELEASE_(val$deletes_);
  RELEASE_(val$mergeState_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "mapWithInt:", "map", "I", 0x1, NULL, NULL },
    { "initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge:withOrgApacheLuceneUtilPackedPackedLongValues:withOrgApacheLuceneIndexMergeState:", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lorg.apache.lucene.index.SortingMergePolicy$SortingOneMerge;", NULL, NULL, .constantValue.asLong = 0 },
    { "val$deletes_", NULL, 0x1012, "Lorg.apache.lucene.util.packed.PackedLongValues;", NULL, NULL, .constantValue.asLong = 0 },
    { "val$mergeState_", NULL, 0x1012, "Lorg.apache.lucene.index.MergeState;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge", "getDocMapWithOrgApacheLuceneIndexMergeState:" };
  static const J2ObjcClassInfo _OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 = { 2, "", "org.apache.lucene.index", "SortingMergePolicy$SortingOneMerge", 0x8008, 2, methods, 3, fields, 0, NULL, 0, NULL, &enclosing_method, NULL };
  return &_OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1;
}

@end

void OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1_initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_withOrgApacheLuceneUtilPackedPackedLongValues_withOrgApacheLuceneIndexMergeState_(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 *self, OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *outer$, OrgApacheLuceneUtilPackedPackedLongValues *capture$0, OrgApacheLuceneIndexMergeState *capture$1) {
  JreStrongAssign(&self->this$0_, outer$);
  JreStrongAssign(&self->val$deletes_, capture$0);
  JreStrongAssign(&self->val$mergeState_, capture$1);
  OrgApacheLuceneIndexMergePolicy_DocMap_init(self);
}

OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 *new_OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1_initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_withOrgApacheLuceneUtilPackedPackedLongValues_withOrgApacheLuceneIndexMergeState_(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge *outer$, OrgApacheLuceneUtilPackedPackedLongValues *capture$0, OrgApacheLuceneIndexMergeState *capture$1) {
  OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 *self = [OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1 alloc];
  OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1_initWithOrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_withOrgApacheLuceneUtilPackedPackedLongValues_withOrgApacheLuceneIndexMergeState_(self, outer$, capture$0, capture$1);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_$1)

@implementation OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification

- (instancetype)initWithOrgApacheLuceneIndexSortingMergePolicy:(OrgApacheLuceneIndexSortingMergePolicy *)outer$
                             withOrgApacheLuceneUtilInfoStream:(OrgApacheLuceneUtilInfoStream *)infoStream {
  OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification_initWithOrgApacheLuceneIndexSortingMergePolicy_withOrgApacheLuceneUtilInfoStream_(self, outer$, infoStream);
  return self;
}

- (void)addWithOrgApacheLuceneIndexMergePolicy_OneMerge:(OrgApacheLuceneIndexMergePolicy_OneMerge *)merge {
  [super addWithOrgApacheLuceneIndexMergePolicy_OneMerge:[new_OrgApacheLuceneIndexSortingMergePolicy_SortingOneMerge_initWithOrgApacheLuceneIndexSortingMergePolicy_withJavaUtilList_withOrgApacheLuceneUtilInfoStream_(this$0_, ((OrgApacheLuceneIndexMergePolicy_OneMerge *) nil_chk(merge))->segments_, infoStream_) autorelease]];
}

- (NSString *)segStringWithOrgApacheLuceneStoreDirectory:(OrgApacheLuceneStoreDirectory *)dir {
  return JreStrcat("$$$@C", @"SortingMergeSpec(", [super segStringWithOrgApacheLuceneStoreDirectory:dir], @", sorter=", this$0_->sorter_, ')');
}

- (void)dealloc {
  RELEASE_(this$0_);
  RELEASE_(infoStream_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneIndexSortingMergePolicy:withOrgApacheLuceneUtilInfoStream:", "SortingMergeSpecification", NULL, 0x0, NULL, NULL },
    { "addWithOrgApacheLuceneIndexMergePolicy_OneMerge:", "add", "V", 0x1, NULL, NULL },
    { "segStringWithOrgApacheLuceneStoreDirectory:", "segString", "Ljava.lang.String;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lorg.apache.lucene.index.SortingMergePolicy;", NULL, NULL, .constantValue.asLong = 0 },
    { "infoStream_", NULL, 0x10, "Lorg.apache.lucene.util.InfoStream;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification = { 2, "SortingMergeSpecification", "org.apache.lucene.index", "SortingMergePolicy", 0x0, 3, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification;
}

@end

void OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification_initWithOrgApacheLuceneIndexSortingMergePolicy_withOrgApacheLuceneUtilInfoStream_(OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification *self, OrgApacheLuceneIndexSortingMergePolicy *outer$, OrgApacheLuceneUtilInfoStream *infoStream) {
  JreStrongAssign(&self->this$0_, outer$);
  OrgApacheLuceneIndexMergePolicy_MergeSpecification_init(self);
  JreStrongAssign(&self->infoStream_, infoStream);
}

OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification *new_OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification_initWithOrgApacheLuceneIndexSortingMergePolicy_withOrgApacheLuceneUtilInfoStream_(OrgApacheLuceneIndexSortingMergePolicy *outer$, OrgApacheLuceneUtilInfoStream *infoStream) {
  OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification *self = [OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification alloc];
  OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification_initWithOrgApacheLuceneIndexSortingMergePolicy_withOrgApacheLuceneUtilInfoStream_(self, outer$, infoStream);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneIndexSortingMergePolicy_SortingMergeSpecification)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./codecs/src/java/org/apache/lucene/codecs/simpletext/SimpleTextFieldsWriter.java
//

#include "IOSClass.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Integer.h"
#include "org/apache/lucene/codecs/FieldsConsumer.h"
#include "org/apache/lucene/codecs/simpletext/SimpleTextFieldsWriter.h"
#include "org/apache/lucene/codecs/simpletext/SimpleTextPostingsFormat.h"
#include "org/apache/lucene/codecs/simpletext/SimpleTextUtil.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/FieldInfos.h"
#include "org/apache/lucene/index/Fields.h"
#include "org/apache/lucene/index/PostingsEnum.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentWriteState.h"
#include "org/apache/lucene/index/Terms.h"
#include "org/apache/lucene/index/TermsEnum.h"
#include "org/apache/lucene/search/DocIdSetIterator.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IOContext.h"
#include "org/apache/lucene/store/IndexOutput.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/BytesRefBuilder.h"

@interface OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter () {
 @public
  OrgApacheLuceneStoreIndexOutput *out_;
  OrgApacheLuceneUtilBytesRefBuilder *scratch_;
  OrgApacheLuceneIndexSegmentWriteState *writeState_;
}

- (void)writeWithNSString:(NSString *)s;

- (void)writeWithOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)b;

- (void)newline OBJC_METHOD_FAMILY_NONE;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter, out_, OrgApacheLuceneStoreIndexOutput *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter, scratch_, OrgApacheLuceneUtilBytesRefBuilder *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter, writeState_, OrgApacheLuceneIndexSegmentWriteState *)

__attribute__((unused)) static void OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self, NSString *s);

__attribute__((unused)) static void OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self, OrgApacheLuceneUtilBytesRef *b);

__attribute__((unused)) static void OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self);

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter)

OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FIELD_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_TERM_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_DOC_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FREQ_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_POS_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_START_OFFSET_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_OFFSET_;
OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_PAYLOAD_;

@implementation OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter

- (instancetype)initWithOrgApacheLuceneIndexSegmentWriteState:(OrgApacheLuceneIndexSegmentWriteState *)writeState {
  OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_(self, writeState);
  return self;
}

- (void)writeWithOrgApacheLuceneIndexFields:(OrgApacheLuceneIndexFields *)fields {
  [self writeWithOrgApacheLuceneIndexFieldInfos:((OrgApacheLuceneIndexSegmentWriteState *) nil_chk(writeState_))->fieldInfos_ withOrgApacheLuceneIndexFields:fields];
}

- (void)writeWithOrgApacheLuceneIndexFieldInfos:(OrgApacheLuceneIndexFieldInfos *)fieldInfos
                 withOrgApacheLuceneIndexFields:(OrgApacheLuceneIndexFields *)fields {
  for (NSString * __strong field in nil_chk(fields)) {
    OrgApacheLuceneIndexTerms *terms = [fields termsWithNSString:field];
    if (terms == nil) {
      continue;
    }
    OrgApacheLuceneIndexFieldInfo *fieldInfo = [((OrgApacheLuceneIndexFieldInfos *) nil_chk(fieldInfos)) fieldInfoWithNSString:field];
    jboolean wroteField = NO;
    jboolean hasPositions = [((OrgApacheLuceneIndexTerms *) nil_chk(terms)) hasPositions];
    jboolean hasFreqs = [terms hasFreqs];
    jboolean hasPayloads = [((OrgApacheLuceneIndexFieldInfo *) nil_chk(fieldInfo)) hasPayloads];
    jboolean hasOffsets = [terms hasOffsets];
    jint flags = 0;
    if (hasPositions) {
      flags = OrgApacheLuceneIndexPostingsEnum_POSITIONS;
      if (hasPayloads) {
        flags = flags | OrgApacheLuceneIndexPostingsEnum_PAYLOADS;
      }
      if (hasOffsets) {
        flags = flags | OrgApacheLuceneIndexPostingsEnum_OFFSETS;
      }
    }
    else {
      if (hasFreqs) {
        flags = flags | OrgApacheLuceneIndexPostingsEnum_FREQS;
      }
    }
    OrgApacheLuceneIndexTermsEnum *termsEnum = [terms iterator];
    OrgApacheLuceneIndexPostingsEnum *postingsEnum = nil;
    while (YES) {
      OrgApacheLuceneUtilBytesRef *term = [((OrgApacheLuceneIndexTermsEnum *) nil_chk(termsEnum)) next];
      if (term == nil) {
        break;
      }
      postingsEnum = [termsEnum postingsWithOrgApacheLuceneIndexPostingsEnum:postingsEnum withInt:flags];
      JreAssert((postingsEnum != nil), (JreStrcat("$@$Z$I", @"termsEnum=", termsEnum, @" hasPos=", hasPositions, @" flags=", flags)));
      jboolean wroteTerm = NO;
      while (YES) {
        jint doc = [((OrgApacheLuceneIndexPostingsEnum *) nil_chk(postingsEnum)) nextDoc];
        if (doc == OrgApacheLuceneSearchDocIdSetIterator_NO_MORE_DOCS) {
          break;
        }
        if (!wroteTerm) {
          if (!wroteField) {
            OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FIELD_);
            OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(self, field);
            OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
            wroteField = YES;
          }
          OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_TERM_);
          OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, term);
          OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
          wroteTerm = YES;
        }
        OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_DOC_);
        OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(self, JavaLangInteger_toStringWithInt_(doc));
        OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
        if (hasFreqs) {
          jint freq = [postingsEnum freq];
          OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FREQ_);
          OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(self, JavaLangInteger_toStringWithInt_(freq));
          OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
          if (hasPositions) {
            jint lastStartOffset = 0;
            for (jint i = 0; i < freq; i++) {
              jint position = [postingsEnum nextPosition];
              OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_POS_);
              OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(self, JavaLangInteger_toStringWithInt_(position));
              OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
              if (hasOffsets) {
                jint startOffset = [postingsEnum startOffset];
                jint endOffset = [postingsEnum endOffset];
                JreAssert((endOffset >= startOffset), (@"org/apache/lucene/codecs/simpletext/SimpleTextFieldsWriter.java:160 condition failed: assert endOffset >= startOffset;"));
                JreAssert((startOffset >= lastStartOffset), (JreStrcat("$I$I", @"startOffset=", startOffset, @" lastStartOffset=", lastStartOffset)));
                lastStartOffset = startOffset;
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_START_OFFSET_);
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(self, JavaLangInteger_toStringWithInt_(startOffset));
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_OFFSET_);
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(self, JavaLangInteger_toStringWithInt_(endOffset));
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
              }
              OrgApacheLuceneUtilBytesRef *payload = [postingsEnum getPayload];
              if (payload != nil && payload->length_ > 0) {
                JreAssert((payload->length_ != 0), (@"org/apache/lucene/codecs/simpletext/SimpleTextFieldsWriter.java:174 condition failed: assert payload.length != 0;"));
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_PAYLOAD_);
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, payload);
                OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
              }
            }
          }
        }
      }
    }
  }
}

- (void)writeWithNSString:(NSString *)s {
  OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(self, s);
}

- (void)writeWithOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)b {
  OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, b);
}

- (void)newline {
  OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
}

- (void)close {
  if (out_ != nil) {
    @try {
      OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(self, OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_);
      OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(self);
      OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeChecksumWithOrgApacheLuceneStoreIndexOutput_withOrgApacheLuceneUtilBytesRefBuilder_(out_, scratch_);
    }
    @finally {
      [out_ close];
      JreStrongAssign(&out_, nil);
    }
  }
}

- (void)dealloc {
  RELEASE_(out_);
  RELEASE_(scratch_);
  RELEASE_(writeState_);
  [super dealloc];
}

+ (void)initialize {
  if (self == [OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter class]) {
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"END"));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FIELD_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"field "));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_TERM_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"  term "));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_DOC_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"    doc "));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FREQ_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"      freq "));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_POS_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"      pos "));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_START_OFFSET_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"      startOffset "));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_OFFSET_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"      endOffset "));
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_PAYLOAD_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"        payload "));
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneIndexSegmentWriteState:", "SimpleTextFieldsWriter", NULL, 0x1, "Ljava.io.IOException;", NULL },
    { "writeWithOrgApacheLuceneIndexFields:", "write", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "writeWithOrgApacheLuceneIndexFieldInfos:withOrgApacheLuceneIndexFields:", "write", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "writeWithNSString:", "write", "V", 0x2, "Ljava.io.IOException;", NULL },
    { "writeWithOrgApacheLuceneUtilBytesRef:", "write", "V", 0x2, "Ljava.io.IOException;", NULL },
    { "newline", NULL, "V", 0x2, "Ljava.io.IOException;", NULL },
    { "close", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "out_", NULL, 0x2, "Lorg.apache.lucene.store.IndexOutput;", NULL, NULL, .constantValue.asLong = 0 },
    { "scratch_", NULL, 0x12, "Lorg.apache.lucene.util.BytesRefBuilder;", NULL, NULL, .constantValue.asLong = 0 },
    { "writeState_", NULL, 0x12, "Lorg.apache.lucene.index.SegmentWriteState;", NULL, NULL, .constantValue.asLong = 0 },
    { "END_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_, NULL, .constantValue.asLong = 0 },
    { "FIELD_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FIELD_, NULL, .constantValue.asLong = 0 },
    { "TERM_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_TERM_, NULL, .constantValue.asLong = 0 },
    { "DOC_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_DOC_, NULL, .constantValue.asLong = 0 },
    { "FREQ_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_FREQ_, NULL, .constantValue.asLong = 0 },
    { "POS_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_POS_, NULL, .constantValue.asLong = 0 },
    { "START_OFFSET_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_START_OFFSET_, NULL, .constantValue.asLong = 0 },
    { "END_OFFSET_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_END_OFFSET_, NULL, .constantValue.asLong = 0 },
    { "PAYLOAD_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_PAYLOAD_, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter = { 2, "SimpleTextFieldsWriter", "org.apache.lucene.codecs.simpletext", NULL, 0x0, 7, methods, 12, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter;
}

@end

void OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self, OrgApacheLuceneIndexSegmentWriteState *writeState) {
  OrgApacheLuceneCodecsFieldsConsumer_init(self);
  JreStrongAssignAndConsume(&self->scratch_, new_OrgApacheLuceneUtilBytesRefBuilder_init());
  NSString *fileName = OrgApacheLuceneCodecsSimpletextSimpleTextPostingsFormat_getPostingsFileNameWithNSString_withNSString_(((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentWriteState *) nil_chk(writeState))->segmentInfo_))->name_, writeState->segmentSuffix_);
  JreStrongAssign(&self->out_, [((OrgApacheLuceneStoreDirectory *) nil_chk(writeState->directory_)) createOutputWithNSString:fileName withOrgApacheLuceneStoreIOContext:writeState->context_]);
  JreStrongAssign(&self->writeState_, writeState);
}

OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *new_OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_(OrgApacheLuceneIndexSegmentWriteState *writeState) {
  OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self = [OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter alloc];
  OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_(self, writeState);
  return self;
}

void OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithNSString_(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self, NSString *s) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withNSString_withOrgApacheLuceneUtilBytesRefBuilder_(self->out_, s, self->scratch_);
}

void OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_writeWithOrgApacheLuceneUtilBytesRef_(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self, OrgApacheLuceneUtilBytesRef *b) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withOrgApacheLuceneUtilBytesRef_(self->out_, b);
}

void OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter_newline(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter *self) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeNewlineWithOrgApacheLuceneStoreDataOutput_(self->out_);
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsSimpletextSimpleTextFieldsWriter)

//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./codecs/src/java/org/apache/lucene/codecs/simpletext/SimpleTextUtil.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/Long.h"
#include "java/util/Locale.h"
#include "org/apache/lucene/codecs/simpletext/SimpleTextUtil.h"
#include "org/apache/lucene/index/CorruptIndexException.h"
#include "org/apache/lucene/store/ChecksumIndexInput.h"
#include "org/apache/lucene/store/DataInput.h"
#include "org/apache/lucene/store/DataOutput.h"
#include "org/apache/lucene/store/IndexOutput.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/BytesRefBuilder.h"
#include "org/apache/lucene/util/StringHelper.h"

J2OBJC_INITIALIZED_DEFN(OrgApacheLuceneCodecsSimpletextSimpleTextUtil)

OrgApacheLuceneUtilBytesRef *OrgApacheLuceneCodecsSimpletextSimpleTextUtil_CHECKSUM_;

@implementation OrgApacheLuceneCodecsSimpletextSimpleTextUtil

+ (void)writeWithOrgApacheLuceneStoreDataOutput:(OrgApacheLuceneStoreDataOutput *)outArg
                                   withNSString:(NSString *)s
         withOrgApacheLuceneUtilBytesRefBuilder:(OrgApacheLuceneUtilBytesRefBuilder *)scratch {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withNSString_withOrgApacheLuceneUtilBytesRefBuilder_(outArg, s, scratch);
}

+ (void)writeWithOrgApacheLuceneStoreDataOutput:(OrgApacheLuceneStoreDataOutput *)outArg
                withOrgApacheLuceneUtilBytesRef:(OrgApacheLuceneUtilBytesRef *)b {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withOrgApacheLuceneUtilBytesRef_(outArg, b);
}

+ (void)writeNewlineWithOrgApacheLuceneStoreDataOutput:(OrgApacheLuceneStoreDataOutput *)outArg {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeNewlineWithOrgApacheLuceneStoreDataOutput_(outArg);
}

+ (void)readLineWithOrgApacheLuceneStoreDataInput:(OrgApacheLuceneStoreDataInput *)inArg
           withOrgApacheLuceneUtilBytesRefBuilder:(OrgApacheLuceneUtilBytesRefBuilder *)scratch {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_readLineWithOrgApacheLuceneStoreDataInput_withOrgApacheLuceneUtilBytesRefBuilder_(inArg, scratch);
}

+ (void)writeChecksumWithOrgApacheLuceneStoreIndexOutput:(OrgApacheLuceneStoreIndexOutput *)outArg
                  withOrgApacheLuceneUtilBytesRefBuilder:(OrgApacheLuceneUtilBytesRefBuilder *)scratch {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeChecksumWithOrgApacheLuceneStoreIndexOutput_withOrgApacheLuceneUtilBytesRefBuilder_(outArg, scratch);
}

+ (void)checkFooterWithOrgApacheLuceneStoreChecksumIndexInput:(OrgApacheLuceneStoreChecksumIndexInput *)input {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_checkFooterWithOrgApacheLuceneStoreChecksumIndexInput_(input);
}

- (instancetype)init {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_init(self);
  return self;
}

+ (void)initialize {
  if (self == [OrgApacheLuceneCodecsSimpletextSimpleTextUtil class]) {
    JreStrongAssignAndConsume(&OrgApacheLuceneCodecsSimpletextSimpleTextUtil_CHECKSUM_, new_OrgApacheLuceneUtilBytesRef_initWithJavaLangCharSequence_(@"checksum "));
    J2OBJC_SET_INITIALIZED(OrgApacheLuceneCodecsSimpletextSimpleTextUtil)
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "writeWithOrgApacheLuceneStoreDataOutput:withNSString:withOrgApacheLuceneUtilBytesRefBuilder:", "write", "V", 0x9, "Ljava.io.IOException;", NULL },
    { "writeWithOrgApacheLuceneStoreDataOutput:withOrgApacheLuceneUtilBytesRef:", "write", "V", 0x9, "Ljava.io.IOException;", NULL },
    { "writeNewlineWithOrgApacheLuceneStoreDataOutput:", "writeNewline", "V", 0x9, "Ljava.io.IOException;", NULL },
    { "readLineWithOrgApacheLuceneStoreDataInput:withOrgApacheLuceneUtilBytesRefBuilder:", "readLine", "V", 0x9, "Ljava.io.IOException;", NULL },
    { "writeChecksumWithOrgApacheLuceneStoreIndexOutput:withOrgApacheLuceneUtilBytesRefBuilder:", "writeChecksum", "V", 0x9, "Ljava.io.IOException;", NULL },
    { "checkFooterWithOrgApacheLuceneStoreChecksumIndexInput:", "checkFooter", "V", 0x9, "Ljava.io.IOException;", NULL },
    { "init", NULL, NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "NEWLINE", "NEWLINE", 0x19, "B", NULL, NULL, .constantValue.asChar = OrgApacheLuceneCodecsSimpletextSimpleTextUtil_NEWLINE },
    { "ESCAPE", "ESCAPE", 0x19, "B", NULL, NULL, .constantValue.asChar = OrgApacheLuceneCodecsSimpletextSimpleTextUtil_ESCAPE },
    { "CHECKSUM_", NULL, 0x18, "Lorg.apache.lucene.util.BytesRef;", &OrgApacheLuceneCodecsSimpletextSimpleTextUtil_CHECKSUM_, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsSimpletextSimpleTextUtil = { 2, "SimpleTextUtil", "org.apache.lucene.codecs.simpletext", NULL, 0x0, 7, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneCodecsSimpletextSimpleTextUtil;
}

@end

void OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withNSString_withOrgApacheLuceneUtilBytesRefBuilder_(OrgApacheLuceneStoreDataOutput *outArg, NSString *s, OrgApacheLuceneUtilBytesRefBuilder *scratch) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_initialize();
  [((OrgApacheLuceneUtilBytesRefBuilder *) nil_chk(scratch)) copyCharsWithJavaLangCharSequence:s withInt:0 withInt:((jint) [((NSString *) nil_chk(s)) length])];
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withOrgApacheLuceneUtilBytesRef_(outArg, [scratch get]);
}

void OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withOrgApacheLuceneUtilBytesRef_(OrgApacheLuceneStoreDataOutput *outArg, OrgApacheLuceneUtilBytesRef *b) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_initialize();
  for (jint i = 0; i < ((OrgApacheLuceneUtilBytesRef *) nil_chk(b))->length_; i++) {
    jbyte bx = IOSByteArray_Get(nil_chk(b->bytes_), b->offset_ + i);
    if (bx == OrgApacheLuceneCodecsSimpletextSimpleTextUtil_NEWLINE || bx == OrgApacheLuceneCodecsSimpletextSimpleTextUtil_ESCAPE) {
      [((OrgApacheLuceneStoreDataOutput *) nil_chk(outArg)) writeByteWithByte:OrgApacheLuceneCodecsSimpletextSimpleTextUtil_ESCAPE];
    }
    [((OrgApacheLuceneStoreDataOutput *) nil_chk(outArg)) writeByteWithByte:bx];
  }
}

void OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeNewlineWithOrgApacheLuceneStoreDataOutput_(OrgApacheLuceneStoreDataOutput *outArg) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_initialize();
  [((OrgApacheLuceneStoreDataOutput *) nil_chk(outArg)) writeByteWithByte:OrgApacheLuceneCodecsSimpletextSimpleTextUtil_NEWLINE];
}

void OrgApacheLuceneCodecsSimpletextSimpleTextUtil_readLineWithOrgApacheLuceneStoreDataInput_withOrgApacheLuceneUtilBytesRefBuilder_(OrgApacheLuceneStoreDataInput *inArg, OrgApacheLuceneUtilBytesRefBuilder *scratch) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_initialize();
  jint upto = 0;
  while (YES) {
    jbyte b = [((OrgApacheLuceneStoreDataInput *) nil_chk(inArg)) readByte];
    [((OrgApacheLuceneUtilBytesRefBuilder *) nil_chk(scratch)) growWithInt:1 + upto];
    if (b == OrgApacheLuceneCodecsSimpletextSimpleTextUtil_ESCAPE) {
      [scratch setByteAtWithInt:upto++ withByte:[inArg readByte]];
    }
    else {
      if (b == OrgApacheLuceneCodecsSimpletextSimpleTextUtil_NEWLINE) {
        break;
      }
      else {
        [scratch setByteAtWithInt:upto++ withByte:b];
      }
    }
  }
  [((OrgApacheLuceneUtilBytesRefBuilder *) nil_chk(scratch)) setLengthWithInt:upto];
}

void OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeChecksumWithOrgApacheLuceneStoreIndexOutput_withOrgApacheLuceneUtilBytesRefBuilder_(OrgApacheLuceneStoreIndexOutput *outArg, OrgApacheLuceneUtilBytesRefBuilder *scratch) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_initialize();
  NSString *checksum = NSString_formatWithJavaUtilLocale_withNSString_withNSObjectArray_(JreLoadStatic(JavaUtilLocale, ROOT_), @"%020d", [IOSObjectArray arrayWithObjects:(id[]){ JavaLangLong_valueOfWithLong_([((OrgApacheLuceneStoreIndexOutput *) nil_chk(outArg)) getChecksum]) } count:1 type:NSObject_class_()]);
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withOrgApacheLuceneUtilBytesRef_(outArg, OrgApacheLuceneCodecsSimpletextSimpleTextUtil_CHECKSUM_);
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeWithOrgApacheLuceneStoreDataOutput_withNSString_withOrgApacheLuceneUtilBytesRefBuilder_(outArg, checksum, scratch);
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_writeNewlineWithOrgApacheLuceneStoreDataOutput_(outArg);
}

void OrgApacheLuceneCodecsSimpletextSimpleTextUtil_checkFooterWithOrgApacheLuceneStoreChecksumIndexInput_(OrgApacheLuceneStoreChecksumIndexInput *input) {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_initialize();
  OrgApacheLuceneUtilBytesRefBuilder *scratch = [new_OrgApacheLuceneUtilBytesRefBuilder_init() autorelease];
  NSString *expectedChecksum = NSString_formatWithJavaUtilLocale_withNSString_withNSObjectArray_(JreLoadStatic(JavaUtilLocale, ROOT_), @"%020d", [IOSObjectArray arrayWithObjects:(id[]){ JavaLangLong_valueOfWithLong_([((OrgApacheLuceneStoreChecksumIndexInput *) nil_chk(input)) getChecksum]) } count:1 type:NSObject_class_()]);
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_readLineWithOrgApacheLuceneStoreDataInput_withOrgApacheLuceneUtilBytesRefBuilder_(input, scratch);
  if (OrgApacheLuceneUtilStringHelper_startsWithWithOrgApacheLuceneUtilBytesRef_withOrgApacheLuceneUtilBytesRef_([scratch get], OrgApacheLuceneCodecsSimpletextSimpleTextUtil_CHECKSUM_) == NO) {
    @throw [new_OrgApacheLuceneIndexCorruptIndexException_initWithNSString_withOrgApacheLuceneStoreDataInput_(JreStrcat("$$", @"SimpleText failure: expected checksum line but got ", [((OrgApacheLuceneUtilBytesRef *) nil_chk([scratch get])) utf8ToString]), input) autorelease];
  }
  NSString *actualChecksum = [((OrgApacheLuceneUtilBytesRef *) [new_OrgApacheLuceneUtilBytesRef_initWithByteArray_withInt_withInt_([scratch bytes], ((OrgApacheLuceneUtilBytesRef *) nil_chk(OrgApacheLuceneCodecsSimpletextSimpleTextUtil_CHECKSUM_))->length_, [scratch length] - OrgApacheLuceneCodecsSimpletextSimpleTextUtil_CHECKSUM_->length_) autorelease]) utf8ToString];
  if (![((NSString *) nil_chk(expectedChecksum)) isEqual:actualChecksum]) {
    @throw [new_OrgApacheLuceneIndexCorruptIndexException_initWithNSString_withOrgApacheLuceneStoreDataInput_(JreStrcat("$$$$", @"SimpleText checksum failure: ", actualChecksum, @" != ", expectedChecksum), input) autorelease];
  }
  if ([input length] != [input getFilePointer]) {
    @throw [new_OrgApacheLuceneIndexCorruptIndexException_initWithNSString_withOrgApacheLuceneStoreDataInput_(@"Unexpected stuff at the end of file, please be careful with your text editor!", input) autorelease];
  }
}

void OrgApacheLuceneCodecsSimpletextSimpleTextUtil_init(OrgApacheLuceneCodecsSimpletextSimpleTextUtil *self) {
  NSObject_init(self);
}

OrgApacheLuceneCodecsSimpletextSimpleTextUtil *new_OrgApacheLuceneCodecsSimpletextSimpleTextUtil_init() {
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil *self = [OrgApacheLuceneCodecsSimpletextSimpleTextUtil alloc];
  OrgApacheLuceneCodecsSimpletextSimpleTextUtil_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsSimpletextSimpleTextUtil)

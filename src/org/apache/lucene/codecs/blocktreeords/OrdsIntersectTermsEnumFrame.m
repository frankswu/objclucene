//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./codecs/src/java/org/apache/lucene/codecs/blocktreeords/OrdsIntersectTermsEnumFrame.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/IOException.h"
#include "java/lang/System.h"
#include "org/apache/lucene/codecs/BlockTermState.h"
#include "org/apache/lucene/codecs/PostingsReaderBase.h"
#include "org/apache/lucene/codecs/blocktreeords/FSTOrdsOutputs.h"
#include "org/apache/lucene/codecs/blocktreeords/OrdsBlockTreeTermsReader.h"
#include "org/apache/lucene/codecs/blocktreeords/OrdsBlockTreeTermsWriter.h"
#include "org/apache/lucene/codecs/blocktreeords/OrdsFieldReader.h"
#include "org/apache/lucene/codecs/blocktreeords/OrdsIntersectTermsEnum.h"
#include "org/apache/lucene/codecs/blocktreeords/OrdsIntersectTermsEnumFrame.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/IndexOptions.h"
#include "org/apache/lucene/store/ByteArrayDataInput.h"
#include "org/apache/lucene/store/IndexInput.h"
#include "org/apache/lucene/util/ArrayUtil.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/automaton/Automaton.h"
#include "org/apache/lucene/util/automaton/CompiledAutomaton.h"
#include "org/apache/lucene/util/automaton/RunAutomaton.h"
#include "org/apache/lucene/util/automaton/Transition.h"
#include "org/apache/lucene/util/fst/FST.h"

@interface OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame () {
 @public
  OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *ite_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame, ite_, OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *)

@implementation OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame

- (instancetype)initWithOrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum:(OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *)ite
                                                                         withInt:(jint)ord {
  OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame_initWithOrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum_withInt_(self, ite, ord);
  return self;
}

- (void)loadNextFloorBlock {
  JreAssert((numFollowFloorBlocks_ > 0), (@"org/apache/lucene/codecs/blocktreeords/OrdsIntersectTermsEnumFrame.java:110 condition failed: assert numFollowFloorBlocks > 0;"));
  do {
    fp_ = fpOrig_ + (JreURShift64([((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(floorDataReader_)) readVLong], 1));
    numFollowFloorBlocks_--;
    if (numFollowFloorBlocks_ != 0) {
      nextFloorLabel_ = [floorDataReader_ readByte] & (jint) 0xff;
      termOrd_ += [floorDataReader_ readVLong];
    }
    else {
      nextFloorLabel_ = 256;
    }
  }
  while (numFollowFloorBlocks_ != 0 && nextFloorLabel_ <= ((OrgApacheLuceneUtilAutomatonTransition *) nil_chk(transition_))->min_);
  [self load__WithOrgApacheLuceneCodecsBlocktreeordsFSTOrdsOutputs_Output:nil];
}

- (void)setStateWithInt:(jint)state {
  self->state_ = state;
  transitionIndex_ = 0;
  transitionCount_ = [((OrgApacheLuceneUtilAutomatonAutomaton *) nil_chk(((OrgApacheLuceneUtilAutomatonCompiledAutomaton *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *) nil_chk(ite_))->compiledAutomaton_))->automaton_)) getNumTransitionsWithInt:state];
  if (transitionCount_ != 0) {
    [ite_->compiledAutomaton_->automaton_ initTransitionWithInt:state withOrgApacheLuceneUtilAutomatonTransition:transition_];
    [ite_->compiledAutomaton_->automaton_ getNextTransitionWithOrgApacheLuceneUtilAutomatonTransition:transition_];
    curTransitionMax_ = ((OrgApacheLuceneUtilAutomatonTransition *) nil_chk(transition_))->max_;
  }
  else {
    curTransitionMax_ = -1;
  }
}

- (void)load__WithOrgApacheLuceneCodecsBlocktreeordsFSTOrdsOutputs_Output:(OrgApacheLuceneCodecsBlocktreeordsFSTOrdsOutputs_Output *)output {
  if (output != nil && output->bytes_ != nil && transitionCount_ != 0) {
    OrgApacheLuceneUtilBytesRef *frameIndexData = output->bytes_;
    if (((IOSByteArray *) nil_chk(floorData_))->size_ < frameIndexData->length_) {
      JreStrongAssignAndConsume(&self->floorData_, [IOSByteArray newArrayWithLength:OrgApacheLuceneUtilArrayUtil_oversizeWithInt_withInt_(frameIndexData->length_, 1)]);
    }
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(frameIndexData->bytes_, frameIndexData->offset_, floorData_, 0, frameIndexData->length_);
    [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(floorDataReader_)) resetWithByteArray:floorData_ withInt:0 withInt:frameIndexData->length_];
    jlong code = [floorDataReader_ readVLong];
    if ((code & OrgApacheLuceneCodecsBlocktreeordsOrdsBlockTreeTermsWriter_OUTPUT_FLAG_IS_FLOOR) != 0) {
      numFollowFloorBlocks_ = [floorDataReader_ readVInt];
      nextFloorLabel_ = [floorDataReader_ readByte] & (jint) 0xff;
      termOrd_ = termOrdOrig_ + [floorDataReader_ readVLong];
      if (![((OrgApacheLuceneUtilAutomatonRunAutomaton *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *) nil_chk(ite_))->runAutomaton_)) isAcceptWithInt:state_]) {
        JreAssert((transitionIndex_ == 0), (JreStrcat("$I", @"transitionIndex=", transitionIndex_)));
        while (numFollowFloorBlocks_ != 0 && nextFloorLabel_ <= ((OrgApacheLuceneUtilAutomatonTransition *) nil_chk(transition_))->min_) {
          fp_ = fpOrig_ + (JreURShift64([floorDataReader_ readVLong], 1));
          numFollowFloorBlocks_--;
          if (numFollowFloorBlocks_ != 0) {
            nextFloorLabel_ = [floorDataReader_ readByte] & (jint) 0xff;
            termOrd_ += [floorDataReader_ readVLong];
          }
          else {
            nextFloorLabel_ = 256;
          }
        }
      }
    }
  }
  [((OrgApacheLuceneStoreIndexInput *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *) nil_chk(ite_))->in_)) seekWithLong:fp_];
  jint code = [ite_->in_ readVInt];
  entCount_ = JreURShift32(code, 1);
  JreAssert((entCount_ > 0), (@"org/apache/lucene/codecs/blocktreeords/OrdsIntersectTermsEnumFrame.java:187 condition failed: assert entCount > 0;"));
  isLastInFloor_ = ((code & 1) != 0);
  code = [ite_->in_ readVInt];
  isLeafBlock_ = ((code & 1) != 0);
  jint numBytes = JreURShift32(code, 1);
  if (((IOSByteArray *) nil_chk(suffixBytes_))->size_ < numBytes) {
    JreStrongAssignAndConsume(&suffixBytes_, [IOSByteArray newArrayWithLength:OrgApacheLuceneUtilArrayUtil_oversizeWithInt_withInt_(numBytes, 1)]);
  }
  [ite_->in_ readBytesWithByteArray:suffixBytes_ withInt:0 withInt:numBytes];
  [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(suffixesReader_)) resetWithByteArray:suffixBytes_ withInt:0 withInt:numBytes];
  numBytes = [ite_->in_ readVInt];
  if (((IOSByteArray *) nil_chk(statBytes_))->size_ < numBytes) {
    JreStrongAssignAndConsume(&statBytes_, [IOSByteArray newArrayWithLength:OrgApacheLuceneUtilArrayUtil_oversizeWithInt_withInt_(numBytes, 1)]);
  }
  [ite_->in_ readBytesWithByteArray:statBytes_ withInt:0 withInt:numBytes];
  [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(statsReader_)) resetWithByteArray:statBytes_ withInt:0 withInt:numBytes];
  metaDataUpto_ = 0;
  ((OrgApacheLuceneCodecsBlockTermState *) nil_chk(termState_))->termBlockOrd_ = 0;
  nextEnt_ = 0;
  numBytes = [ite_->in_ readVInt];
  if (bytes_ == nil) {
    JreStrongAssignAndConsume(&bytes_, [IOSByteArray newArrayWithLength:OrgApacheLuceneUtilArrayUtil_oversizeWithInt_withInt_(numBytes, 1)]);
    JreStrongAssignAndConsume(&bytesReader_, new_OrgApacheLuceneStoreByteArrayDataInput_init());
  }
  else if (bytes_->size_ < numBytes) {
    JreStrongAssignAndConsume(&bytes_, [IOSByteArray newArrayWithLength:OrgApacheLuceneUtilArrayUtil_oversizeWithInt_withInt_(numBytes, 1)]);
  }
  [ite_->in_ readBytesWithByteArray:bytes_ withInt:0 withInt:numBytes];
  [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(bytesReader_)) resetWithByteArray:bytes_ withInt:0 withInt:numBytes];
  if (!isLastInFloor_) {
    fpEnd_ = [ite_->in_ getFilePointer];
  }
}

- (jboolean)next {
  return isLeafBlock_ ? [self nextLeaf] : [self nextNonLeaf];
}

- (jboolean)nextLeaf {
  JreAssert((nextEnt_ != -1 && nextEnt_ < entCount_), (JreStrcat("$I$I$J", @"nextEnt=", nextEnt_, @" entCount=", entCount_, @" fp=", fp_)));
  nextEnt_++;
  suffix_ = [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(suffixesReader_)) readVInt];
  startBytePos_ = [suffixesReader_ getPosition];
  [suffixesReader_ skipBytesWithLong:suffix_];
  return NO;
}

- (jboolean)nextNonLeaf {
  JreAssert((nextEnt_ != -1 && nextEnt_ < entCount_), (JreStrcat("$I$I$J", @"nextEnt=", nextEnt_, @" entCount=", entCount_, @" fp=", fp_)));
  nextEnt_++;
  jint code = [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(suffixesReader_)) readVInt];
  suffix_ = JreURShift32(code, 1);
  startBytePos_ = [suffixesReader_ getPosition];
  [suffixesReader_ skipBytesWithLong:suffix_];
  if ((code & 1) == 0) {
    ((OrgApacheLuceneCodecsBlockTermState *) nil_chk(termState_))->termBlockOrd_++;
    return NO;
  }
  else {
    lastSubFP_ = fp_ - [suffixesReader_ readVLong];
    [suffixesReader_ readVLong];
    return YES;
  }
}

- (jint)getTermBlockOrd {
  return isLeafBlock_ ? nextEnt_ : ((OrgApacheLuceneCodecsBlockTermState *) nil_chk(termState_))->termBlockOrd_;
}

- (void)decodeMetaData {
  jint limit = [self getTermBlockOrd];
  jboolean absolute = metaDataUpto_ == 0;
  JreAssert((limit > 0), (@"org/apache/lucene/codecs/blocktreeords/OrdsIntersectTermsEnumFrame.java:278 condition failed: assert limit > 0;"));
  while (metaDataUpto_ < limit) {
    ((OrgApacheLuceneCodecsBlockTermState *) nil_chk(termState_))->docFreq_ = [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(statsReader_)) readVInt];
    if ([((OrgApacheLuceneIndexFieldInfo *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsFieldReader *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *) nil_chk(ite_))->fr_))->fieldInfo_)) getIndexOptions] != JreLoadStatic(OrgApacheLuceneIndexIndexOptionsEnum, DOCS)) {
      termState_->totalTermFreq_ = termState_->docFreq_ + [statsReader_ readVLong];
    }
    for (jint i = 0; i < ite_->fr_->longsSize_; i++) {
      *IOSLongArray_GetRef(nil_chk(longs_), i) = [((OrgApacheLuceneStoreByteArrayDataInput *) nil_chk(bytesReader_)) readVLong];
    }
    [((OrgApacheLuceneCodecsPostingsReaderBase *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsBlockTreeTermsReader *) nil_chk(ite_->fr_->parent_))->postingsReader_)) decodeTermWithLongArray:longs_ withOrgApacheLuceneStoreDataInput:bytesReader_ withOrgApacheLuceneIndexFieldInfo:ite_->fr_->fieldInfo_ withOrgApacheLuceneCodecsBlockTermState:termState_ withBoolean:absolute];
    metaDataUpto_++;
    absolute = NO;
  }
  ((OrgApacheLuceneCodecsBlockTermState *) nil_chk(termState_))->termBlockOrd_ = metaDataUpto_;
}

- (void)dealloc {
  RELEASE_(suffixBytes_);
  RELEASE_(suffixesReader_);
  RELEASE_(statBytes_);
  RELEASE_(statsReader_);
  RELEASE_(floorData_);
  RELEASE_(floorDataReader_);
  RELEASE_(transition_);
  RELEASE_(arc_);
  RELEASE_(termState_);
  RELEASE_(longs_);
  RELEASE_(bytes_);
  RELEASE_(bytesReader_);
  RELEASE_(outputPrefix_);
  RELEASE_(ite_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum:withInt:", "OrdsIntersectTermsEnumFrame", NULL, 0x1, "Ljava.io.IOException;", NULL },
    { "loadNextFloorBlock", NULL, "V", 0x0, "Ljava.io.IOException;", NULL },
    { "setStateWithInt:", "setState", "V", 0x1, NULL, NULL },
    { "load__WithOrgApacheLuceneCodecsBlocktreeordsFSTOrdsOutputs_Output:", "load", "V", 0x0, "Ljava.io.IOException;", NULL },
    { "next", NULL, "Z", 0x1, NULL, NULL },
    { "nextLeaf", NULL, "Z", 0x1, NULL, NULL },
    { "nextNonLeaf", NULL, "Z", 0x1, NULL, NULL },
    { "getTermBlockOrd", NULL, "I", 0x1, NULL, NULL },
    { "decodeMetaData", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "ord_", NULL, 0x10, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "fp_", NULL, 0x0, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "fpOrig_", NULL, 0x0, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "fpEnd_", NULL, 0x0, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "lastSubFP_", NULL, 0x0, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "state_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "metaDataUpto_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "suffixBytes_", NULL, 0x0, "[B", NULL, NULL, .constantValue.asLong = 0 },
    { "suffixesReader_", NULL, 0x10, "Lorg.apache.lucene.store.ByteArrayDataInput;", NULL, NULL, .constantValue.asLong = 0 },
    { "statBytes_", NULL, 0x0, "[B", NULL, NULL, .constantValue.asLong = 0 },
    { "statsReader_", NULL, 0x10, "Lorg.apache.lucene.store.ByteArrayDataInput;", NULL, NULL, .constantValue.asLong = 0 },
    { "floorData_", NULL, 0x0, "[B", NULL, NULL, .constantValue.asLong = 0 },
    { "floorDataReader_", NULL, 0x10, "Lorg.apache.lucene.store.ByteArrayDataInput;", NULL, NULL, .constantValue.asLong = 0 },
    { "prefix_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "entCount_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "nextEnt_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "termOrdOrig_", NULL, 0x0, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "termOrd_", NULL, 0x0, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "isLastInFloor_", NULL, 0x0, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "isLeafBlock_", NULL, 0x0, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "numFollowFloorBlocks_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "nextFloorLabel_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "transition_", NULL, 0x0, "Lorg.apache.lucene.util.automaton.Transition;", NULL, NULL, .constantValue.asLong = 0 },
    { "curTransitionMax_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "transitionIndex_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "transitionCount_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "arc_", NULL, 0x0, "Lorg.apache.lucene.util.fst.FST$Arc;", NULL, "Lorg/apache/lucene/util/fst/FST$Arc<Lorg/apache/lucene/codecs/blocktreeords/FSTOrdsOutputs$Output;>;", .constantValue.asLong = 0 },
    { "termState_", NULL, 0x10, "Lorg.apache.lucene.codecs.BlockTermState;", NULL, NULL, .constantValue.asLong = 0 },
    { "longs_", NULL, 0x1, "[J", NULL, NULL, .constantValue.asLong = 0 },
    { "bytes_", NULL, 0x1, "[B", NULL, NULL, .constantValue.asLong = 0 },
    { "bytesReader_", NULL, 0x0, "Lorg.apache.lucene.store.ByteArrayDataInput;", NULL, NULL, .constantValue.asLong = 0 },
    { "outputPrefix_", NULL, 0x0, "Lorg.apache.lucene.codecs.blocktreeords.FSTOrdsOutputs$Output;", NULL, NULL, .constantValue.asLong = 0 },
    { "startBytePos_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "suffix_", NULL, 0x0, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "ite_", NULL, 0x12, "Lorg.apache.lucene.codecs.blocktreeords.OrdsIntersectTermsEnum;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame = { 2, "OrdsIntersectTermsEnumFrame", "org.apache.lucene.codecs.blocktreeords", NULL, 0x10, 9, methods, 35, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame;
}

@end

void OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame_initWithOrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum_withInt_(OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame *self, OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *ite, jint ord) {
  NSObject_init(self);
  JreStrongAssignAndConsume(&self->suffixBytes_, [IOSByteArray newArrayWithLength:128]);
  JreStrongAssignAndConsume(&self->suffixesReader_, new_OrgApacheLuceneStoreByteArrayDataInput_init());
  JreStrongAssignAndConsume(&self->statBytes_, [IOSByteArray newArrayWithLength:64]);
  JreStrongAssignAndConsume(&self->statsReader_, new_OrgApacheLuceneStoreByteArrayDataInput_init());
  JreStrongAssignAndConsume(&self->floorData_, [IOSByteArray newArrayWithLength:32]);
  JreStrongAssignAndConsume(&self->floorDataReader_, new_OrgApacheLuceneStoreByteArrayDataInput_init());
  JreStrongAssignAndConsume(&self->transition_, new_OrgApacheLuceneUtilAutomatonTransition_init());
  JreStrongAssign(&self->ite_, ite);
  self->ord_ = ord;
  JreStrongAssign(&self->termState_, [((OrgApacheLuceneCodecsPostingsReaderBase *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsBlockTreeTermsReader *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsFieldReader *) nil_chk(((OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *) nil_chk(ite))->fr_))->parent_))->postingsReader_)) newTermState]);
  ((OrgApacheLuceneCodecsBlockTermState *) nil_chk(self->termState_))->totalTermFreq_ = -1;
  JreStrongAssignAndConsume(&self->longs_, [IOSLongArray newArrayWithLength:ite->fr_->longsSize_]);
}

OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame *new_OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame_initWithOrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum_withInt_(OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum *ite, jint ord) {
  OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame *self = [OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame alloc];
  OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame_initWithOrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnum_withInt_(self, ite, ord);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsBlocktreeordsOrdsIntersectTermsEnumFrame)

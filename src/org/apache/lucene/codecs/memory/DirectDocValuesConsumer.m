//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: ./codecs/src/java/org/apache/lucene/codecs/memory/DirectDocValuesConsumer.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Closeable.h"
#include "java/io/IOException.h"
#include "java/lang/Byte.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Integer.h"
#include "java/lang/Iterable.h"
#include "java/lang/Long.h"
#include "java/lang/Math.h"
#include "java/lang/Short.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/util/Iterator.h"
#include "org/apache/lucene/codecs/CodecUtil.h"
#include "org/apache/lucene/codecs/DocValuesConsumer.h"
#include "org/apache/lucene/codecs/memory/DirectDocValuesConsumer.h"
#include "org/apache/lucene/codecs/memory/DirectDocValuesFormat.h"
#include "org/apache/lucene/codecs/memory/DirectDocValuesProducer.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/IndexFileNames.h"
#include "org/apache/lucene/index/SegmentInfo.h"
#include "org/apache/lucene/index/SegmentWriteState.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IOContext.h"
#include "org/apache/lucene/store/IndexOutput.h"
#include "org/apache/lucene/util/BytesRef.h"
#include "org/apache/lucene/util/IOUtils.h"

@interface OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer ()

- (void)addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                          withJavaLangIterable:(id<JavaLangIterable>)values;

- (void)addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                         withJavaLangIterable:(id<JavaLangIterable>)values;

- (id<JavaLangIterable>)countToAddressIteratorWithJavaLangIterable:(id<JavaLangIterable>)counts;

@end

__attribute__((unused)) static void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self, OrgApacheLuceneIndexFieldInfo *field, id<JavaLangIterable> values);

__attribute__((unused)) static void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self, OrgApacheLuceneIndexFieldInfo *field, id<JavaLangIterable> values);

__attribute__((unused)) static id<JavaLangIterable> OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_countToAddressIteratorWithJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self, id<JavaLangIterable> counts);

@interface OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 : NSObject < JavaLangIterable > {
 @public
  id<JavaLangIterable> val$counts_;
}

- (id<JavaUtilIterator>)iterator;

- (instancetype)initWithJavaLangIterable:(id<JavaLangIterable>)capture$0;


@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1)

J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1, val$counts_, id<JavaLangIterable>)

__attribute__((unused)) static void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_initWithJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 *self, id<JavaLangIterable> capture$0);

__attribute__((unused)) static OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 *new_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_initWithJavaLangIterable_(id<JavaLangIterable> capture$0) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1)

@interface OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 : NSObject < JavaUtilIterator > {
 @public
  jlong sum_;
  jboolean ended_;
  id<JavaUtilIterator> val$iter_;
}

- (jboolean)hasNext;

- (NSNumber *)next;

- (void)remove;

- (instancetype)initWithJavaUtilIterator:(id<JavaUtilIterator>)capture$0;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1)

J2OBJC_FIELD_SETTER(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1, val$iter_, id<JavaUtilIterator>)

__attribute__((unused)) static void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1_initWithJavaUtilIterator_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 *self, id<JavaUtilIterator> capture$0);

__attribute__((unused)) static OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 *new_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1_initWithJavaUtilIterator_(id<JavaUtilIterator> capture$0) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1)

@implementation OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer

- (instancetype)initWithOrgApacheLuceneIndexSegmentWriteState:(OrgApacheLuceneIndexSegmentWriteState *)state
                                                 withNSString:(NSString *)dataCodec
                                                 withNSString:(NSString *)dataExtension
                                                 withNSString:(NSString *)metaCodec
                                                 withNSString:(NSString *)metaExtension {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_initWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(self, state, dataCodec, dataExtension, metaCodec, metaExtension);
  return self;
}

- (void)addNumericFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                    withJavaLangIterable:(id<JavaLangIterable>)values {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(meta_)) writeVIntWithInt:((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->number_];
  [meta_ writeByteWithByte:OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_NUMBER];
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
}

- (void)addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                          withJavaLangIterable:(id<JavaLangIterable>)values {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
}

- (void)close {
  jboolean success = NO;
  @try {
    if (meta_ != nil) {
      [meta_ writeVIntWithInt:-1];
      OrgApacheLuceneCodecsCodecUtil_writeFooterWithOrgApacheLuceneStoreIndexOutput_(meta_);
    }
    if (data_ != nil) {
      OrgApacheLuceneCodecsCodecUtil_writeFooterWithOrgApacheLuceneStoreIndexOutput_(data_);
    }
    success = YES;
  }
  @finally {
    if (success) {
      OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ data_, meta_ } count:2 type:JavaIoCloseable_class_()]);
    }
    else {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ data_, meta_ } count:2 type:JavaIoCloseable_class_()]);
    }
    JreStrongAssign(&data_, JreStrongAssign(&meta_, nil));
  }
}

- (void)addBinaryFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                   withJavaLangIterable:(id<JavaLangIterable>)values {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(meta_)) writeVIntWithInt:((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->number_];
  [meta_ writeByteWithByte:OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_BYTES];
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
}

- (void)addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                         withJavaLangIterable:(id<JavaLangIterable>)values {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
}

- (void)writeMissingBitsetWithJavaLangIterable:(id<JavaLangIterable>)values {
  jlong bits = 0;
  jint count = 0;
  for (id __strong v in nil_chk(values)) {
    if (count == 64) {
      [((OrgApacheLuceneStoreIndexOutput *) nil_chk(data_)) writeLongWithLong:bits];
      count = 0;
      bits = 0;
    }
    if (v != nil) {
      bits |= JreLShift64(1LL, (count & (jint) 0x3f));
    }
    count++;
  }
  if (count > 0) {
    [((OrgApacheLuceneStoreIndexOutput *) nil_chk(data_)) writeLongWithLong:bits];
  }
}

- (void)addSortedFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                   withJavaLangIterable:(id<JavaLangIterable>)values
                                   withJavaLangIterable:(id<JavaLangIterable>)docToOrd {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(meta_)) writeVIntWithInt:((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->number_];
  [meta_ writeByteWithByte:OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_SORTED];
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, docToOrd);
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
}

- (void)addSortedNumericFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                          withJavaLangIterable:(id<JavaLangIterable>)docToValueCount
                                          withJavaLangIterable:(id<JavaLangIterable>)values {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(meta_)) writeVIntWithInt:((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->number_];
  if (OrgApacheLuceneCodecsDocValuesConsumer_isSingleValuedWithJavaLangIterable_(docToValueCount)) {
    [meta_ writeByteWithByte:OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_SORTED_NUMERIC_SINGLETON];
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, OrgApacheLuceneCodecsDocValuesConsumer_singletonViewWithJavaLangIterable_withJavaLangIterable_withNSNumber_(docToValueCount, values, nil));
  }
  else {
    [meta_ writeByteWithByte:OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_SORTED_NUMERIC];
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_countToAddressIteratorWithJavaLangIterable_(self, docToValueCount));
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
  }
}

- (void)addSortedSetFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)field
                                      withJavaLangIterable:(id<JavaLangIterable>)values
                                      withJavaLangIterable:(id<JavaLangIterable>)docToOrdCount
                                      withJavaLangIterable:(id<JavaLangIterable>)ords {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(meta_)) writeVIntWithInt:((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->number_];
  if (OrgApacheLuceneCodecsDocValuesConsumer_isSingleValuedWithJavaLangIterable_(docToOrdCount)) {
    [meta_ writeByteWithByte:OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_SORTED_SET_SINGLETON];
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, OrgApacheLuceneCodecsDocValuesConsumer_singletonViewWithJavaLangIterable_withJavaLangIterable_withNSNumber_(docToOrdCount, ords, JavaLangLong_valueOfWithLong_(-1LL)));
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
  }
  else {
    [meta_ writeByteWithByte:OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_SORTED_SET];
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_countToAddressIteratorWithJavaLangIterable_(self, docToOrdCount));
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, ords);
    OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(self, field, values);
  }
}

- (id<JavaLangIterable>)countToAddressIteratorWithJavaLangIterable:(id<JavaLangIterable>)counts {
  return OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_countToAddressIteratorWithJavaLangIterable_(self, counts);
}

- (void)dealloc {
  RELEASE_(data_);
  RELEASE_(meta_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithOrgApacheLuceneIndexSegmentWriteState:withNSString:withNSString:withNSString:withNSString:", "DirectDocValuesConsumer", NULL, 0x0, "Ljava.io.IOException;", NULL },
    { "addNumericFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:", "addNumericField", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:", "addNumericFieldValues", "V", 0x2, "Ljava.io.IOException;", NULL },
    { "close", NULL, "V", 0x1, "Ljava.io.IOException;", NULL },
    { "addBinaryFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:", "addBinaryField", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:", "addBinaryFieldValues", "V", 0x2, "Ljava.io.IOException;", NULL },
    { "writeMissingBitsetWithJavaLangIterable:", "writeMissingBitset", "V", 0x0, "Ljava.io.IOException;", NULL },
    { "addSortedFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:withJavaLangIterable:", "addSortedField", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "addSortedNumericFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:withJavaLangIterable:", "addSortedNumericField", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "addSortedSetFieldWithOrgApacheLuceneIndexFieldInfo:withJavaLangIterable:withJavaLangIterable:withJavaLangIterable:", "addSortedSetField", "V", 0x1, "Ljava.io.IOException;", NULL },
    { "countToAddressIteratorWithJavaLangIterable:", "countToAddressIterator", "Ljava.lang.Iterable;", 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "data_", NULL, 0x0, "Lorg.apache.lucene.store.IndexOutput;", NULL, NULL, .constantValue.asLong = 0 },
    { "meta_", NULL, 0x0, "Lorg.apache.lucene.store.IndexOutput;", NULL, NULL, .constantValue.asLong = 0 },
    { "maxDoc_", NULL, 0x10, "I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer = { 2, "DirectDocValuesConsumer", "org.apache.lucene.codecs.memory", NULL, 0x0, 11, methods, 3, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer;
}

@end

void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_initWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self, OrgApacheLuceneIndexSegmentWriteState *state, NSString *dataCodec, NSString *dataExtension, NSString *metaCodec, NSString *metaExtension) {
  OrgApacheLuceneCodecsDocValuesConsumer_init(self);
  self->maxDoc_ = [((OrgApacheLuceneIndexSegmentInfo *) nil_chk(((OrgApacheLuceneIndexSegmentWriteState *) nil_chk(state))->segmentInfo_)) maxDoc];
  jboolean success = NO;
  @try {
    NSString *dataName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(state->segmentInfo_->name_, state->segmentSuffix_, dataExtension);
    JreStrongAssign(&self->data_, [((OrgApacheLuceneStoreDirectory *) nil_chk(state->directory_)) createOutputWithNSString:dataName withOrgApacheLuceneStoreIOContext:state->context_]);
    OrgApacheLuceneCodecsCodecUtil_writeIndexHeaderWithOrgApacheLuceneStoreDataOutput_withNSString_withInt_withByteArray_withNSString_(self->data_, dataCodec, OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
    NSString *metaName = OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_withNSString_(state->segmentInfo_->name_, state->segmentSuffix_, metaExtension);
    JreStrongAssign(&self->meta_, [state->directory_ createOutputWithNSString:metaName withOrgApacheLuceneStoreIOContext:state->context_]);
    OrgApacheLuceneCodecsCodecUtil_writeIndexHeaderWithOrgApacheLuceneStoreDataOutput_withNSString_withInt_withByteArray_withNSString_(self->meta_, metaCodec, OrgApacheLuceneCodecsMemoryDirectDocValuesProducer_VERSION_CURRENT, [state->segmentInfo_ getId], state->segmentSuffix_);
    success = YES;
  }
  @finally {
    if (!success) {
      OrgApacheLuceneUtilIOUtils_closeWhileHandlingExceptionWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ self } count:1 type:JavaIoCloseable_class_()]);
    }
  }
}

OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *new_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_initWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(OrgApacheLuceneIndexSegmentWriteState *state, NSString *dataCodec, NSString *dataExtension, NSString *metaCodec, NSString *metaExtension) {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self = [OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer alloc];
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_initWithOrgApacheLuceneIndexSegmentWriteState_withNSString_withNSString_withNSString_withNSString_(self, state, dataCodec, dataExtension, metaCodec, metaExtension);
  return self;
}

void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addNumericFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self, OrgApacheLuceneIndexFieldInfo *field, id<JavaLangIterable> values) {
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeLongWithLong:[((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) getFilePointer]];
  jlong minValue = JavaLangLong_MAX_VALUE;
  jlong maxValue = JavaLangLong_MIN_VALUE;
  jboolean missing = NO;
  jlong count = 0;
  for (NSNumber * __strong nv in nil_chk(values)) {
    if (nv != nil) {
      jlong v = [nv longLongValue];
      minValue = JavaLangMath_minWithLong_withLong_(minValue, v);
      maxValue = JavaLangMath_maxWithLong_withLong_(maxValue, v);
    }
    else {
      missing = YES;
    }
    count++;
    if (count >= JreLoadStatic(OrgApacheLuceneCodecsMemoryDirectDocValuesFormat, MAX_SORTED_SET_ORDS_)) {
      @throw [new_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$$$I$", @"DocValuesField \"", ((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->name_, @"\" is too large, must be <= ", JreLoadStatic(OrgApacheLuceneCodecsMemoryDirectDocValuesFormat, MAX_SORTED_SET_ORDS_), @" values/total ords")) autorelease];
    }
  }
  [self->meta_ writeIntWithInt:(jint) count];
  if (missing) {
    jlong start = [self->data_ getFilePointer];
    [self writeMissingBitsetWithJavaLangIterable:values];
    [self->meta_ writeLongWithLong:start];
    [self->meta_ writeLongWithLong:[self->data_ getFilePointer] - start];
  }
  else {
    [self->meta_ writeLongWithLong:-1LL];
  }
  jbyte byteWidth;
  if (minValue >= JavaLangByte_MIN_VALUE && maxValue <= JavaLangByte_MAX_VALUE) {
    byteWidth = 1;
  }
  else if (minValue >= JavaLangShort_MIN_VALUE && maxValue <= JavaLangShort_MAX_VALUE) {
    byteWidth = 2;
  }
  else if (minValue >= JavaLangInteger_MIN_VALUE && maxValue <= JavaLangInteger_MAX_VALUE) {
    byteWidth = 4;
  }
  else {
    byteWidth = 8;
  }
  [self->meta_ writeByteWithByte:byteWidth];
  for (NSNumber * __strong nv in values) {
    jlong v;
    if (nv != nil) {
      v = [nv longLongValue];
    }
    else {
      v = 0;
    }
    switch (byteWidth) {
      case 1:
      [self->data_ writeByteWithByte:(jbyte) v];
      break;
      case 2:
      [self->data_ writeShortWithShort:(jshort) v];
      break;
      case 4:
      [self->data_ writeIntWithInt:(jint) v];
      break;
      case 8:
      [self->data_ writeLongWithLong:v];
      break;
    }
  }
}

void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_addBinaryFieldValuesWithOrgApacheLuceneIndexFieldInfo_withJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self, OrgApacheLuceneIndexFieldInfo *field, id<JavaLangIterable> values) {
  jlong startFP = [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->data_)) getFilePointer];
  jboolean missing = NO;
  jlong totalBytes = 0;
  jint count = 0;
  for (OrgApacheLuceneUtilBytesRef * __strong v in nil_chk(values)) {
    if (v != nil) {
      [self->data_ writeBytesWithByteArray:v->bytes_ withInt:v->offset_ withInt:v->length_];
      totalBytes += v->length_;
      if (totalBytes > JreLoadStatic(OrgApacheLuceneCodecsMemoryDirectDocValuesFormat, MAX_TOTAL_BYTES_LENGTH_)) {
        @throw [new_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$$$I$", @"DocValuesField \"", ((OrgApacheLuceneIndexFieldInfo *) nil_chk(field))->name_, @"\" is too large, cannot have more than DirectDocValuesFormat.MAX_TOTAL_BYTES_LENGTH (", JreLoadStatic(OrgApacheLuceneCodecsMemoryDirectDocValuesFormat, MAX_TOTAL_BYTES_LENGTH_), @") bytes")) autorelease];
      }
    }
    else {
      missing = YES;
    }
    count++;
  }
  [((OrgApacheLuceneStoreIndexOutput *) nil_chk(self->meta_)) writeLongWithLong:startFP];
  [self->meta_ writeIntWithInt:(jint) totalBytes];
  [self->meta_ writeIntWithInt:count];
  if (missing) {
    jlong start = [self->data_ getFilePointer];
    [self writeMissingBitsetWithJavaLangIterable:values];
    [self->meta_ writeLongWithLong:start];
    [self->meta_ writeLongWithLong:[self->data_ getFilePointer] - start];
  }
  else {
    [self->meta_ writeLongWithLong:-1LL];
  }
  jint addr = 0;
  for (OrgApacheLuceneUtilBytesRef * __strong v in values) {
    [self->data_ writeIntWithInt:addr];
    if (v != nil) {
      addr += v->length_;
    }
  }
  [self->data_ writeIntWithInt:addr];
}

id<JavaLangIterable> OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_countToAddressIteratorWithJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer *self, id<JavaLangIterable> counts) {
  return [new_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_initWithJavaLangIterable_(counts) autorelease];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer)

@implementation OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1

- (id<JavaUtilIterator>)iterator {
  id<JavaUtilIterator> iter = [((id<JavaLangIterable>) nil_chk(val$counts_)) iterator];
  return [new_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1_initWithJavaUtilIterator_(iter) autorelease];
}

- (instancetype)initWithJavaLangIterable:(id<JavaLangIterable>)capture$0 {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_initWithJavaLangIterable_(self, capture$0);
  return self;
}

- (void)dealloc {
  RELEASE_(val$counts_);
  [super dealloc];
}

- (NSUInteger)countByEnumeratingWithState:(NSFastEnumerationState *)state objects:(__unsafe_unretained id *)stackbuf count:(NSUInteger)len {
  return JreDefaultFastEnumeration(self, state, stackbuf, len);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "iterator", NULL, "Ljava.util.Iterator;", 0x1, NULL, NULL },
    { "initWithJavaLangIterable:", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "val$counts_", NULL, 0x1012, "Ljava.lang.Iterable;", NULL, "Ljava/lang/Iterable<Ljava/lang/Number;>;", .constantValue.asLong = 0 },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer", "countToAddressIteratorWithJavaLangIterable:" };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 = { 2, "", "org.apache.lucene.codecs.memory", "DirectDocValuesConsumer", 0x8008, 2, methods, 1, fields, 0, NULL, 0, NULL, &enclosing_method, "Ljava/lang/Object;Ljava/lang/Iterable<Ljava/lang/Number;>;" };
  return &_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1;
}

@end

void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_initWithJavaLangIterable_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 *self, id<JavaLangIterable> capture$0) {
  JreStrongAssign(&self->val$counts_, capture$0);
  NSObject_init(self);
}

OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 *new_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_initWithJavaLangIterable_(id<JavaLangIterable> capture$0) {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 *self = [OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1 alloc];
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_initWithJavaLangIterable_(self, capture$0);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1)

@implementation OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1

- (jboolean)hasNext {
  return [((id<JavaUtilIterator>) nil_chk(val$iter_)) hasNext] || !ended_;
}

- (NSNumber *)next {
  jlong toReturn = sum_;
  if ([((id<JavaUtilIterator>) nil_chk(val$iter_)) hasNext]) {
    NSNumber *n = [val$iter_ next];
    if (n != nil) {
      sum_ += [n longLongValue];
    }
  }
  else if (!ended_) {
    ended_ = YES;
  }
  else {
    JreAssert((NO), (@"org/apache/lucene/codecs/memory/DirectDocValuesConsumer.java:328 condition failed: assert false;"));
  }
  return JavaLangLong_valueOfWithLong_(toReturn);
}

- (void)remove {
  @throw [new_JavaLangUnsupportedOperationException_init() autorelease];
}

- (instancetype)initWithJavaUtilIterator:(id<JavaUtilIterator>)capture$0 {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1_initWithJavaUtilIterator_(self, capture$0);
  return self;
}

- (void)dealloc {
  RELEASE_(val$iter_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "hasNext", NULL, "Z", 0x1, NULL, NULL },
    { "next", NULL, "Ljava.lang.Number;", 0x1, NULL, NULL },
    { "remove", NULL, "V", 0x1, NULL, NULL },
    { "initWithJavaUtilIterator:", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "sum_", NULL, 0x0, "J", NULL, NULL, .constantValue.asLong = 0 },
    { "ended_", NULL, 0x0, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "val$iter_", NULL, 0x1012, "Ljava.util.Iterator;", NULL, "Ljava/util/Iterator<Ljava/lang/Number;>;", .constantValue.asLong = 0 },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1", "iterator" };
  static const J2ObjcClassInfo _OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 = { 2, "", "org.apache.lucene.codecs.memory", "DirectDocValuesConsumer$", 0x8008, 4, methods, 3, fields, 0, NULL, 0, NULL, &enclosing_method, "Ljava/lang/Object;Ljava/util/Iterator<Ljava/lang/Number;>;" };
  return &_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1;
}

@end

void OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1_initWithJavaUtilIterator_(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 *self, id<JavaUtilIterator> capture$0) {
  JreStrongAssign(&self->val$iter_, capture$0);
  NSObject_init(self);
}

OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 *new_OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1_initWithJavaUtilIterator_(id<JavaUtilIterator> capture$0) {
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 *self = [OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1 alloc];
  OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1_initWithJavaUtilIterator_(self, capture$0);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneCodecsMemoryDirectDocValuesConsumer_$1_$1)
